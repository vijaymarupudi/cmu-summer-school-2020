(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{128:function(e,t,n){var r=n(37),o=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(30)),a=o(n(34)),s=o(n(25)),l=o(n(35)),c=o(n(38)),u=o(n(39)),d=o(n(60)),f=o(n(40)),p=o(n(41)),_=r(n(1)),h=n(10),g=o(n(183));function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var y=n(184);function E(e,t,n){return e=[e],t.forEach(function(t,r){e=e.map(function(e,o){if("string"==typeof e){var i=e.split(t);if(i.length>1)return a=i,s=_.default.createElement(h.Text,{style:{color:n[r],textShadowRadius:3,textShadowColor:n[r]}},t),(0,p.default)(a).map(function(e,t){return t<a.length-1?[e,s]:[e]}).reduce(function(e,t){return e.concat(t)})}var a,s;return e}).flat()}),e}var b={ButtonPressed:function(e,t){return"Press Button"},UpdateTextField:function(e,t){return e.name||e.how}},T={UpdateTextField:function(e,t){var n=e.mapping["?sel"],r=Object.entries(e.mapping).reduce(function(e,t){return"?sel"!==t[0]&&e.push(t[1]),e},[]);n=n.replace("?ele-","");var o="("+(r=r.map(function(e){return e.replace("?ele-","")})).join(", ")+"): "+n+"->"+(e.inputs&&e.inputs.value);return o=E(o,[n].concat(r),t)},ButtonPressed:function(e,t){return"Press: "+e.mapping["?sel"].replace("?ele-","")}},v=function(e){function t(e){var n;(0,s.default)(this,t),(n=(0,c.default)(this,(0,u.default)(t).call(this,e))).s_skill_set=n.structure_skills(e.skill_set);var r=n.starting_selection();return n.state={selected_skill:r,selected_match:r,feedback_map:{},s_skill_set:{"":[]}},n.handleClickSkillItem=n.handleClickSkillItem.bind((0,d.default)(n)),n.handleToggleFeedbackButton=n.handleToggleFeedbackButton.bind((0,d.default)(n)),n}return(0,f.default)(t,e),(0,l.default)(t,[{key:"starting_selection",value:function(){if("first"==this.props.initial_select){var e=Object.keys(this.s_skill_set)[0];return null==e?null:this.s_skill_set[e][0]}}},{key:"structure_skills",value:function(e){var t={},n=0,r=function(){var r={};for(i in e[o])(a=e[o][i]).how in r||(r[a.how]=a,r[a.how].matches=[]),a._id=n++,r[a.how].matches.push(a),t[o]=Object.keys(r).map(function(e,t){return r[e]})};for(var o in e){var i,a;r()}return t}},{key:"selectSkill",value:function(e,t){t||(t=e),this.setState({selected_skill:e,selected_match:t})}},{key:"daisyChain",value:function(e,t,n){return function(r){e(r,t,n)}}},{key:"handleClickSkillItem",value:function(e,t,n){var r=(0,a.default)(t,2),o=r[0],i=r[1];this.selectSkill(o,i),this.props.select_callback&&this.props.interactions_service.send({type:"STAGE_SAI",data:i||o}),n&&n(t)}},{key:"handleToggleFeedbackButton",value:function(e,t){var n=(0,a.default)(t,3),r=n[0],o=n[1],i=n[2];this.props.interactions_service.send({type:"TOGGLE_FEEDBACK",skill:r,match:o,label:i})}},{key:"updateFeedbackMap",value:function(e){this.setState({feedback_map:e}),console.log(e)}},{key:"queuedSkillApplicationFeedback",value:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.state.feedback_map);for(var t in e)e[t]="correct"===e[t]?1:-1;return e}},{key:"componentDidUpdate",value:function(e,t){if(!y(e.skill_set,this.props.skill_set)){var n=this.structure_skills(this.props.skill_set);this.setState({feedback_map:{},s_skill_set:n});var r=Object.keys(n);if(r.length>0){var o=n[r[0]][0];this.setState({selected_skill:o,selected_match:o})}else this.setState({selected_skill:null,selected_match:null})}}},{key:"render",value:function(){var e=this;return _.default.createElement(h.View,{style:O.content},_.default.createElement(h.View,{style:S.skill_list},_.default.createElement(h.ScrollView,null,Object.keys(this.state.s_skill_set).map(function(t,n){var r=_.default.createElement(h.TouchableHighlight,{underlayColor:"#fff"},_.default.createElement(h.Text,{style:S.sectionHeader},t)),o=e.state.s_skill_set[t].map(function(t,n){var r=e.state.selected_skill&&e.state.selected_skill._id===t._id,o=(b[t.action]||b.UpdateTextField)(t,e.props.where_colors),i=_.default.createElement(h.TouchableHighlight,{underlayColor:"#f1f1f1",onPress:e.daisyChain(e.handleClickSkillItem,[t],t.callback)},_.default.createElement(h.Text,{style:[S.item,r&&S.selected_skill],backgroundColor:"#ff00ffff"},o)),a=[];return"matches"in t&&(a=t.matches.map(function(n,o){if("mapping"in n){var i=e.state.selected_match&&e.state.selected_match._id===n._id,a=(T[n.action]||T.UpdateTextField)(n,e.props.where_colors),s="correct"===e.state.feedback_map[n._id],l="incorrect"===e.state.feedback_map[n._id];return _.default.createElement(h.View,{style:S.match_container},_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",onPress:e.daisyChain(e.handleToggleFeedbackButton,[t,n,"correct"])},_.default.createElement(h.Text,{style:[S.feedback_button,s&&S.correct_selected]},String.fromCharCode(10004))),_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",onPress:e.daisyChain(e.handleToggleFeedbackButton,[t,n,"incorrect"])},_.default.createElement(h.Text,{style:[S.feedback_button,l&&S.incorrect_selected]},String.fromCharCode(10006))),_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",style:{flex:1},onPress:e.daisyChain(e.handleClickSkillItem,[t,n],n.callback)},_.default.createElement(h.Text,{style:[S.match,r&&i&&S.selected_match]},a)))}return null})),a=a.filter(function(e){return null!=e}),[i].concat(a)});return[r].concat(o)}))),_.default.createElement(h.ScrollView,{style:S.skill_info,showsVerticalScrollIndicator:!0},_.default.createElement(g.default,{title:"How",collapsedHeight:this.props.collapsedHeight.how},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.how)),_.default.createElement(g.default,{title:"Where",collapsedHeight:this.props.collapsedHeight.where},_.default.createElement(h.Text,null,this.state.selected_skill&&JSON.stringify(this.state.selected_skill.where,null,2))),_.default.createElement(g.default,{title:"When",collapsedHeight:this.props.collapsedHeight.when},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.when)),_.default.createElement(g.default,{title:"Which",collapsedHeight:this.props.collapsedHeight.which},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.which))))}}]),t}(_.Component),O=h.StyleSheet.create({content:{flex:1,flexDirection:"row",backgroundColor:"#F5FCFF",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}}),S=h.StyleSheet.create({skill_list:{flexBasis:250,paddingTop:10},skill_info:{flex:1,paddingTop:10},sectionHeader:{flexWrap:"wrap",paddingTop:6,paddingLeft:10,paddingRight:10,paddingBottom:2,fontSize:15,fontWeight:"bold",backgroundColor:"'rgba(247,247,247,1.0)'"},selected_skill:{backgroundColor:"#93e4ec"},item:{flexWrap:"wrap",padding:4,paddingLeft:6,fontSize:16,borderBottomWidth:1,borderColor:"gray",backgroundColor:"'rgba(247,0,0,0.0)'"},feedback_button:{fontSize:20,width:27,textAlign:"center",borderWidth:.1,borderColor:"lightgray"},incorrect_selected:{backgroundColor:"red"},correct_selected:{backgroundColor:"limegreen"},match_container:{display:"flex",flexDirection:"row",borderBottomWidth:1,borderColor:"gray"},match:{flex:1,flexWrap:"wrap",padding:3,textIndent:5,fontSize:15,backgroundColor:"'rgba(252,252,252,1.0)'"},selected_match:{backgroundColor:"#b3e8ff"}});v.defaultProps={collapsedHeight:{how:40,where:90,when:90,which:40},where_colors:["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],select_callback:function(){}};var w=v;t.default=w},183:function(e,t,n){var r=n(37),o=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(25)),a=o(n(35)),s=o(n(38)),l=o(n(39)),c=o(n(40)),u=r(n(1)),d=n(10),f=function(e){function t(e){var r;return(0,i.default)(this,t),(r=(0,s.default)(this,(0,l.default)(t).call(this,e))).icons={up:n(401),down:n(402)},r.state={title:e.title,expanded:!1,expandable:!0,animation:new d.Animated.Value(e.collapsedHeight)},r}return(0,c.default)(t,e),(0,a.default)(t,[{key:"_setMaxHeight",value:function(e){this.setState({maxHeight:e.nativeEvent.layout.height,expandable:e.nativeEvent.layout.height>this.props.collapsedHeight})}},{key:"_setMinHeight",value:function(e){this.setState({minHeight:e.nativeEvent.layout.height})}},{key:"toggle",value:function(){var e=Math.max(this.state.maxHeight+this.state.minHeight,this.props.collapsedHeight),t=Math.max(this.state.minHeight,this.props.collapsedHeight),n=this.state.expanded?e:t,r=this.state.expanded?t:e;this.setState({expanded:!this.state.expanded}),this.state.animation.setValue(n),d.Animated.timing(this.state.animation,{toValue:r,duration:50}).start()}},{key:"render",value:function(){var e=this.icons.down;return this.state.expanded&&(e=this.icons.up),u.default.createElement(d.Animated.View,{style:[p.container,{height:this.state.animation}]},u.default.createElement(d.TouchableHighlight,{underlayColor:"#f1f1f1",onLayout:this._setMinHeight.bind(this),onPress:this.state.expandable?this.toggle.bind(this):null},u.default.createElement(d.View,{style:p.titleContainer},u.default.createElement(d.Text,{style:p.title}," ",this.props.title," "),this.state.expandable&&u.default.createElement(d.Image,{style:p.buttonImage,source:e}))),u.default.createElement(d.View,{style:p.body,onLayout:this._setMaxHeight.bind(this)},this.props.children))}}]),t}(u.Component),p=d.StyleSheet.create({container:{backgroundColor:"#fff",margin:2,overflow:"hidden"},titleContainer:{flexDirection:"row"},title:{flex:1,padding:2,color:"#2a2f43",fontWeight:"bold"},button:{},buttonImage:{width:30,height:25},body:{padding:5,paddingTop:0,paddingBottom:20}}),_=f;t.default=_},185:function(e,t,n){var r=n(37),o=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(30)),a=o(n(25)),s=o(n(35)),l=o(n(38)),c=o(n(39)),u=o(n(40)),d=r(n(1)),f=n(10),p=(o(n(183)),n(184)),_=["Or specify if the ",d.default.createElement(f.Text,{style:{color:"darkorchid",textShadowRadius:3,textShadowColor:"darkorchid"}},"highlighted")," input is correct for the next step."],h=function(e){function t(e){return(0,a.default)(this,t),(0,l.default)(this,(0,c.default)(t).call(this,e))}return(0,u.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,t=this.props.interactions_state,n=function(e){return t&&t.matches?t.matches(e):p(e,{Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})};console.log("props",this.props);var r=function(t){console.log(t),console.log(e.props.callbacks),e.props.callbacks&&t in e.props.callbacks&&e.props.callbacks[t](),e.props.interactions_service.send(t)};return d.default.createElement(f.View,{style:g.container},d.default.createElement(f.View,{style:g.button_wrapper1},d.default.createElement(f.Text,{style:g.prompt1},n("Setting_Start_State")&&"Set the start state.",(n("Waiting_User_Feedback")||n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"}))&&"Demonstrate the next step.",n("Explantions_Displayed")&&"Press next to continue. Or demonstrate the next step.",n("Waiting_Select_Foci")&&"Select any interface elements that were used to compute this result.",n("Waiting_User_Attempt")&&"TUTOR MODE"),n("Waiting_Select_Foci")&&d.default.createElement(f.TouchableHighlight,{style:g.next_button,underlayColor:"#CCCCCC",onPress:function(){return r("FOCI_DONE")}},d.default.createElement(f.Text,{style:g.next_button_text},"Next")),n("Explantions_Displayed")&&d.default.createElement(f.TouchableHighlight,{style:g.next_button,underlayColor:"#CCCCCC",onPress:function(){return r("NEXT_PRESSED")}},d.default.createElement(f.Text,{style:g.next_button_text},"Next")),n("Setting_Start_State")&&d.default.createElement(f.TouchableHighlight,{style:g.startstate_button,underlayColor:"#CCCCCC",onPress:function(){return r("START_STATE_SET")}},d.default.createElement(f.Text,{style:g.startstate_button_text},"Start State Done"))),(n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})||n({Waiting_User_Feedback:"Waiting_Submit_Feedback"}))&&d.default.createElement(f.View,{style:g.button_wrapper2},d.default.createElement(f.Text,{style:g.prompt2},n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})&&_,n({Waiting_User_Feedback:"Waiting_Submit_Feedback"})&&"Or press submit to send the feedback from the skill panel."),n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})&&d.default.createElement(f.View,{style:g.yes_no},d.default.createElement(f.TouchableHighlight,{style:g.yes_button,underlayColor:"#CCCCCC",onPress:function(){return r("YES_PRESSED")}},d.default.createElement(f.Text,{style:g.yes_button_text},"YES")),d.default.createElement(f.TouchableHighlight,{style:g.no_button,underlayColor:"#CCCCCC",onPress:function(){return r("NO_PRESSED")}},d.default.createElement(f.Text,{style:g.no_button_text},"NO"))),n({Waiting_User_Feedback:"Waiting_Submit_Feedback"})&&d.default.createElement(f.TouchableHighlight,{style:g.submit_button,underlayColor:"#CCCCCC",onPress:function(){return r("SUBMIT_SKILL_FEEDBACK")}},d.default.createElement(f.Text,{style:g.submit_button_text},"Submit"))),!this.props.debugmode&&d.default.createElement(f.View,{style:g.button_wrapper3},d.default.createElement(f.TouchableHighlight,{style:g.nools_button,underlayColor:"#CCCCCC",onPress:function(){return e.props.app.changeInteractionMode({tutor_mode:!e.props.tutor_mode})}},d.default.createElement(f.Text,{style:g.nools_button_text},this.props.tutor_mode?"Train Mode":"Tutor Mode")),d.default.createElement(f.TouchableHighlight,{style:g.nools_button,underlayColor:"#CCCCCC",onPress:function(){return e.props.app.generateBehaviorProfile()}},d.default.createElement(f.Text,{style:g.nools_button_text},"Gen bProfile"))),this.props.debugmode&&d.default.createElement(f.View,{style:g.button_wrapper3},d.default.createElement(f.View,{style:{display:"absolute",bottom:0,flexDirection:"row"}},d.default.createElement(f.TouchableHighlight,{style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){return r("DEMONSTRATE")}},d.default.createElement(f.Text,{style:{fontSize:10}},"Demonstrate")),d.default.createElement(f.TouchableHighlight,(0,i.default)({style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){}},"onPress",function(){return r("DONE")}),d.default.createElement(f.Text,{style:{fontSize:10}},"Done")),d.default.createElement(f.TouchableHighlight,(0,i.default)({style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){}},"onPress",function(){return r("APPLICABLE_SKILLS_RECIEVED")}),d.default.createElement(f.Text,{style:{fontSize:10}},"Req recieved")))))}}]),t}(d.Component),g=f.StyleSheet.create({container:{flex:1,flexDirection:"column"},prompt1:{fontSize:20,textAlign:"center",margin:3,flexWrap:"wrap"},prompt2:{fontSize:20,textAlign:"center",margin:7,marginTop:25,marginBottom:12,flexWrap:"wrap"},button_wrapper1:{display:"flex",flexDirection:"column",alignItems:"center"},button_wrapper2:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:1},button_wrapper3:{display:"flex",flexDirection:"row",justifyContent:"space-around",padding:5,marginTop:"auto"},yes_no:{display:"flex",flexDirection:"row"},nools_button:{padding:5,width:100,backgroundColor:"#999999",borderRadius:5},nools_button_text:{textAlign:"center"},startstate_button:{position:"relative",width:200,backgroundColor:"#4CAF50",borderRadius:5,padding:5},startstate_button_text:{fontSize:20,textAlign:"center"},yes_button:{width:80,backgroundColor:"#4CAF50",borderRadius:6,margin:8,padding:4},yes_button_text:{fontSize:30,textAlign:"center"},no_button:{width:80,backgroundColor:"#f44336",borderRadius:6,margin:8,padding:4},no_button_text:{fontSize:30,textAlign:"center"},next_button:{width:100,backgroundColor:"#4CAFFF",borderRadius:6,margin:10,padding:5},next_button_text:{fontSize:35,textAlign:"center"},submit_button:{width:150,backgroundColor:"#4CAFFF",borderRadius:6,margin:10,padding:5},submit_button_text:{fontSize:30,textAlign:"center"},prompt_text:{textAlign:"center",fontSize:25}}),m=h;t.default=m},190:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(25)),i=r(n(430)),a=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512;(0,o.default)(this,e),this.promise=(0,i.default)().then(function(e){console.log("Module",e);var r=e.HEAPF64,o=e.HEAP32;t.input_ptr=e._malloc(2*n*r.BYTES_PER_ELEMENT);var i=t.input_ptr;t.output_ptr=e._malloc(2*n*r.BYTES_PER_ELEMENT);var a=t.output_ptr;t.ml_ptr=e._malloc(9*n*r.BYTES_PER_ELEMENT);var s=t.ml_ptr,l=new Float64Array(r.buffer,i,2*n),c=new Float64Array(r.buffer,a,2*n),u=new Float64Array(r.buffer,s,9*n);t.c_module=e,t.fitCurve=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,r=(t=t.flat()).length/2;l.set(t.flat());var o=e._c_FitCurve(i,r,n*n,a);e._c_ML_EncodeCurves(a,o,s);for(var u=[],d=c.entries(),f=function(){return Math.round(d.next().value[1])},p=0;p<o;p++)u[p]=[f(),f(),f(),f(),f(),f(),f(),f()];return u},t.fitCurveFeatures=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,r=(t=t.flat()).length/2;l.set(t.flat());var o=e._c_FitCurve(i,r,n*n,a);e._c_ML_EncodeCurves(a,o,s);for(var c=[],d=u.entries(),f=function(){return d.next().value[1]},p=0;p<o;p++)c[p]=[f(),f(),f(),f(),f(),f(),f(),f(),f()];return c},t.groupStrokes=function(t){t=Object.values(t);for(var n=e._malloc(t.length*o.BYTES_PER_ELEMENT),i=new Int32Array(o.buffer,n,t.length),a=[],s=[],l=0;l<t.length;l++){var c=t[l];a.push(c.points.length),s=s.concat(c.points)}i.set(a);var u=e._malloc(2*s.length*r.BYTES_PER_ELEMENT);new Float64Array(r.buffer,u,2*s.length).set(s.flat());var d=e._malloc(2*t.length*o.BYTES_PER_ELEMENT),f=new Int32Array(o.buffer,d,2*t.length),p=e._c_GroupStrokes(u,n,t.length,d,.1,.5,50),_=[],h=f.entries(),g=function(){return h.next().value[1]};for(l=0;l<p;l++){for(var m=g(),y=[],E=0;E<m;E++)y.push(t[g()].id);_.push(y)}return e._free(u),e._free(n),e._free(d),_}})};t.default=a},194:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.build_interactions_sm=S,t.default=void 0;var o=r(n(30)),i=r(n(58)),a=n(79);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var c=(0,a.assign)({start_state_history:function(e,t){var n=e.tutor.getState(),r=e.start_state_history||[];return r.push(n),r}}),u=(0,a.assign)({state:function(e,t){return null==e.staged_SAI||e.staged_SAI.reward>0||e.test_mode?e.tutor.getState():e.state}}),d=(0,a.assign)({staged_SAI:function(e,t){return(0,i.default)(e.staged_SAI,{foci_of_attention:e.tutor.getCurrentFoci()}),e.staged_SAI}});function f(e,t){var n=e.staged_SAI;return!(e.feedback_map&&Object.keys(e.feedback_map).length>0)&&("done"===n.selection&&(null==n.reward||n.reward>0||e.test_mode))}function p(e,t){var n=e.staged_SAI;return n.skipTraining&&n.reward<0||e.examples_only}function _(e,t){return e.free_author||!1}function h(e,t){return t.data>0}function g(e,t){return console.log("CCCC",e),!Object.keys(t.data).length||e.examples_only}function m(e,t){console.error(t.data)}function y(e,t){e.network_layer.kill_this(t.data.toString())}function E(e,t){e.app.setState({skill_panel_props:{skill_set:{"Applicable Skills":{}}}})}function b(e,t){e.app.setState({skill_panel_props:{skill_set:{"Applicable Skills":t.data.responses||{}}}})}var T=(0,a.send)(function(e,t){t.skill;var n=t.match,r=t.label,o=n._id,i=e.feedback_map||{},a=i[o]&&r===i[o]?null:r,s=l({},i);return null===a?delete s[o]:s[o]=a,{type:"FEEBACK_MAP_UPDATE",feedback_map:s,was_empty:0===Object.keys(i).length,now_empty:0===Object.keys(s).length}}),v=(0,a.assign)({feedback_map:function(e,t){return e.skill_panel.updateFeedbackMap&&e.skill_panel.updateFeedbackMap(t.feedback_map),e.tutor.updateFeedbackMap&&e.tutor.updateFeedbackMap(t.feedback_map),t.feedback_map}}),O=(0,a.send)(function(e,t){return!t.was_empty&&t.now_empty?(console.log("EMPTY"),{type:"SKILL_PANEL_FEEDBACK_EMPTY"}):t.was_empty&&!t.now_empty?(console.log("NOT EMPTY"),{type:"SKILL_PANEL_FEEDBACK_NONEMPTY"}):{type:""}});function S(e,t){var n,r={app:e,tutor:e.tutor.current,skill_panel:e.skill_panel.current,buttons:e.buttons.current,network_layer:e.network_layer,staged_SAI:null,action_type:null};return n=(r=l({},r,{},t)).tutor_mode?A:r.interactive?k:w,(0,a.Machine)(l({},{context:r},{},n),function(e){var t=e.tutor.current,n=(e.skill_panel.current,e.network_layer.current,e.network_layer);return{services:{sendFeedback:function(e,t){return e.staged_SAI.skipTraining||e.test_mode?Promise.resolve(!0):n.sendFeedback(e,t)},sendFeedbackExplicit:function(e,t){return n.sendFeedbackExplicit(e,t)},applyNextExample:t.applyNextExample,attemptStagedSAI:t.attemptStagedSAI,queryApprentice:n.queryApprentice,checkApprentice:n.checkApprentice},actions:{logError:m,stateRecalc:u,assignResponse:(0,a.assign)({response:function(e,t){return t.data}}),assignStagedSAI:(0,a.assign)({staged_SAI:function(e,t){return t.data}}),assignExample:(0,a.assign)({action_type:function(e,t){return"EXAMPLE"}}),assignAttempt:(0,a.assign)({action_type:function(e,t){return"ATTEMPT"}}),assignCorrect:(0,a.assign)({staged_SAI:function(e,t){return l({},e.staged_SAI,{},{reward:1})}}),assignIncorrect:(0,a.assign)({staged_SAI:function(e,t){return l({},e.staged_SAI,{},{reward:-1})}}),assignFoci:d,clearFeedbackData:(0,a.assign)(function(e,t){return{reward:null,staged_SAI:null,skill_applications:null,feedback_map:null}}),assignSkillApplications:(0,a.assign)({skill_applications:function(e,t){return t.data.responses||t.data.skill_applications}}),kill_this:y,printEvent:function(e,t){console.log("P_EVT:",t)},fillSkillPanel:b,clearSkillPanel:E,done:function(e,t){e.app.training_service.send("PROBLEM_DONE")},enterSetStartStateMode:t.enterSetStartStateMode,exitSetStartStateMode:t.exitSetStartStateMode,enterFeedbackMode:t.enterFeedbackMode,exitFeedbackMode:t.exitFeedbackMode,enterFociMode:t.enterFociMode,exitFociMode:t.exitFociMode,enterTutoringMode:t.enterTutoringMode,exitTutoringMode:t.exitTutoringMode,displayCorrectness:t.displayCorrectness,printFeedback:t.printFeedback,applyStagedSAI:function(e,n){t.applySAI(e.staged_SAI)},proposeSAI:function(e,n){return t.proposeSAI(n.data)},confirmProposedSAI:function(e,n){t.confirmProposedSAI()},clearProposedSAI:function(e,n){t.clearProposedSAI()},recalcFeedbackMap:T,assignFeedbackMap:v,toggleFeedbackStyle:O,generate_nools:n.generate_nools,appendStartHistory:c},guards:{saiIsCorrectDone:f,forceUseExample:p,noApplicableSkills:g,isFreeAuthor:_,checkIsCorrect:h}}}(e))}var w={initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":"Querying_Apprentice"}},Querying_Apprentice:{invoke:{id:"queryApprentice",src:"queryApprentice",onDone:[{target:"Applying_Next_Example",cond:"noApplicableSkills"},{target:"Applying_Staged_SAI",actions:["assignStagedSAI"]}],onError:"Fail"},exit:"assignResponse"},Applying_Staged_SAI:{invoke:{id:"attemptStagedSAI",src:"attemptStagedSAI",onDone:{target:"Sending_Feedback",actions:["assignStagedSAI","assignAttempt"]},onError:"Fail"}},Applying_Next_Example:{invoke:{id:"applyNextExample",src:"applyNextExample",onDone:{target:"Sending_Feedback",actions:["assignStagedSAI","assignExample"]},onError:"Fail"}},Sending_Feedback:{entry:"printFeedback",invoke:{id:"sendFeedback",src:"sendFeedback",onDone:[{target:"Done",cond:"saiIsCorrectDone"},{target:"Applying_Next_Example",cond:"forceUseExample"},{target:"Querying_Apprentice"}],onError:"Fail"},exit:["stateRecalc","assignResponse","clearFeedbackData"]},Done:{type:"final",entry:"done"},Fail:{entry:["logError","kill_this"]}}},k={id:"interactive",initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":[{target:"Setting_Start_State",cond:"isFreeAuthor"},{target:"Querying_Apprentice"}]}},Setting_Start_State:{entry:"enterSetStartStateMode",on:{START_STATE_SET:{target:"Querying_Apprentice",actions:["appendStartHistory"]}},exit:["exitSetStartStateMode","stateRecalc"]},Querying_Apprentice:{invoke:{id:"queryApprentice",src:"queryApprentice",onDone:[{target:"Waiting_User_Feedback.Waiting_Demonstrate_Only",cond:"noApplicableSkills",actions:["fillSkillPanel"]},{target:"Waiting_User_Feedback.Waiting_Yes_No_Feedback",actions:["fillSkillPanel","proposeSAI","assignStagedSAI"]}],onError:"Fail"},exit:"assignSkillApplications"},Waiting_User_Feedback:{entry:"enterFeedbackMode",initial:"Waiting_Demonstrate_Only",states:{Waiting_Demonstrate_Only:{},Waiting_Yes_No_Feedback:{on:{SKILL_PANEL_FEEDBACK_NONEMPTY:"Waiting_Submit_Feedback",YES_PRESSED:{target:"#interactive.Sending_Feedback",actions:["assignCorrect","assignAttempt","confirmProposedSAI"]},NO_PRESSED:{target:"#interactive.Sending_Feedback",actions:["assignIncorrect","assignAttempt","clearProposedSAI"]}}},Waiting_Submit_Feedback:{on:{SKILL_PANEL_FEEDBACK_EMPTY:"Waiting_Yes_No_Feedback",SUBMIT_SKILL_FEEDBACK:{target:"#interactive.Sending_Feedback",actions:["clearProposedSAI"]}}}},on:{STAGE_SAI:{actions:["assignStagedSAI","proposeSAI"]},TOGGLE_FEEDBACK:{actions:"recalcFeedbackMap"},FEEBACK_MAP_UPDATE:{actions:["assignFeedbackMap","toggleFeedbackStyle"]},DEMONSTRATE:{target:"Waiting_Select_Foci",actions:["assignStagedSAI","assignExample","printEvent","clearProposedSAI"]},GEN_NOOLS:{actions:["generate_nools"]}},exit:["exitFeedbackMode"]},Waiting_Select_Foci:{entry:"enterFociMode",on:{"":{target:"Sending_Feedback",actions:"assignFoci",cond:"saiIsCorrectDone"},FOCI_DONE:{target:"Sending_Feedback",actions:"assignFoci"}},exit:"exitFociMode"},Sending_Feedback:{entry:["printFeedback"],invoke:{id:"sendFeedback",src:"sendFeedback",onDone:[{target:"Done",cond:"saiIsCorrectDone"},{target:"Querying_Apprentice"}],onError:"Fail"},exit:["stateRecalc","assignResponse","clearFeedbackData"]},Done:{type:"final",entry:["clearSkillPanel","done"]},Fail:{entry:["logError","kill_this"]}}},A={id:"interactive",initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":[{target:"Setting_Start_State",cond:"isFreeAuthor"},{target:"Waiting_User_Attempt"}]}},Setting_Start_State:{entry:"enterSetStartStateMode",on:{START_STATE_SET:{target:"Waiting_User_Attempt",actions:["appendStartHistory"]}},exit:["exitSetStartStateMode","stateRecalc"]},Waiting_User_Attempt:{entry:["enterTutoringMode","stateRecalc"],on:{ATTEMPT:{target:"Checking_Against_Apprentice",actions:"assignStagedSAI"}},exit:"exitTutoringMode"},Checking_Against_Apprentice:{invoke:{id:"checkApprentice",src:"checkApprentice",onDone:[{cond:"saiIsCorrectDone",target:"Done",actions:["displayCorrectness","assignCorrect"]},{cond:"checkIsCorrect",target:"Waiting_User_Attempt",actions:["displayCorrectness","assignCorrect"]},{target:"Waiting_User_Attempt",actions:["displayCorrectness","assignIncorrect"]}]}},Done:{type:"final",entry:["clearSkillPanel","done"]}}},R=S;t.default=R},234:function(e,t,n){e.exports=n(235)},235:function(e,t,n){var r=n(37),o=n(9),i=o(n(58)),a=o(n(34)),s=o(n(30)),l=o(n(1)),c=o(n(48));n(242);o(n(128)),o(n(185));var u=r(n(403)),d=(n(79),o(n(411))),f=o(n(422)),p=o(n(458)),_=o(n(195));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var g={ctatttutor:d.default,ctat:d.default,stylustutor:f.default,stylus:f.default};function m(e){var t;try{t=JSON.parse(e)}catch(n){t=null}return t}var y,E=function(){var e=new URLSearchParams(window.location.search.substring(1));console.log(window.location.search),console.log(e);var t={AL_URL:e.get("al_url"),OUTER_LOOP_URL:e.get("outer_loop_url"),HOST_URL:window.location.origin,training_file:e.get("training"),interactive:m((e.get("interactive")||"").toLowerCase()),use_foci:m((e.get("use_foci")||"").toLowerCase()),tutor:e.get("tutor"),nools_dir:e.get("nools_dir")};return console.log("PROPS",t,e.get("interactive")),t}();E.training_file=E.training_file||"/stylus_author.json",(y=E.training_file,fetch(y).then(function(e){return e.text()}).then(function(e){return _.default.parse(e)})).then(function(e){var t=e.set_params;return(E=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,s.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{},function(e){var t={};return console.log(e),Object.keys(e).forEach(function(n){console.log(n),null!=e[n]&&(t[n]=e[n])}),t}(E))).tutor=(E.tutor||"ctat").toLowerCase().replace("_",""),E}).then(function(e){var t=g[e.tutor]||d.default;return console.log("TC",t,e.tutor),[e,t]}).then(function(e){var t=(0,a.default)(e,2),n=t[0],r=t[1];c.default.render(l.default.createElement(p.default,(0,i.default)({ref:function(e){window.react_interface=e},style:{height:"100%"},tutorClass:r},n)),document.getElementById("root"))}),u.unregister()},242:function(e,t,n){},401:function(e,t,n){e.exports=n.p+"static/media/Arrowhead-01-128.3fbf838f.png"},402:function(e,t,n){e.exports=n.p+"static/media/Arrowhead-Down-01-128.912d4e8d.png"},403:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.register=function(e){if("serviceWorker"in navigator){var t=new URL(".",window.location.href);if(t.origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");r?(!function(e,t){fetch(e).then(function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):o(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):o(t,e)})}},t.unregister=function(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})};var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function o(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}},411:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(41)),i=r(n(30)),a=r(n(58)),s=r(n(34)),l=r(n(25)),c=r(n(35)),u=r(n(38)),d=r(n(39)),f=r(n(60)),p=r(n(40)),_=r(n(1)),h=r(n(412)),g=r(n(82));n(10);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var E=n(417),b=n(83),T=n(421);function v(e,t){for(var n=!1,r=t.length-1;r>=0;r--){var o=t[r];e.classList.contains(o)&&(n=!0)}return n}var O=function(e){function t(e){var n;return(0,l.default)(this,t),n=(0,u.default)(this,(0,d.default)(t).call(this,e)),(0,g.default)((0,f.default)(n)),n.where_colors=["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],n.relative_pos_cache={},n.color_class_map={EXAMPLE:"CTAT--example",CORRECT:"CTAT--correct",INCORRECT:"CTAT--incorrect",HIGHLIGHT:"CTAT--AL_highlight",START_STATE:"CTAT--AL_start",ATTEMPT:"",DEFAULT:""},n.ctat_webview=_.default.createRef(),n.state={source:"../../examples/FracPreBake/FractionArithmetic/HTML/fraction_arithmetic.html?question_file=../mass_production/mass_production_brds/AD 5_9_plus_3_7.brd"},n.start_state_history=[],n.highlighted_elements=[],n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){console.log("THIS",this)}},{key:"componentDidUpdate",value:function(e,t){console.log("UPDATED",this.state),this.iframe=this.ctat_webview.current,this.init_callback||(this.init_callback=function(e){})}},{key:"getProblemName",value:function(){return this.problem_name}},{key:"loadProblem",value:function(e){var t=this,n=e.prob_obj,r=e.network_layer,o=e.interactive;return this.interactive=e.interactive,this.setState({source:{html:S}}),new Promise(function(i,l){var c=n.HTML.substring(n.HTML.lastIndexOf("/")+1).replace(".html",""),u=n.domain_name||c,d=n.HTML.replace(/\.\./g,"!u");b.isAbsolute(d)||(d=b.join(e.working_dir||"/",d));var f,p,_=void 0!=n.question_file&&"INTERACTIVE"!=n.question_file.toUpperCase(),h=n.abs_qf_paths||!1;_?(f=n.question_file.substring(n.question_file.lastIndexOf("/")+1).replace(".brd","").replace(".nools",""),p=!1):(f="FREE AUTHORING",p=!0),r.term_print("Starting Problem: "+f,"INFO");var g=(n.question_file||"").replace(/\.\./g,"!u");g=_?h?{question_file:e.network_layer.HOST_URL+g}:{question_file:g}:{question_file:"/host/empty.nools"},console.log("qf",g,o,n),!o&&g.question_file.includes(".nools")&&(console.log("BAD QF",g.question_file),r.kill_this("Got question_file: '"+g.question_file+"'. Question file cannot be nools in non-interactive mode. Use example tracing.")),t.problem_obj=n;var m={problem_name:f,dataset_level_name1:u,dataset_level_type1:"Domain",SessionLog:"true",Logging:"ClientToLogServer",log_service_url:window.location.origin,user_guid:e.agent_name,session_id:e.session_id};if("problem_context"in n&&(m.problem_context=n.problem_context),"custom_fields"in n){var y=n.custom_fields,T=!0,v=!1,O=void 0;try{for(var S,w=Object.keys(y).entries()["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(T=(S=w.next()).done);T=!0){var k=(0,s.default)(S.value,2),A=k[0],R=k[1];m["custom_field_name"+String(A)]=R,m["custom_field_value"+String(A)]=y[R]}}catch(D){v=!0,O=D}finally{try{T||null==w.return||w.return()}finally{if(v)throw O}}}var x=(0,a.default)({},g,m);t.HTML_PATH=d,t.init_callback=function(){i({updateContext:{free_author:p}})};var P=d+"?"+E.stringify(x);console.log("source",P),t.graph=null,t.commLibrary=null,t.hasConfig=null,t.setState({source:{uri:P},onLoad:t._triggerWhenInitialized,steps:n.only_step_ids?n.only_step_ids.flat():null,selections:n.only_Selections?n.only_Selections.flat():null})})}},{key:"_inject_element",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.iframe_content.document.createElement(e);for(var r in t)n.setAttribute(r,t[r]);this.iframe_content.document.getElementsByTagName("head")[0].appendChild(n)}},{key:"_triggerWhenInitialized",value:function(){var e=this;console.log("TRIGGER WHEN INITIALIZED"),this.iframe_content=this.iframe.frameRef.contentWindow;var t=this.iframe_content;if("undefined"==typeof t.CTAT||null==t.CTAT||"undefined"==typeof t.CTATCommShell||null==t.CTATCommShell||"undefined"==typeof t.CTATCommShell.commShell||null==t.CTATCommShell.commShell||"undefined"==typeof t.CTAT.ToolTutor||null==t.CTAT.ToolTutor||"undefined"==typeof t.CTAT.ToolTutor.tutor||null==t.CTAT.ToolTutor.tutor)return console.log("CTAT not defined yet..."),void window.setTimeout(function(){e._triggerWhenInitialized()},500);this.graph=t.CTAT.ToolTutor.tutor.getGraph()||!1,this.commLibrary=t.CTATCommShell.commShell.getCommLibrary(),this.hasConfig=void 0!=t.CTATConfiguration,(this.graph||this.interactive)&&this.commLibrary&&this.hasConfig?(this._inject_element("link",{href:"/host/css/AL_colors.css",type:"text/css",rel:"stylesheet"}),t.flashVars.setParams({deliverymode:"bleehhhh"}),this.CTAT_CORRECT=t.CTAT.Component.Base.Tutorable.EventType.correct,this.CTAT_INCORRECT=t.CTAT.Component.Base.Tutorable.EventType.incorrect,this.CTAT_ACTION=t.CTAT.Component.Base.Tutorable.EventType.action,console.log("CTAT INITIALIZED!"),this.init_callback(this)):(console.log("CTAT not initialized yet..."),window.setTimeout(function(){e._triggerWhenInitialized()},500))}},{key:"handle_user_set_state",value:function(e){var t=e.detail.sai,n=t.getSelection();""!=t.getInput()?(this.colorElement(n,"START_STATE"),this.start_state_elements.push(n)):(this.colorElement(n,"DEFAULT"),this.start_state_elements.includes(n)&&this.start_state_elements.remove(n))}},{key:"enterSetStartStateMode",value:function(){this.start_state_elements=[],this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handle_user_set_state)}},{key:"exitSetStartStateMode",value:function(){for(var e in this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handle_user_set_state),console.log("START DONE"),this.start_state_elements){var t=this.start_state_elements[e];this.iframe_content.document.getElementById(t).firstChild.value&&this.lockElement(t),this.colorElement(t,"DEFAULT")}this.start_state_history.push(this.getState())}},{key:"handleUserExample",value:function(e){this.handleUserInput(e,"EXAMPLE")}},{key:"handleUserAttempt",value:function(e){this.handleUserInput(e,"ATTEMPT")}},{key:"handleUserInput",value:function(e,t){var n=(r=e.detail.sai).getSelection();if("false"!=this.iframe_content.document.getElementById(n).firstChild.contentEditable){var r={selection:r.getSelection(),action:r.getAction(),inputs:{value:r.getInput()}};if(this.lockElement(n),this.colorElement(n,t),"EXAMPLE"==t)this.props.interactions_service.send({type:"DEMONSTRATE",data:y({},r,{reward:1})});else{if("ATTEMPT"!=t)throw"uknown type given";console.log("SEND ATTEMPT",r),this.props.interactions_service.send({type:"ATTEMPT",data:y({},r)})}}else console.log("BAIL")}},{key:"displayCorrectness",value:function(e,t){var n=e.staged_SAI.selection;1==t.data?this.colorElement(n,"CORRECT"):(this.colorElement(n,"INCORRECT"),this.unlockElement(n))}},{key:"printFeedback",value:function(e,t){var n=e.network_layer,r=e.staged_SAI,o=e.action_type;if(e.feedback_map&&0!==Object.keys(e.feedback_map).length)for(var i in e.feedback_map){var a=e.skill_applications[i];o=e.feedback_map[i].toUpperCase(),s=null!=a.inputs.value?a.inputs.value:"";n.term_print(o+": "+a.selection+" -> "+s,o)}else{"ATTEMPT"==o&&(o=r.reward>0?"CORRECT":"INCORRECT");var s=null!=r.inputs.value?r.inputs.value:"";n.term_print(o+": "+r.selection+" -> "+s,o)}}},{key:"_done_clicked_example",value:function(e){this.handleUserExample({detail:{sai:new this.iframe_content.CTATSAI("done","ButtonPressed","-1")}})}},{key:"enterFeedbackMode",value:function(){this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handleUserExample),this.iframe_content.document.getElementById("done").addEventListener("click",this._done_clicked_example)}},{key:"exitFeedbackMode",value:function(){this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handleUserExample),this.iframe_content.document.getElementById("done").removeEventListener("click",this._done_clicked_example)}},{key:"_done_clicked_attempt",value:function(e){this.handleUserAttempt({detail:{sai:new this.iframe_content.CTATSAI("done","ButtonPressed","-1")}})}},{key:"enterTutoringMode",value:function(){this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handleUserAttempt),this.iframe_content.document.getElementById("done").addEventListener("click",this._done_clicked_attempt)}},{key:"exitTutoringMode",value:function(){this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handleUserAttempt),this.iframe_content.document.getElementById("done").removeEventListener("click",this._done_clicked_attempt)}},{key:"handle_foci_select",value:function(e){console.log("FOCI SELECT!");var t=!0,n=!1,r=void 0;try{for(var o,i=e.path["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(t=(o=i.next()).done);t=!0){var a=o.value;if(console.log("EELE",a),void 0!=a.classList&&a.classList.contains("CTATComponent")){var s=this.current_foci.indexOf(a);-1==s?(this.current_foci.push(a),this.highlightElement(a.id,1)):(this.current_foci.splice(s,1),this.unhighlightElement(a.id)),console.log(this.current_foci);break}}}catch(l){n=!0,r=l}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"enterFociMode",value:function(){console.log("FOCI START!"),this.unhighlightAll(),this.current_foci=[],this.iframe_content.document.addEventListener("click",this.handle_foci_select)}},{key:"getCurrentFoci",value:function(){return this.current_foci?this.current_foci.map(function(e){return e.id}):[]}},{key:"exitFociMode",value:function(){this.unhighlightAll(),console.log("FOCI DONE!"),this.current_foci=[],this.iframe_content.document.removeEventListener("click",this.handle_foci_select)}},{key:"_shouldSkipTraining",value:function(e){if(!this.state.steps&&!this.state.selections)return!1;if(this.state.steps){var t=this.iframe_content.CTAT.ToolTutor.tutor.getTracer().getLastResult().getStepID();if(console.log("stepId:",t),this.state.steps.includes(t))return!1}return!this.state.selections||!this.state.selections.includes(e.selection)}},{key:"attemptStagedSAI",value:function(e,t){var n=this;return new Promise(function(t,r){var o=e.staged_SAI,i=n.iframe_content.document.getElementById(o.selection),a=n.CTAT_CORRECT,s=n.CTAT_INCORRECT,l=n._shouldSkipTraining,c=n.lockElement;function u(n){console.log("EVENT",n),console.log("EVENT",n.detail.sai.getTransactionID()),i.removeEventListener(a,u),i.removeEventListener(s,u),console.log("MOOOOOOOO",e),e.test_mode&&c(o.selection),t(y({},o,{reward:n.type==a?1:-1,skipTraining:l(o)}))}i.addEventListener(a,u),i.addEventListener(s,u),n.applySAI(o)})}},{key:"applyNextExample",value:function(e,t){var n=this;return new Promise(function(e,t){n.applyHint();var r=n.getDefaultSAI();n.colorElement(r.selection,"EXAMPLE"),n.applySAI(r),e(y({},r,{reward:1,skipTraining:n._shouldSkipTraining(r)}))})}},{key:"applySAI",value:function(e){var t=this.iframe_content.document.getElementById(e.selection);if("false"==(t["data-ctat-enabled"]||"true")){var n=new CustomEvent(this.CTAT_INCORRECT,{detail:{sai:e,component:t},bubbles:!0,cancelable:!0});t.dispatchEvent(n)}"ButtonPressed"==e.action&&(e.inputs={value:-1});var r=new(0,this.iframe_content.CTATSAI)(e.selection,e.action,e.inputs.value);this.iframe_content.CTATCommShell.commShell.processComponentAction(r,!0)}},{key:"lockElement",value:function(e){this.iframe_content.CTATShellTools.findComponent(e)[0].setEnabled(!1)}},{key:"unlockElement",value:function(e){this.iframe_content.CTATShellTools.findComponent(e)[0].setEnabled(!0)}},{key:"colorElement",value:function(e,t){var n=this.iframe_content.document.getElementById(e);n&&n.firstElementChild&&n.firstElementChild.setAttribute("class",this.color_class_map[t])}},{key:"highlightElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.unhighlightElement(e),this.iframe_content.document.getElementById(e.replace("?ele-","")).firstElementChild.classList.add("CTAT--AL_highlight"+t),this.highlighted_elements.push(e)}},{key:"unhighlightElement",value:function(e){if(this.highlighted_elements.includes(e)){for(var t=this.iframe_content.document.getElementById(e.replace("?ele-","")),n=(t.firstElementChild.classList.toString(),1);n<=this.where_colors.length;n++){var r="CTAT--AL_highlight"+n;t.firstElementChild.classList.contains(r)&&t.firstElementChild.classList.remove(r)}t.firstElementChild.classList.toString();var o=this.highlighted_elements.indexOf(e);o>-1&&this.highlighted_elements.splice(o,1)}}},{key:"clearElement",value:function(e){this.iframe_content.document.getElementById(e).firstElementChild.value=""}},{key:"highlightSAI",value:function(e){if(e.mapping){var t=0;for(var n in e.mapping){var r=e.mapping[n],o=1;"?sel"!=n&&(o=2+(t-1)%(this.where_colors.length-1)),this.highlightElement(r,o),t++}}else alert("RESPONSE IS MISSING FIELD:'mapping'")}},{key:"unhighlightAll",value:function(){for(var e=0,t=(0,o.default)(this.highlighted_elements);e<t.length;e++){var n=t[e];this.unhighlightElement(n)}}},{key:"getDefaultSAI",value:function(){var e=this.graph.getExampleTracer().getBestNextLink().getDefaultSAI();return e={selection:e.getSelection(),action:e.getAction(),inputs:{value:e.getInput()}}}},{key:"clearProposedSAI",value:function(){this.proposed_SAI&&(this.clearElement(this.proposed_SAI.selection),this.unlockElement(this.proposed_SAI.selection.replace("?ele-","")),this.unhighlightAll(),this.proposed_SAI=null)}},{key:"proposeSAI",value:function(e){this.clearProposedSAI(),this.proposed_SAI=y({},e),this.highlightSAI(e),this.stageSAI(e)}},{key:"stageSAI",value:function(e){var t=this.iframe_content.CTATShellTools.findComponent(e.selection)[0],n=new this.iframe_content.CTATSAI(e.selection,e.action,e.inputs.value);t.executeSAI(n),this.lockElement(e.selection)}},{key:"confirmProposedSAI",value:function(){this.proposed_SAI&&(this.unhighlightAll(),this.proposed_SAI=null)}},{key:"applyHint",value:function(){this.commLibrary.sendXML("<message><properties><MessageType>InterfaceAction</MessageType><Selection><value>hint</value></Selection><Action><value>ButtonPressed</value></Action><Input><value><![CDATA[hint request]]></value></Input></properties></message>")}},{key:"getState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.encode_relative,n=void 0===t||t,r=e.strip_offsets,o=void 0===r||r,i=e.use_offsets,l=void 0===i||i,c=e.use_class,u=void 0===c||c,d=e.use_id,f=void 0===d||d,p=e.append_ele,_=void 0!==p&&p,h=e.numeric_values,g=void 0!==h&&h,m=this.relative_pos_cache,y=this.HTML_PATH,E=this.iframe_content.$("div").toArray(),b={};if(T.each(E,function(e,t){if(j={},t.classList.contains("CTATComponent")&&!t.classList.contains("CTATTable")&&"CTATTextField"!=t.classList[0]){if(u&&(j.dom_class=t.classList[0]),l&&(j.offsetParent=t.offsetParent.dataset.silexId,j.offsetLeft=t.offsetLeft,j.offsetTop=t.offsetTop,j.offsetWidth=t.offsetWidth,j.offsetHeight=t.offsetHeight),f&&(j.id=t.id),v(t,["CTATTextInput","CTATComboBox","CTATTable--cell"])?(j.type="TextField",j.value=t.firstElementChild.value,g&&(j.value=Number(j.value)||j.value),j.contentEditable="true"==t.firstElementChild.contentEditable):v(t,["CTATButton"])&&(j.type="Button"),v(t,["CTATComboBox"])){j.type="ComboBox";for(var n=t.firstElementChild.options,r=[],o=0;o<n.length;o++)r.push(n[o].text);j.options=(0,a.default)({},r)}j.type||(j.type="Component");var i=(_?"?ele-":"")+t.id;b[i]=j,0}}),n){var O,S=Object.entries(b);if(y in m)O=m[y];else{O={};for(var w=0;w<S.length;w++)O[S[w][0]]={to_left:[],to_right:[],above:[],below:[]};for(w=0;w<S.length;w++)for(var k=0;k<S.length;k++)if(w!=k){var A=(0,s.default)(S[w],2),R=A[0],x=A[1],P=(0,s.default)(S[k],2),D=P[0],M=P[1];if(x.offsetTop>M.offsetTop&&x.offsetLeft<M.offsetLeft+M.offsetWidth&&x.offsetLeft+x.offsetWidth>M.offsetLeft){var I=x.offsetTop-M.offsetTop;O[R].above.push([D,I]),O[D].below.push([R,I])}if(x.offsetLeft<M.offsetLeft&&x.offsetTop+x.offsetHeight>M.offsetTop&&x.offsetTop<M.offsetTop+M.offsetHeight){I=M.offsetLeft-x.offsetLeft;O[R].to_right.push([D,I]),O[D].to_left.push([R,I])}}var C=function(e){return e[0]},F=function(e,t){return e[1]-t[1]};for(w=0;w<S.length;w++){(L=O[S[w][0]]).below=L.below.sort(F).map(C)[0]||"",L.above=L.above.sort(F).map(C)[0]||"",L.to_right=L.to_right.sort(F).map(C)[0]||"",L.to_left=L.to_left.sort(F).map(C)[0]||""}m[y]=O}for(w=0;w<S.length;w++){var j=b[S[w][0]],L=O[S[w][0]];j.below=L.below,j.above=L.above,j.to_right=L.to_right,j.to_left=L.to_left,o&&(delete j.offsetTop,delete j.offsetLeft,delete j.offsetWidth,delete j.offsetHeight),b[S[w][0]]=j}}return console.log("STATE JSON",b),b}},{key:"render",value:function(){return _.default.createElement(h.default,{ref:this.ctat_webview,originWhitelist:["*"],source:this.state.source,onLoad:this.state.onLoad})}}]),t}(_.default.Component),S='<!DOCTYPE html> <html><head><meta name="viewport" content="width=device-width, initial-scale=1"><style>.loader {  border: 16px solid #f3f3f3;  border-radius: 50%;  border-top: 16px solid #3498db;  width: 120px;  height: 120px;  -webkit-animation: spin 2s linear infinite; /* Safari */  animation: spin 2s linear infinite;  position: absolute;  left: 50%;  top: 50%;  transform: translate(-50%, -50%);*/}/* Safari */@-webkit-keyframes spin {  0% { -webkit-transform: rotate(0deg); }  100% { -webkit-transform: rotate(360deg); }}@keyframes spin {  0% { transform: rotate(0deg); }  100% { transform: rotate(360deg); }}</style></head><body><h2>How To Create A Loader</h2><div class="loader"></div></body></html>',w=O;t.default=w},422:function(e,t,n){var r=n(37),o=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(52)),a=o(n(53)),s=o(n(34)),l=o(n(0)),c=o(n(25)),u=o(n(35)),d=o(n(38)),f=o(n(39)),p=o(n(60)),_=o(n(40)),h=o(n(30)),g=o(n(41)),m=r(n(425)),y=o(n(1)),E=n(10),b=o(n(82)),T=o(n(190)),v=o(n(431));function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){(0,h.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var w=function(e,t){return Math.min.apply(Math,(0,g.default)(Object.values(t).map(function(t){return t.bounds[e]})))},k=function(e,t){return Math.max.apply(Math,(0,g.default)(Object.values(t).map(function(t){return t.bounds[e]})))},A=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0};function R(e,t){var n={};return Object.keys(e).forEach(function(r){t.includes(r)&&(n[r]=e[r])}),n}var x={pen_down:!1,strokes:{},active_elements:[],n_strokes:0,mode:"loading",check_button_callback:null,elmUnderPoint:null},P=function(e){function t(e){var n;return(0,c.default)(this,t),n=(0,d.default)(this,(0,f.default)(t).call(this,e)),(0,h.default)((0,p.default)(n),"state",S({},x,{},{strokes:{}})),(0,h.default)((0,p.default)(n),"onLayout",function(e){n.setState({width:e.nativeEvent.layout.width,height:e.nativeEvent.layout.height,x:e.nativeEvent.layout.x,y:e.nativeEvent.layout.y})}),(0,b.default)((0,p.default)(n)),n.BezierFit=new T.default,n.BezierFit.promise.then(function(){n.fitCurve=n.BezierFit.fitCurve,n.groupStrokes=n.BezierFit.groupStrokes,n.fitCurve([[1,2],[3,4],[5,6],[7,8]])}),n.StrokeClassifier=new v.default,n.StrokeClassifier.promise.then(function(){n.recognize_symbol=n.StrokeClassifier.recognize_symbol}),window.setMode=function(e){n.setState({mode:e})},n.where_colors=["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],n.mode_to_color={set_start_state:"START_STATE",demonstrate:"EXAMPLE",debug:"gray"},n.current_foci=[],n.start_state_history=[],n.highlighted_elements=[],n.elements={},n.groups=[],n}return(0,_.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){console.log("PROPSMODE",this.props.mode),this.setState({mode:this.props.mode||null})}},{key:"enterSetStartStateMode",value:function(){"debug"!=this.state.mode&&this.setState({mode:"set_start_state",check_button_callback:this.setStartState}),console.log("MODE!",this.state.mode)}},{key:"exitSetStartStateMode",value:function(){for(var e=this.state.n_strokes+this.state.pen_down,t={},n=0;n<e;n++){var r=this.state.strokes[n];"START_STATE"==r.evaluation&&(r.evaluation="TUTOR"),t[n]=r}this.setState({strokes:t,mode:null})}},{key:"enterFeedbackMode",value:function(){this.setState({mode:"feedback",check_button_callback:this.demonstrate,feedback_start_stroke_id:this.state.n_strokes})}},{key:"exitFeedbackMode",value:function(){this.setState({mode:null,check_button_callback:null,feedback_start_stroke_id:null})}},{key:"getCurrentFoci",value:function(){return this.current_foci?this.current_foci.map(function(e){return e.id}):[]}},{key:"enterFociMode",value:function(){this.unhighlightAll(),this.current_foci=[],this.setState({mode:"foci"})}},{key:"exitFociMode",value:function(){this.unhighlightAll(),this.current_foci=[],this.setState({mode:null})}},{key:"printFeedback",value:function(e,t){var n=e.network_layer,r=e.staged_SAI,o=e.action_type;if(e.feedback_map&&0!==Object.keys(e.feedback_map).length)for(var i in e.feedback_map){var a=e.skill_applications[i];o=e.feedback_map[i].toUpperCase(),s=null!=a.inputs.value?a.inputs.value:"";n.term_print(o+": "+a.selection+" -> "+s,o)}else{"ATTEMPT"==o&&(o=r.reward>0?"CORRECT":"INCORRECT");var s=null!=r.inputs.value?r.inputs.value:"";n.term_print(o+": "+r.selection+" -> "+s,o)}}},{key:"getCurrentFoci",value:function(){return this.current_foci?this.current_foci.map(function(e){return e.id}):[]}},{key:"loadProblem",value:function(e){return this.clear(),new Promise(function(e,t){e({updateContext:{}})})}},{key:"clear",value:function(){this.setState(S({},x,{},{strokes:{},active_elements:[]})),this.current_foci=[],this.start_state_history=[],this.highlighted_elements=[],this.elements={},this.groups=[]}},{key:"lockElement",value:function(e){var t=this.resolve_elm(t);t&&(t.locked=!0)}},{key:"unlockElement",value:function(e){var t=this.resolve_elm(t);t&&(t.locked=!1)}},{key:"colorElement",value:function(e,t){alert("NOT IMPLEMENTED")}},{key:"resolve_elm",value:function(e){return"string"==typeof e?e in this.elements?this.elements[e]:null:e}},{key:"highlightElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null!=(e=this.resolve_elm(e)))if("object"!=(0,l.default)(e)||"strokes"==e.type)for(var n=void 0==e.stroke_ids?[e]:e.stroke_ids,r=0;r<n.length;r++){var o=n[r];this.state.strokes[o].highlight=t,-1==this.highlighted_elements.indexOf(o)&&this.highlighted_elements.push(o)}else e.highlight=t,-1==this.highlighted_elements.indexOf(e.id)&&this.highlighted_elements.push(e.id)}},{key:"unhighlightElement",value:function(e){if(e=this.resolve_elm(e),console.log("UNHIGHTLIGHT",e.id,e,(0,l.default)(e)),null!=e)if("object"!=(0,l.default)(e)||"strokes"==e.type)for(var t=void 0==e.stroke_ids?[e]:e.stroke_ids,n=0;n<t.length;n++){var r,o=t[n];this.state.strokes[o].highlight=null,(r=this.highlighted_elements.indexOf(o))>-1&&this.highlighted_elements.splice(r,1)}else e.highlight=null,(r=this.highlighted_elements.indexOf(e.id))>-1&&this.highlighted_elements.splice(r,1)}},{key:"clearElement",value:function(e){}},{key:"highlightSAI",value:function(e){if(e.mapping){var t=0;for(var n in e.mapping){var r=e.mapping[n],o=0;"?sel"!=n&&(o=1+(t-1)%(this.where_colors.length-1)),this.highlightElement(r,o),t++}}else alert("IDK WHAT THIS IS")}},{key:"unhighlightAll",value:function(){for(var e=0,t=(0,g.default)(this.highlighted_elements);e<t.length;e++){var n=t[e];this.unhighlightElement(n)}}},{key:"getState",value:function(){for(var e={},t=0,n=Object.entries(this.elements);t<n.length;t++){var r,o=(0,s.default)(n[t],2),i=(o[0],o[1]);if("grid"==this.props.groupMode){var a=null!=i.value?i.value.toString():null;r={id:"e"+i.g_coords.x+"_"+i.g_coords.y,type:"Symbol",value:a,filled:""!=a&&null!=a};for(var l=i.g_coords,c=null,u=null,d=null,f=null,p=0,_=Object.entries(this.elements);p<_.length;p++){var h=(0,s.default)(_[p],2),g=(h[0],h[1]),m=g.g_coords;m.x==l.x-1&&(f=g.id),m.x==l.x+1&&(d=g.id),m.y==l.y-1&&(c=g.id),m.y==l.y+1&&(u=g.id)}r=S({},r,{},{to_left:f,to_right:d,above:c,below:u})}e[r.id]=r}var y=this.state.width/this.props.gridWidth,E=this.state.height/this.props.gridWidth;if("grid"==this.props.groupMode){for(var b=0;b<y;b++)for(var T=0;T<E;T++){(O="e"+b+"_"+T)in e||(e[O]={id:O,type:"Symbol",value:"",filled:!1})}var v=function(e){return e.toString()};for(b=0;b<y;b++)for(T=0;T<E;T++){var O;e[O="e"+v(b)+"_"+v(T)].to_left=b-1>=0?"e"+v(b-1)+"_"+v(T):null,e[O].to_right=b+1<y?"e"+v(b+1)+"_"+v(T):null,e[O].above=T-1>=0?"e"+v(b)+"_"+v(T-1):null,e[O].below=T+1<E?"e"+v(b)+"_"+v(T+1):null}}return e.done={id:"done",type:"OverlayButton"},console.log("STATE:",e),e}},{key:"clearProposedSAI",value:function(){this.proposed_SAI&&(this.unhighlightAll(),this.proposed_SAI=null,delete this.elements[this.staged_element])}},{key:"proposeSAI",value:function(e){console.log("PROPOSE",e),this.clearProposedSAI(),this.proposed_SAI=S({},e),this.stageSAI(e),this.highlightSAI(e),this.setState({active_elements:Object.keys(this.elements)})}},{key:"stageSAI",value:function(e){var t=e.selection.slice(1).split("_").map(function(e){return Number(e)}),n=(0,s.default)(t,2),r=n[0],o=n[1];console.log("STAGE",e,r,o);var i=this.props.gridWidth*(r+.5),a=this.props.gridWidth*(o-.2),l=.8*this.props.gridWidth,c={id:e.selection,g_coords:{x:r,y:o},value:e.inputs.value,type:"text",x:i,y:a+this.props.gridWidth,bounds:{minX:i-.5*l,minY:a,maxX:i+.5*l,maxY:a+l},fontSize:Math.floor(.8*this.props.gridWidth)};this.elements[c.id]=c,this.staged_element=c.id}},{key:"confirmProposedSAI",value:function(){console.log("confirmed",this.proposed_SAI,this.highlighted_elements),this.proposed_SAI&&(this.unhighlightAll(),this.proposed_SAI=null),this.setState()}},{key:"penDown",value:function(e){if("loading"!=this.state.mode)if("foci"!=this.state.mode){if(console.log("HERE",(0,l.default)(e.target.className),"svg_canvas"==e.target.className.baseVal||!1),console.log("PENDOWN"),"svg_canvas"==e.target.className.baseVal||"svg_canvas"==e.target.parentNode.className.baseVal){var t=this.state.strokes,n=Object.keys(t).length;t[n]={id:n},t[n].points_str=e.clientX.toString()+","+e.clientY.toString(),t[n].points=[[e.clientX,e.clientY]],t[n].bounds={minY:e.clientY,maxY:e.clientY,minX:e.clientX,maxX:e.clientX},console.log("MODE",this.state.mode),"set_start_state"==this.state.mode?t[n].evaluation="START_STATE":t[n].evaluation="ATTEMPT",this.setState({pen_down:!0,strokes:t})}}else this.mouseDown(e)}},{key:"snapStrokesToGrid",value:function(e){var t={},n=this.props.gridWidth;for(var r in e){var o=e[r].bounds,i=o.minX,a=o.maxX,s=o.minY,l=o.maxY,c=Math.floor(i/n),u=Math.ceil(a/n),d=Math.floor(s/n),f=Math.ceil(l/n);if(!(a-i>1.5*n||l-s>1.5*n)){for(var p=-1,_=-1,h=0,g=c;g<u;g++)for(var m=d;m<f;m++){var y=(Math.min(a,(g+1)*n)-Math.max(i,g*n)+1)*(Math.min(l,(m+1)*n)-Math.max(s,m*n)+1);y>h&&(h=y,p=g,_=m)}var E=p+"_"+_,b=t[E]||[];b.push(parseInt(r)),t[E]=b}}return[Object.values(t),t]}},{key:"removeElement",value:function(e){for(var t=0,n=Object.entries(this.elements);t<n.length;t++){var r=(0,s.default)(n[t],2),o=r[0],i=r[1];if(i.stroke_ids.length==e.length){for(var a=!0,l=0;l<i.stroke_ids.length;l++)if(i.stroke_ids[l]!==e[l]){a=!1;break}if(a)return void delete this.elements[o]}}this.setState({active_elements:Object.keys(this.elements)})}},{key:"addElement",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r={};if(r.stroke_ids=e,r.id="ie"+e.join("_"),r.strokes=e.map(function(e){return t.state.strokes[e]}),r.bounds={minX:w("minX",r.strokes),maxX:k("maxX",r.strokes),minY:w("minY",r.strokes),maxY:k("maxY",r.strokes)},r.type="strokes",n&&"grid"==this.props.groupMode){for(var o in n)if(A(n[o],e)){var i=o.split("_");r.g_coords={x:parseInt(i[0]),y:parseInt(i[1])}}r.id="e"+r.g_coords.x.toString()+"_"+r.g_coords.y.toString()}return console.log("BEFORE",Object.keys(this.elements),r),this.elements[r.id]=r,console.log("AFTER",this.elements,Object.keys(this.elements)),this.setState({active_elements:Object.keys(this.elements)}),r}},{key:"_elemsFromStrokes",value:function(e){for(var t=this,n=new Set,r=0;r<e.length;r++)for(var o=e[r],i="number"!=typeof o?o:this.state.strokes[o],a=0,l=Object.entries(this.elements);a<l.length;a++){var c=(0,s.default)(l[a],2),u=c[0],d=c[1];"strokes"==d.type&&-1!=d.stroke_ids.indexOf(i.id)&&n.add(u)}return Array.from(n).map(function(e){return t.elements[e]})}},{key:"_groupDiff",value:function(e,t){var n=e.map(function(e){return e.join(",")}),r=t.map(function(e){return e.join(",")}),o=r.filter(function(e){return!n.includes(e)}),i=n.filter(function(e){return!r.includes(e)});return[o.map(function(e){return e.split(",").map(function(e){return parseInt(e)})}),i.map(function(e){return e.split(",").map(function(e){return parseInt(e)})})]}},{key:"penUp",value:function(){var e=(0,a.default)(i.default.mark(function e(t){var n,r,o,a,l,c,u,d,f,p,_,h,g=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("penUP"),"loading"!=this.state.mode){e.next=3;break}return e.abrupt("return");case 3:if("foci"!=this.state.mode){e.next=6;break}return this.mouseUp(t),e.abrupt("return");case 6:for(console.log("UP",this.state.pen_down,Object.keys(this.elements)),this.state.pen_down&&this.setState({pen_down:!1,n_strokes:this.state.n_strokes+1}),"grid"==this.props.groupMode?(n=this.snapStrokesToGrid(this.state.strokes),r=(0,s.default)(n,2),o=r[0],a=r[1]):(l=this.groupStrokes(this.state.strokes),c=(0,s.default)(l,2),o=c[0],a=c[1]),u=this._groupDiff(this.groups||[],o),d=(0,s.default)(u,2),f=d[0],p=d[1],this.groups=o,_=0;_<p.length;_++)this.removeElement(p[_]);h=i.default.mark(function e(){var t,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f[_],n=g.addElement(t,a),console.time("recognize_symbol"),e.next=5,g.recognize_symbol(n.strokes);case 5:n.symbol_probs=e.sent,n.symbol_probs=R(n.symbol_probs,["1","2","3","4","5","6","7","8","9","0","+","-"]),console.timeEnd("recognize_symbol"),console.log("Recognize Symbol: "),Object.entries(n.symbol_probs).sort(function(e,t){return t[1]-e[1]}).forEach(function(e){var t=(0,s.default)(e,2),r=t[0],o=t[1];void 0==n.value&&(n.value=r),console.log(r.padStart(12),":",o.toFixed(3))});case 10:case"end":return e.stop()}},e)}),_=0;case 14:if(!(_<f.length)){e.next=19;break}return e.delegateYield(h(),"t0",16);case 16:_++,e.next=14;break;case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"penMove",value:function(e){if("foci"!=this.state.mode){if(this.state.pen_down){var t=this.state.strokes,n=t[this.state.n_strokes],r=[e.clientX,e.clientY],o=n.points[n.points.length-1];e.clientX<n.bounds.minX&&(n.bounds.minX=e.clientX),e.clientX>n.bounds.maxX&&(n.bounds.maxX=e.clientX),e.clientY<n.bounds.minY&&(n.bounds.minY=e.clientY),e.clientY>n.bounds.maxY&&(n.bounds.maxY=e.clientY),Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)>=16&&n.points.length<512&&(n.points.push(r),n.points_str+=" "+e.clientX.toString()+","+e.clientY.toString(),n.bezier_splines=this.fitCurve(n.points),this.setState({strokes:t}))}}else this.mouseMove(e)}},{key:"mouseMove",value:function(e){var t=this.getElementUnderPoint(e.clientX,e.clientY);this.setState({elmUnderPoint:t})}},{key:"mouseDown",value:function(e){console.log("MOUSE DOWN");var t=this.getElementUnderPoint(e.clientX,e.clientY);this.setState({mouseDownElm:t,elmUnderPoint:t})}},{key:"mouseUp",value:function(e){console.log("MOUSE UP");var t=this.getElementUnderPoint(e.clientX,e.clientY);if(t&&t==this.state.mouseDownElm){var n=this.current_foci.indexOf(t);-1==n?(this.current_foci.push(t),this.highlightElement(t,0)):(this.current_foci.splice(n,1),this.unhighlightElement(t))}this.setState({mouseDownElm:null,elmUnderPoint:t})}},{key:"getStokeUnderPoint",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=[],o=0;o<this.state.n_strokes;o++){var i=this.state.strokes[o];i&&e>i.bounds.minX-n&&e<i.bounds.maxX+n&&t>i.bounds.minY-n&&t<i.bounds.maxY+n&&r.push(i)}if(0==r.length)return null;for(var a,s=Number.MAX_VALUE,l=0,c=r;l<c.length;l++)for(var u=c[l],d=0;d<u.points.length;d++){var f=u.points[d],p=Math.pow(e-f[0],2)+Math.pow(t-f[1],2);p<s&&(s=p,a=u)}return a}},{key:"getElementUnderPoint",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=0,o=Object.entries(this.elements);r<o.length;r++){var i=(0,s.default)(o[r],2),a=i[0],l=i[1];if(console.log("ET:",a,l),e>l.bounds.minX-n&&e<l.bounds.maxX+n&&t>l.bounds.minY-n&&t<l.bounds.maxY+n)return l}return null}},{key:"undoStroke",value:function(e){var t=this.state.strokes;if(this.state.n_strokes>0){var n=t[this.state.n_strokes-1].evaluation;"INCORRECT"!=n&&"ATTEMPT"!=n&&"START_STATE"!=n||(delete t[this.state.n_strokes-1],this.setState({strokes:t,n_strokes:this.state.n_strokes-1}))}}},{key:"demonstrate",value:function(){for(var e=this,t=this.state.n_strokes,n=function(e,t){return Array(t-e).fill().map(function(t,n){return e+n})}(this.state.feedback_start_stroke_id,t).map(function(t){return e.state.strokes[t]}),r=0;r<n.length;r++)n[r].evaluation="DEMONSTRATE";var o=this._elemsFromStrokes(n);if(o.length>0){var i=o[0];this.props.interactions_service.send({type:"DEMONSTRATE",data:{selection:i.id,action:"WriteExpr",inputs:{value:i.value},reward:1}})}}},{key:"pressDone",value:function(){this.props.interactions_service.send({type:"DEMONSTRATE",data:{selection:"done",action:"ButtonPressed",inputs:{value:-1},reward:1}})}},{key:"getEvaluatable",value:function(){for(var e=0,t=this.state.n_strokes+this.state.pen_down;e<t;e++){var n=this.state.strokes[e].evaluation;if("ATTEMPT"==n||"INCORRECT"==n)break}console.log("hee",e);for(var r={};e<t;e++)r[e]=this.state.strokes[e];return r}},{key:"evaluate",value:function(){var e={};if(this.props.evaluate)e=this.props.evaluate(this.getEvaluatable());else for(var t in e=this.getEvaluatable())e[t].evaluation="INCORRECT";this.setState({strokes:S({},this.state.strokes,{},e)})}},{key:"render",value:function(){for(var e=[],t=0;t<this.state.n_strokes+this.state.pen_down;t++){var n=this.state.strokes[t],r=this.state.elmUnderPoint,o=r&&r.stroke_ids||[],i="debug"==this.state.mode?".5":-1!=o.indexOf(n.id)?"4":"3";if(null!=n.highlight&&(e.push(y.default.createElement(m.Polyline,{points:n.points_str,fill:"none",stroke:this.where_colors[n.highlight],strokeWidth:3*i+1,strokeOpacity:.15,strokeLinecap:"round"})),e.push(y.default.createElement(m.Polyline,{points:n.points_str,fill:"none",stroke:this.where_colors[n.highlight],strokeWidth:2*i,strokeOpacity:.4,strokeLinecap:"round"}))),n.points.length>1?e.push(y.default.createElement(m.Polyline,{points:n.points_str,fill:"none",stroke:D[n.evaluation]||D.DEFAULT,strokeWidth:i,strokeLinecap:"round"})):e.push(y.default.createElement(m.Circle,{cx:n.points[0][0],cy:n.points[0][1],r:1.5*i,fill:D[n.evaluation]||D.DEFAULT})),"debug"==this.state.mode){for(var a=n.bezier_splines||[],l=[],c=0;c<a.length;c++){var u="M"+(A=a[c])[0]+" "+A[1]+" C"+A[2]+" "+A[3]+" "+A[4]+" "+A[5]+" "+A[6]+" "+A[7]+" ";e.push(y.default.createElement(m.Path,{d:u,fill:"none",stroke:"blue",strokeWidth:"3",strokeLinecap:"round"})),l.push(y.default.createElement(m.Circle,{cx:A[0]+"",cy:A[1]+"",r:"3",fill:"red"}))}for(var d=n.points||[],f=0;f<d.length;f++){var p=d[f];l.push(y.default.createElement(m.Circle,{cx:p[0]+"",cy:p[1]+"",r:"1",fill:"red"}))}e=e.concat(l)}}for(var _,h=this.state.width,g=this.state.height,b=this.props.gridWidth||100,T=0;T<h/b;T++)e.push(y.default.createElement(m.Polyline,{points:T*b+",0 "+T*b+","+g,fill:"none",stroke:"gray",strokeWidth:".5",strokeOpacity:.4}));for(var v=0;v<g/b;v++)e.push(y.default.createElement(m.Polyline,{points:"0,"+v*b+" "+h+","+v*b,fill:"none",stroke:"gray",strokeWidth:".5",strokeOpacity:.4}));for(var O=0,S=Object.entries(this.elements);O<S.length;O++){var w=(0,s.default)(S[O],2),k=(w[0],w[1]),A=k.bounds;"done"!=k.id&&("text"==k.type?null!=k.highlight?(e.push(y.default.createElement(m.Text,{x:k.x,y:k.y,fontSize:k.fontSize,stroke:this.where_colors[k.highlight],strokeOpacity:.15,strokeWidth:k.fontSize/14+1,textAnchor:"middle"}," ",k.value.toString()," ")),e.push(y.default.createElement(m.Text,{x:k.x,y:k.y,fontSize:k.fontSize,stroke:this.where_colors[k.highlight],strokeOpacity:.45,strokeWidth:k.fontSize/20,textAnchor:"middle"}," ",k.value.toString()," "))):e.push(y.default.createElement(m.Text,{x:k.x,y:k.y,fontSize:k.fontSize,textAnchor:"middle"}," ",k.value.toString()," ")):"strokes"==k.type&&e.push(y.default.createElement(m.Rect,{x:A.minX,y:A.minY,width:A.maxX-A.minX,height:A.maxY-A.minY,stroke:"orange",strokeWidth:".5",fill:"none"})))}return _="foci"==this.state.mode?null==this.state.elmUnderPoint?"default":"pointer":M[this.state.mode]||M.null,y.default.createElement(E.TouchableWithoutFeedback,{onMouseDown:this.penDown,onMouseUp:this.penUp,onMouseLeave:this.penUp,onMouseMove:this.penMove,style:{height:"100%",width:"100%"}},y.default.createElement(E.View,{onLayout:this.onLayout,style:[E.StyleSheet.absoluteFill,{justifyContent:"center",height:"100%",width:"100%"}]},y.default.createElement(m.default,{className:"svg_canvas",style:{cursor:_},height:"100%",width:"100%"},y.default.createElement(m.Defs,null),e),"foci"!=this.state.mode&&"loading"!=this.state.mode&&y.default.createElement(E.View,null,y.default.createElement(E.TouchableHighlight,{style:[I.circle_buttons,I.undo_button],onPress:this.undoStroke},y.default.createElement(E.Text,{style:I.undo_button_text},"\u21b6")),"set_start_state"!=this.state.mode&&[y.default.createElement(E.TouchableHighlight,{style:[I.circle_buttons,I.check_button],onPress:this.state.check_button_callback},y.default.createElement(E.Text,{style:I.check_button_text},"\u2713")),y.default.createElement(E.TouchableHighlight,{style:[I.circle_buttons,I.done_button],onPress:this.pressDone},y.default.createElement(E.Text,{style:I.done_button_text},"Done"))])))}}]),t}(y.default.Component);t.default=P,P.defaultProps={gridWidth:100,groupMode:"grid"};var D={DEFAULT:"black",ATTEMPT:"slategray",TUTOR:"black",DEMONSTRATE:"dodgerblue",START_STATE:"teal",CORRECT:"limegreen",INCORRECT:"crimson"},M={debug:"crosshair",foci:"pointer",set_start_state:"crosshair",feedback:"crosshair",null:"progress",loading:"progress"},I=E.StyleSheet.create({circle_buttons:{position:"absolute",backgroundColor:"gray",borderRadius:60,height:60,width:60,justifyContent:"center",alignItems:"center",zIndex:1,shadowColor:"#000",shadowOffset:{width:2,height:2},shadowOpacity:.8,shadowRadius:2},undo_button:{bottom:50,right:120},undo_button_text:{fontSize:40},check_button:{bottom:50,right:50},check_button_text:{fontSize:40},done_button:{bottom:50,left:50,width:80,height:40},done_button_text:{fontSize:24}})},430:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(0)),i=function(e){var t,n="undefined"!==typeof(e=e||{})?e:{};n.ready=new Promise(function(e,n){t=e}),Object.getOwnPropertyDescriptor(n.ready,"_c_FitCurve")||(Object.defineProperty(n.ready,"_c_FitCurve",{configurable:!0,get:function(){K("You are getting _c_FitCurve on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_c_FitCurve",{configurable:!0,set:function(){K("You are setting _c_FitCurve on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_c_ML_EncodeCurves")||(Object.defineProperty(n.ready,"_c_ML_EncodeCurves",{configurable:!0,get:function(){K("You are getting _c_ML_EncodeCurves on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_c_ML_EncodeCurves",{configurable:!0,set:function(){K("You are setting _c_ML_EncodeCurves on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_c_GroupStrokes")||(Object.defineProperty(n.ready,"_c_GroupStrokes",{configurable:!0,get:function(){K("You are getting _c_GroupStrokes on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_c_GroupStrokes",{configurable:!0,set:function(){K("You are setting _c_GroupStrokes on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_malloc")||(Object.defineProperty(n.ready,"_malloc",{configurable:!0,get:function(){K("You are getting _malloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_malloc",{configurable:!0,set:function(){K("You are setting _malloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_free")||(Object.defineProperty(n.ready,"_free",{configurable:!0,get:function(){K("You are getting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_free",{configurable:!0,set:function(){K("You are setting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_stackSave")||(Object.defineProperty(n.ready,"_stackSave",{configurable:!0,get:function(){K("You are getting _stackSave on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_stackSave",{configurable:!0,set:function(){K("You are setting _stackSave on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_stackRestore")||(Object.defineProperty(n.ready,"_stackRestore",{configurable:!0,get:function(){K("You are getting _stackRestore on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_stackRestore",{configurable:!0,set:function(){K("You are setting _stackRestore on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_stackAlloc")||(Object.defineProperty(n.ready,"_stackAlloc",{configurable:!0,get:function(){K("You are getting _stackAlloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_stackAlloc",{configurable:!0,set:function(){K("You are setting _stackAlloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"___data_end")||(Object.defineProperty(n.ready,"___data_end",{configurable:!0,get:function(){K("You are getting ___data_end on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"___data_end",{configurable:!0,set:function(){K("You are setting ___data_end on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"___wasm_call_ctors")||(Object.defineProperty(n.ready,"___wasm_call_ctors",{configurable:!0,get:function(){K("You are getting ___wasm_call_ctors on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"___wasm_call_ctors",{configurable:!0,set:function(){K("You are setting ___wasm_call_ctors on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"___errno_location")||(Object.defineProperty(n.ready,"___errno_location",{configurable:!0,get:function(){K("You are getting ___errno_location on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"___errno_location",{configurable:!0,set:function(){K("You are setting ___errno_location on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"_setThrew")||(Object.defineProperty(n.ready,"_setThrew",{configurable:!0,get:function(){K("You are getting _setThrew on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"_setThrew",{configurable:!0,set:function(){K("You are setting _setThrew on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(n.ready,"onRuntimeInitialized")||(Object.defineProperty(n.ready,"onRuntimeInitialized",{configurable:!0,get:function(){K("You are getting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(n.ready,"onRuntimeInitialized",{configurable:!0,set:function(){K("You are setting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}));var r,i={};for(r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);var a=[],s="./this.program",l=!0,c=!1;if(n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var u,d="";if(!l&&!c)throw new Error("environment detection error");if(c?d=self.location.href:document.currentScript&&(d=document.currentScript.src),d=0!==(d="/dist/").indexOf("blob:")?d.substr(0,d.lastIndexOf("/")+1):"","object"!==("undefined"===typeof window?"undefined":(0,o.default)(window))&&"function"!==typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");c&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)});var f=n.print||console.log.bind(console),p=n.printErr||console.warn.bind(console);for(r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);function _(e){_.shown||(_.shown={}),_.shown[e]||(_.shown[e]=1,p(e))}i=null,n.arguments&&(a=n.arguments),Object.getOwnPropertyDescriptor(n,"arguments")||Object.defineProperty(n,"arguments",{configurable:!0,get:function(){K("Module.arguments has been replaced with plain arguments_ (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),n.thisProgram&&(s=n.thisProgram),Object.getOwnPropertyDescriptor(n,"thisProgram")||Object.defineProperty(n,"thisProgram",{configurable:!0,get:function(){K("Module.thisProgram has been replaced with plain thisProgram (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),n.quit&&n.quit,Object.getOwnPropertyDescriptor(n,"quit")||Object.defineProperty(n,"quit",{configurable:!0,get:function(){K("Module.quit has been replaced with plain quit_ (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),b("undefined"===typeof n.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),b("undefined"===typeof n.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),b("undefined"===typeof n.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),b("undefined"===typeof n.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),b("undefined"===typeof n.read,"Module.read option was removed (modify read_ in JS)"),b("undefined"===typeof n.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),b("undefined"===typeof n.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),b("undefined"===typeof n.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),b("undefined"===typeof n.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),Object.getOwnPropertyDescriptor(n,"read")||Object.defineProperty(n,"read",{configurable:!0,get:function(){K("Module.read has been replaced with plain read_ (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),Object.getOwnPropertyDescriptor(n,"readAsync")||Object.defineProperty(n,"readAsync",{configurable:!0,get:function(){K("Module.readAsync has been replaced with plain readAsync (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),Object.getOwnPropertyDescriptor(n,"readBinary")||Object.defineProperty(n,"readBinary",{configurable:!0,get:function(){K("Module.readBinary has been replaced with plain readBinary (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),Object.getOwnPropertyDescriptor(n,"setWindowTitle")||Object.defineProperty(n,"setWindowTitle",{configurable:!0,get:function(){K("Module.setWindowTitle has been replaced with plain setWindowTitle (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}});var h,g,m=function(e){};n.wasmBinary&&(h=n.wasmBinary),Object.getOwnPropertyDescriptor(n,"wasmBinary")||Object.defineProperty(n,"wasmBinary",{configurable:!0,get:function(){K("Module.wasmBinary has been replaced with plain wasmBinary (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),n.noExitRuntime&&n.noExitRuntime,Object.getOwnPropertyDescriptor(n,"noExitRuntime")||Object.defineProperty(n,"noExitRuntime",{configurable:!0,get:function(){K("Module.noExitRuntime has been replaced with plain noExitRuntime (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),"object"!==("undefined"===typeof WebAssembly?"undefined":(0,o.default)(WebAssembly))&&K("No WebAssembly support found. Build with -s WASM=0 to target JavaScript instead.");var y=new WebAssembly.Table({initial:354,maximum:354,element:"anyfunc"}),E=!1;function b(e,t){e||K("Assertion failed: "+t)}var T,v,O,S,w,k="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function A(e,t,n){for(var r=t+n,o=t;e[o]&&!(o>=r);)++o;if(o-t>16&&e.subarray&&k)return k.decode(e.subarray(t,o));for(var i="";t<o;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if(224==(240&a)?a=(15&a)<<12|s<<6|l:(240!=(248&a)&&_("Invalid UTF-8 leading byte 0x"+a.toString(16)+" encountered when deserializing a UTF-8 string on the asm.js/wasm heap to a JS string!"),a=(7&a)<<18|s<<12|l<<6|63&e[t++]),a<65536)i+=String.fromCharCode(a);else{var c=a-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function R(e,t){return e?A(O,e,t):""}function x(e,t,n,r){if(!(r>0))return 0;for(var o=n,i=n+r-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;s>=2097152&&_("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to an UTF-8 string on the asm.js/wasm heap! (Valid unicode code points should be in range 0-0x1FFFFF)."),t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-o}function P(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}function D(e,t){b(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),v.set(e,t)}function M(e,t,n){for(var r=0;r<e.length;++r)b(e.charCodeAt(r)===e.charCodeAt(r)&255),v[t++>>0]=e.charCodeAt(r);n||(v[t>>0]=0)}"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");var I=21584,C=21424;b(!0,"stack must start aligned"),b(!0,"heap must start aligned"),n.TOTAL_STACK&&b(5242880===n.TOTAL_STACK,"the stack size can no longer be determined at runtime");var F,j=n.INITIAL_MEMORY||16777216;function L(){b(0==(3&I)),w[1+(I>>2)]=34821223,w[2+(I>>2)]=2310721022,S[0]=1668509029}function U(){var e=w[1+(I>>2)],t=w[2+(I>>2)];34821223==e&&2310721022==t||K("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+t.toString(16)+" "+e.toString(16)),1668509029!==S[0]&&K("Runtime error: The application has corrupted its heap memory area (address zero)!")}function N(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"===typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t(n)}}Object.getOwnPropertyDescriptor(n,"INITIAL_MEMORY")||Object.defineProperty(n,"INITIAL_MEMORY",{configurable:!0,get:function(){K("Module.INITIAL_MEMORY has been replaced with plain INITIAL_INITIAL_MEMORY (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),b(j>=5242880,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+j+"! (TOTAL_STACK=5242880)"),b("undefined"!==typeof Int32Array&&"undefined"!==typeof Float64Array&&void 0!==Int32Array.prototype.subarray&&void 0!==Int32Array.prototype.set,"JS engine does not provide full typed array support"),(g=n.wasmMemory?n.wasmMemory:new WebAssembly.Memory({initial:j/65536,maximum:j/65536}))&&(T=g.buffer),b((j=T.byteLength)%65536===0),T=F=T,n.HEAP8=v=new Int8Array(F),n.HEAP16=new Int16Array(F),n.HEAP32=S=new Int32Array(F),n.HEAPU8=O=new Uint8Array(F),n.HEAPU16=new Uint16Array(F),n.HEAPU32=w=new Uint32Array(F),n.HEAPF32=new Float32Array(F),n.HEAPF64=new Float64Array(F),S[C>>2]=5264464,function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian!"}();var X=[],H=[],W=[],Y=[],B=[],Q=!1,G=!1;b(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),b(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),b(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),b(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),Math.abs,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.atan2,Math.exp,Math.log,Math.sqrt,Math.ceil,Math.floor,Math.pow,Math.imul,Math.fround,Math.round,Math.min,Math.max,Math.clz32,Math.trunc;var z=0,V=null,q=null,J={};function K(e){throw n.onAbort&&n.onAbort(e),f(e+=""),p(e),E=!0,e="abort("+e+") at "+function(){var e=function(){var e=new Error;if(!e.stack){try{throw new Error}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}();return n.extraStackTrace&&(e+="\n"+n.extraStackTrace()),e.replace(/\b_Z[\w\d_]+/g,function(e){var t,n=(t=e,_("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===n?e:n+" ["+e+"]"})}(),new WebAssembly.RuntimeError(e)}n.preloadedImages={},n.preloadedAudios={};var Z={error:function(){K("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with  -s FORCE_FILESYSTEM=1")},init:function(){Z.error()},createDataFile:function(){Z.error()},createPreloadedFile:function(){Z.error()},createLazyFile:function(){Z.error()},open:function(){Z.error()},mkdev:function(){Z.error()},registerDevice:function(){Z.error()},analyzePath:function(){Z.error()},loadFilesFromDB:function(){Z.error()},ErrnoError:function(){Z.error()}};function $(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}n.FS_createDataFile=Z.createDataFile,n.FS_createPreloadedFile=Z.createPreloadedFile;var ee="data:application/octet-stream;base64,";function te(e){return $(e,ee)}function ne(e,t){return function(){var r=e,o=t;return t||(o=n.asm),b(Q,"native function `"+r+"` called before runtime initialization"),b(!G,"native function `"+r+"` called after runtime exit (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),o[e]||b(o[e],"exported native function `"+r+"` not found"),o[e].apply(null,arguments)}}var re,oe="bezier_fit.wasm";function ie(){try{if(h)return new Uint8Array(h);if(u)return u(oe);throw"both async and sync fetching of the wasm failed"}catch(p){K(p)}}te(oe)||(re=oe,oe=n.locateFile?n.locateFile(re,d):d+re),H.push({func:function(){Ee()}});var ae={};function se(){return se.uncaught_exceptions>0}var le={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=le.buffers[e];b(n),0===t||10===t?((1===e?f:p)(A(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return b(void 0!=le.varargs),le.varargs+=4,S[le.varargs-4>>2]},getStr:function(e){return R(e)},get64:function(e,t){return b(e>=0?0===t:-1===t),e}},ce={};function ue(){if(!ue.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"===typeof navigator?"undefined":(0,o.default)(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var t in ce)e[t]=ce[t];var n=[];for(var t in e)n.push(t+"="+e[t]);ue.strings=n}return ue.strings}function de(e){return e%4===0&&(e%100!==0||e%400===0)}function fe(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var pe=[31,29,31,30,31,30,31,31,30,31,30,31],_e=[31,28,31,30,31,30,31,31,30,31,30,31];function he(e,t){for(var n=new Date(e.getTime());t>0;){var r=de(n.getFullYear()),o=n.getMonth(),i=(r?pe:_e)[o];if(!(t>i-n.getDate()))return n.setDate(n.getDate()+t),n;t-=i-n.getDate()+1,n.setDate(1),o<11?n.setMonth(o+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}function ge(e,t,n,r){var o=S[r+40>>2],i={tm_sec:S[r>>2],tm_min:S[r+4>>2],tm_hour:S[r+8>>2],tm_mday:S[r+12>>2],tm_mon:S[r+16>>2],tm_year:S[r+20>>2],tm_wday:S[r+24>>2],tm_yday:S[r+28>>2],tm_isdst:S[r+32>>2],tm_gmtoff:S[r+36>>2],tm_zone:o?R(o):""},a=R(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in s)a=a.replace(new RegExp(l,"g"),s[l]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,n){for(var r="number"===typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function f(e,t){return d(e,t,"0")}function p(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function _(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function h(e){var t=he(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),o=_(n),i=_(r);return p(o,t)<=0?p(i,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return u[e.tm_mon].substring(0,3)},"%B":function(e){return u[e.tm_mon]},"%C":function(e){return f((e.tm_year+1900)/100|0,2)},"%d":function(e){return f(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return h(e).toString().substring(2)},"%G":function(e){return h(e)},"%H":function(e){return f(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),f(t,2)},"%j":function(e){return f(e.tm_mday+fe(de(e.tm_year+1900)?pe:_e,e.tm_mon-1),3)},"%m":function(e){return f(e.tm_mon+1,2)},"%M":function(e){return f(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return f(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),n=0===t.getDay()?t:he(t,7-t.getDay()),r=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(p(n,r)<0){var o=fe(de(r.getFullYear())?pe:_e,r.getMonth()-1)-31,i=31-n.getDate()+o+r.getDate();return f(Math.ceil(i/7),2)}return 0===p(n,t)?"01":"00"},"%V":function(e){var t,n=new Date(e.tm_year+1900,0,4),r=new Date(e.tm_year+1901,0,4),o=_(n),i=_(r),a=he(new Date(e.tm_year+1900,0,1),e.tm_yday);return p(a,o)<0?"53":p(i,a)<=0?"01":(t=o.getFullYear()<e.tm_year+1900?e.tm_yday+32-o.getDate():e.tm_yday+1-o.getDate(),f(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),n=1===t.getDay()?t:he(t,0===t.getDay()?1:7-t.getDay()+1),r=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(p(n,r)<0){var o=fe(de(r.getFullYear())?pe:_e,r.getMonth()-1)-31,i=31-n.getDate()+o+r.getDate();return f(Math.ceil(i/7),2)}return 0===p(n,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in g)a.indexOf(l)>=0&&(a=a.replace(new RegExp(l,"g"),g[l](i)));var m=function(e,t,n){var r=n>0?n:P(e)+1,o=new Array(r),i=x(e,o,0,o.length);return t&&(o.length=i),o}(a,!1);return m.length>t?0:(D(m,e),m.length-1)}var me,ye={__cxa_allocate_exception:function(e){return be(e)},__cxa_atexit:function(e,t){return n=e,r=t,_("atexit() called, but EXIT_RUNTIME is not set, so atexits() will not be called. set EXIT_RUNTIME to 1 (see the FAQ)"),void Y.unshift({func:n,arg:r});var n,r},__cxa_throw:function(e,t,n){throw ae[e]={ptr:e,adjusted:[e],type:t,destructor:n,refcount:0,caught:!1,rethrown:!1},"uncaught_exception"in se?se.uncaught_exceptions++:se.uncaught_exceptions=1,e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."},__handle_stack_overflow:function(){K("stack overflow")},__map_file:function(e,t){var n;return n=63,S[ve()>>2]=n,-1},__sys_munmap:function(e,t){return function(e,t){if(-1===(0|e)||0===t)return-28;var n=le.mappings[e];return n?(t===n.len&&(b(32&le.mappings[e].flags),le.mappings[e]=null,n.allocated&&Te(n.malloc)),0):0}(e,t)},abort:function(){K()},emscripten_get_sbrk_ptr:function(){return 21424},emscripten_memcpy_big:function(e,t,n){O.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){!function(e){K("Cannot enlarge memory arrays to size "+e+" bytes (OOM). Either (1) compile with  -s INITIAL_MEMORY=X  with X higher than the current value "+v.length+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}(e>>>=0)},environ_get:function(e,t){var n=0;return ue().forEach(function(r,o){var i=t+n;S[e+4*o>>2]=i,M(r,i),n+=r.length+1}),0},environ_sizes_get:function(e,t){var n=ue();S[e>>2]=n.length;var r=0;return n.forEach(function(e){r+=e.length+1}),S[t>>2]=r,0},fd_close:function(e){return K("it should not be possible to operate on streams when !SYSCALLS_REQUIRE_FILESYSTEM"),0},fd_read:function(e,t,n,r){var o=le.getStreamFromFD(e),i=le.doReadv(o,t,n);return S[r>>2]=i,0},fd_seek:function(e,t,n,r,o){K("it should not be possible to operate on streams when !SYSCALLS_REQUIRE_FILESYSTEM")},fd_write:function(e,t,n,r){for(var o=0,i=0;i<n;i++){for(var a=S[t+8*i>>2],s=S[t+(8*i+4)>>2],l=0;l<s;l++)le.printChar(e,O[a+l]);o+=s}return S[r>>2]=o,0},memory:g,setTempRet0:function(e){m(0|e)},strftime_l:function(e,t,n,r){return ge(e,t,n,r)},table:y},Ee=(function(){var e,t={env:ye,wasi_snapshot_preview1:ye};function r(e,t){var r=e.exports;n.asm=r,function(e){if(z--,n.monitorRunDependencies&&n.monitorRunDependencies(z),e?(b(J[e]),delete J[e]):p("warning: run dependency removed without ID"),0==z&&(null!==V&&(clearInterval(V),V=null),q)){var t=q;q=null,t()}}("wasm-instantiate")}e="wasm-instantiate",z++,n.monitorRunDependencies&&n.monitorRunDependencies(z),e?(b(!J[e]),J[e]=1,null===V&&"undefined"!==typeof setInterval&&(V=setInterval(function(){if(E)return clearInterval(V),void(V=null);var e=!1;for(var t in J)e||(e=!0,p("still waiting on run dependencies:")),p("dependency: "+t);e&&p("(end of list)")},1e4))):p("warning: run dependency added without ID");var o=n;function i(e){b(n===o,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),o=null,r(e.instance)}function a(e){return(h||!l&&!c||"function"!==typeof fetch?new Promise(function(e,t){e(ie())}):fetch(oe,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+oe+"'";return e.arrayBuffer()}).catch(function(){return ie()})).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(e){p("failed to asynchronously prepare wasm: "+e),K(e)})}if(n.instantiateWasm)try{return n.instantiateWasm(t,r)}catch(s){return p("Module.instantiateWasm callback failed with error: "+s),!1}!function(){if(h||"function"!==typeof WebAssembly.instantiateStreaming||te(oe)||"function"!==typeof fetch)return a(i);fetch(oe,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(i,function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),a(i)})})}()}(),n.___wasm_call_ctors=ne("__wasm_call_ctors")),be=n._malloc=ne("malloc"),Te=n._free=ne("free"),ve=(n._c_GroupStrokes=ne("c_GroupStrokes"),n._c_ML_EncodeCurves=ne("c_ML_EncodeCurves"),n._c_FitCurve=ne("c_FitCurve"),n.___errno_location=ne("__errno_location"));function Oe(e){function r(){me||(me=!0,n.calledRun=!0,E||(U(),b(!Q),Q=!0,N(H),U(),N(W),t(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),b(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(U(),n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),B.unshift(e);var e;N(B)}()))}e=e||a,z>0||(L(),function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),X.unshift(e);var e;N(X)}(),z>0||(n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),r()},1)):r(),U()))}if(n._setThrew=ne("setThrew"),n.stackSave=ne("stackSave"),n.stackRestore=ne("stackRestore"),n.stackAlloc=ne("stackAlloc"),n.___set_stack_limit=ne("__set_stack_limit"),n.__growWasmMemory=ne("__growWasmMemory"),n.dynCall_iii=ne("dynCall_iii"),n.dynCall_ii=ne("dynCall_ii"),n.dynCall_vi=ne("dynCall_vi"),n.dynCall_vii=ne("dynCall_vii"),n.dynCall_iiii=ne("dynCall_iiii"),n.dynCall_viijii=ne("dynCall_viijii"),n.dynCall_viiii=ne("dynCall_viiii"),n.dynCall_jiji=ne("dynCall_jiji"),n.dynCall_iidiiii=ne("dynCall_iidiiii"),n.dynCall_iiiii=ne("dynCall_iiiii"),n.dynCall_iiiiii=ne("dynCall_iiiiii"),n.dynCall_iiiiiiiii=ne("dynCall_iiiiiiiii"),n.dynCall_iiiiiii=ne("dynCall_iiiiiii"),n.dynCall_iiiiij=ne("dynCall_iiiiij"),n.dynCall_iiiiid=ne("dynCall_iiiiid"),n.dynCall_iiiiijj=ne("dynCall_iiiiijj"),n.dynCall_iiiiiiii=ne("dynCall_iiiiiiii"),n.dynCall_iiiiiijj=ne("dynCall_iiiiiijj"),n.dynCall_viiiiii=ne("dynCall_viiiiii"),n.dynCall_v=ne("dynCall_v"),n.dynCall_viiiii=ne("dynCall_viiiii"),Object.getOwnPropertyDescriptor(n,"intArrayFromString")||(n.intArrayFromString=function(){K("'intArrayFromString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"intArrayToString")||(n.intArrayToString=function(){K("'intArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ccall")||(n.ccall=function(){K("'ccall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"cwrap")||(n.cwrap=function(){K("'cwrap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setValue")||(n.setValue=function(){K("'setValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getValue")||(n.getValue=function(){K("'getValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"allocate")||(n.allocate=function(){K("'allocate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getMemory")||(n.getMemory=function(){K("'getMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"UTF8ArrayToString")||(n.UTF8ArrayToString=function(){K("'UTF8ArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF8ToString")||(n.UTF8ToString=function(){K("'UTF8ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF8Array")||(n.stringToUTF8Array=function(){K("'stringToUTF8Array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF8")||(n.stringToUTF8=function(){K("'stringToUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF8")||(n.lengthBytesUTF8=function(){K("'lengthBytesUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackTrace")||(n.stackTrace=function(){K("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPreRun")||(n.addOnPreRun=function(){K("'addOnPreRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnInit")||(n.addOnInit=function(){K("'addOnInit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPreMain")||(n.addOnPreMain=function(){K("'addOnPreMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnExit")||(n.addOnExit=function(){K("'addOnExit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPostRun")||(n.addOnPostRun=function(){K("'addOnPostRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeStringToMemory")||(n.writeStringToMemory=function(){K("'writeStringToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeArrayToMemory")||(n.writeArrayToMemory=function(){K("'writeArrayToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeAsciiToMemory")||(n.writeAsciiToMemory=function(){K("'writeAsciiToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addRunDependency")||(n.addRunDependency=function(){K("'addRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"removeRunDependency")||(n.removeRunDependency=function(){K("'removeRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createFolder")||(n.FS_createFolder=function(){K("'FS_createFolder' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createPath")||(n.FS_createPath=function(){K("'FS_createPath' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createDataFile")||(n.FS_createDataFile=function(){K("'FS_createDataFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createPreloadedFile")||(n.FS_createPreloadedFile=function(){K("'FS_createPreloadedFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createLazyFile")||(n.FS_createLazyFile=function(){K("'FS_createLazyFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createLink")||(n.FS_createLink=function(){K("'FS_createLink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createDevice")||(n.FS_createDevice=function(){K("'FS_createDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_unlink")||(n.FS_unlink=function(){K("'FS_unlink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"dynamicAlloc")||(n.dynamicAlloc=function(){K("'dynamicAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"loadDynamicLibrary")||(n.loadDynamicLibrary=function(){K("'loadDynamicLibrary' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"loadWebAssemblyModule")||(n.loadWebAssemblyModule=function(){K("'loadWebAssemblyModule' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getLEB")||(n.getLEB=function(){K("'getLEB' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getFunctionTables")||(n.getFunctionTables=function(){K("'getFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"alignFunctionTables")||(n.alignFunctionTables=function(){K("'alignFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"registerFunctions")||(n.registerFunctions=function(){K("'registerFunctions' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addFunction")||(n.addFunction=function(){K("'addFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"removeFunction")||(n.removeFunction=function(){K("'removeFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getFuncWrapper")||(n.getFuncWrapper=function(){K("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"prettyPrint")||(n.prettyPrint=function(){K("'prettyPrint' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"makeBigInt")||(n.makeBigInt=function(){K("'makeBigInt' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"dynCall")||(n.dynCall=function(){K("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getCompilerSetting")||(n.getCompilerSetting=function(){K("'getCompilerSetting' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"print")||(n.print=function(){K("'print' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"printErr")||(n.printErr=function(){K("'printErr' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getTempRet0")||(n.getTempRet0=function(){K("'getTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setTempRet0")||(n.setTempRet0=function(){K("'setTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"callMain")||(n.callMain=function(){K("'callMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"abort")||(n.abort=function(){K("'abort' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToNewUTF8")||(n.stringToNewUTF8=function(){K("'stringToNewUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"abortOnCannotGrowMemory")||(n.abortOnCannotGrowMemory=function(){K("'abortOnCannotGrowMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"emscripten_realloc_buffer")||(n.emscripten_realloc_buffer=function(){K("'emscripten_realloc_buffer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ENV")||(n.ENV=function(){K("'ENV' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ERRNO_CODES")||(n.ERRNO_CODES=function(){K("'ERRNO_CODES' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ERRNO_MESSAGES")||(n.ERRNO_MESSAGES=function(){K("'ERRNO_MESSAGES' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setErrNo")||(n.setErrNo=function(){K("'setErrNo' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"DNS")||(n.DNS=function(){K("'DNS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"GAI_ERRNO_MESSAGES")||(n.GAI_ERRNO_MESSAGES=function(){K("'GAI_ERRNO_MESSAGES' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"Protocols")||(n.Protocols=function(){K("'Protocols' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"Sockets")||(n.Sockets=function(){K("'Sockets' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UNWIND_CACHE")||(n.UNWIND_CACHE=function(){K("'UNWIND_CACHE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"readAsmConstArgs")||(n.readAsmConstArgs=function(){K("'readAsmConstArgs' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"jstoi_q")||(n.jstoi_q=function(){K("'jstoi_q' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"jstoi_s")||(n.jstoi_s=function(){K("'jstoi_s' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"abortStackOverflow")||(n.abortStackOverflow=function(){K("'abortStackOverflow' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"reallyNegative")||(n.reallyNegative=function(){K("'reallyNegative' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"formatString")||(n.formatString=function(){K("'formatString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"PATH")||(n.PATH=function(){K("'PATH' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"PATH_FS")||(n.PATH_FS=function(){K("'PATH_FS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"SYSCALLS")||(n.SYSCALLS=function(){K("'SYSCALLS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"syscallMmap2")||(n.syscallMmap2=function(){K("'syscallMmap2' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"syscallMunmap")||(n.syscallMunmap=function(){K("'syscallMunmap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"flush_NO_FILESYSTEM")||(n.flush_NO_FILESYSTEM=function(){K("'flush_NO_FILESYSTEM' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"JSEvents")||(n.JSEvents=function(){K("'JSEvents' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"specialHTMLTargets")||(n.specialHTMLTargets=function(){K("'specialHTMLTargets' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"demangle")||(n.demangle=function(){K("'demangle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"demangleAll")||(n.demangleAll=function(){K("'demangleAll' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"jsStackTrace")||(n.jsStackTrace=function(){K("'jsStackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackTrace")||(n.stackTrace=function(){K("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getEnvStrings")||(n.getEnvStrings=function(){K("'getEnvStrings' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"checkWasiClock")||(n.checkWasiClock=function(){K("'checkWasiClock' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeI53ToI64")||(n.writeI53ToI64=function(){K("'writeI53ToI64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeI53ToI64Clamped")||(n.writeI53ToI64Clamped=function(){K("'writeI53ToI64Clamped' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeI53ToI64Signaling")||(n.writeI53ToI64Signaling=function(){K("'writeI53ToI64Signaling' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeI53ToU64Clamped")||(n.writeI53ToU64Clamped=function(){K("'writeI53ToU64Clamped' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeI53ToU64Signaling")||(n.writeI53ToU64Signaling=function(){K("'writeI53ToU64Signaling' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"readI53FromI64")||(n.readI53FromI64=function(){K("'readI53FromI64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"readI53FromU64")||(n.readI53FromU64=function(){K("'readI53FromU64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"convertI32PairToI53")||(n.convertI32PairToI53=function(){K("'convertI32PairToI53' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"convertU32PairToI53")||(n.convertU32PairToI53=function(){K("'convertU32PairToI53' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"Browser")||(n.Browser=function(){K("'Browser' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"GL")||(n.GL=function(){K("'GL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"emscriptenWebGLGet")||(n.emscriptenWebGLGet=function(){K("'emscriptenWebGLGet' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"emscriptenWebGLGetTexPixelData")||(n.emscriptenWebGLGetTexPixelData=function(){K("'emscriptenWebGLGetTexPixelData' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"emscriptenWebGLGetUniform")||(n.emscriptenWebGLGetUniform=function(){K("'emscriptenWebGLGetUniform' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"emscriptenWebGLGetVertexAttrib")||(n.emscriptenWebGLGetVertexAttrib=function(){K("'emscriptenWebGLGetVertexAttrib' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"AL")||(n.AL=function(){K("'AL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"SDL_unicode")||(n.SDL_unicode=function(){K("'SDL_unicode' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"SDL_ttfContext")||(n.SDL_ttfContext=function(){K("'SDL_ttfContext' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"SDL_audio")||(n.SDL_audio=function(){K("'SDL_audio' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"SDL")||(n.SDL=function(){K("'SDL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"SDL_gfx")||(n.SDL_gfx=function(){K("'SDL_gfx' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"GLUT")||(n.GLUT=function(){K("'GLUT' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"EGL")||(n.EGL=function(){K("'EGL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"GLFW_Window")||(n.GLFW_Window=function(){K("'GLFW_Window' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"GLFW")||(n.GLFW=function(){K("'GLFW' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"GLEW")||(n.GLEW=function(){K("'GLEW' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"IDBStore")||(n.IDBStore=function(){K("'IDBStore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"runAndAbortIfError")||(n.runAndAbortIfError=function(){K("'runAndAbortIfError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"warnOnce")||(n.warnOnce=function(){K("'warnOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackSave")||(n.stackSave=function(){K("'stackSave' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackRestore")||(n.stackRestore=function(){K("'stackRestore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackAlloc")||(n.stackAlloc=function(){K("'stackAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"AsciiToString")||(n.AsciiToString=function(){K("'AsciiToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToAscii")||(n.stringToAscii=function(){K("'stringToAscii' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF16ToString")||(n.UTF16ToString=function(){K("'UTF16ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF16")||(n.stringToUTF16=function(){K("'stringToUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF16")||(n.lengthBytesUTF16=function(){K("'lengthBytesUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF32ToString")||(n.UTF32ToString=function(){K("'UTF32ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF32")||(n.stringToUTF32=function(){K("'stringToUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF32")||(n.lengthBytesUTF32=function(){K("'lengthBytesUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"allocateUTF8")||(n.allocateUTF8=function(){K("'allocateUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"allocateUTF8OnStack")||(n.allocateUTF8OnStack=function(){K("'allocateUTF8OnStack' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.writeStackCookie=L,n.checkStackCookie=U,Object.getOwnPropertyDescriptor(n,"ALLOC_NORMAL")||Object.defineProperty(n,"ALLOC_NORMAL",{configurable:!0,get:function(){K("'ALLOC_NORMAL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_STACK")||Object.defineProperty(n,"ALLOC_STACK",{configurable:!0,get:function(){K("'ALLOC_STACK' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_DYNAMIC")||Object.defineProperty(n,"ALLOC_DYNAMIC",{configurable:!0,get:function(){K("'ALLOC_DYNAMIC' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_NONE")||Object.defineProperty(n,"ALLOC_NONE",{configurable:!0,get:function(){K("'ALLOC_NONE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),q=function e(){me||Oe(),me||(q=e)},n.run=Oe,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Oe(),e.ready};t.default=i},431:function(e,t,n){var r=n(37),o=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(0)),a=o(n(34)),s=o(n(52)),l=o(n(53)),c=o(n(25)),u=r(n(432)),d=n(455),f=o(n(190)),p=["!","(",")","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9","=","A","B","C","E","F","G","H","I","L","M","N","P","R","S","T","V","X","Y","[","\\Delta","\\alpha","\\beta","\\cos","\\div","\\exists","\\forall","\\gamma","\\geq","\\gt","\\in","\\infty","\\int","\\lambda","\\ldots","\\leq","\\lim","\\log","\\lt","\\mu","\\neq","\\phi","\\pi","\\pm","\\prime","\\rightarrow","\\sigma","\\sin","\\sqrt","\\sum","\\tan","\\theta","\\times","\\{","\\}","]","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","|"];t.default=function e(){var t=this;(0,c.default)(this,e),(0,d.setWasmPath)("/dist/tfjs-backend-wasm.wasm");var n=u.setBackend("wasm");this.BezierFit=new f.default,this.BezierFit.promise.then(function(){t.fitCurve=t.BezierFit.fitCurve,t.fitCurveFeatures=t.BezierFit.fitCurveFeatures,t.groupStrokes=t.BezierFit.groupStrokes}),this.promise=Promise.all([n,this.BezierFit.promise,this.model_promise]).then((0,l.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.loadLayersModel("/dist/danny_modeljs/model.json").then(function(e){t.model=e});case 2:t.model_promise=e.sent;case 3:case"end":return e.stop()}},e)}))).then(function(){t.normalize_strokes=function(e){console.log("STROKES",e);for(var t=24e8,n=24e8,r=-24e8,o=-24e8,i=[],a=0;a<e.length;a++){i.push([]);for(var s=0;s<e[a].length;s++)t=Math.min(t,e[a][s][0]),n=Math.min(n,e[a][s][1]),i[a].push([e[a][s][0],e[a][s][1]])}for(a=0;a<e.length;a++)for(s=0;s<e[a].length;s++)i[a][s][0]-=t,i[a][s][1]-=n,r=Math.max(r,i[a][s][0]),o=Math.max(o,i[a][s][1]);for(console.log(t,r,n,o),a=0;a<e.length;a++)for(s=0;s<e[a].length;s++)i[a][s][0]/=Math.min(r,o)/100,i[a][s][1]/=Math.min(r,o)/100;return i},t.recognize_symbol=function(e){var n=[],r=(e.length,!0),o=!1,s=void 0;try{for(var l,c=e["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(r=(l=c.next()).done);r=!0){var d=l.value;"object"===(0,i.default)(d)&&null!=d&&n.push(d.points)}}catch(k){o=!0,s=k}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}n=t.normalize_strokes(n),console.log("normed",n);var f=[],_=!0,h=!1,g=void 0;try{for(var m,y=n["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(_=(m=y.next()).done);_=!0){d=m.value,t.fitCurve(d);var E=!0,b=!1,T=void 0;try{for(var v,O=t.fitCurveFeatures(d)["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(E=(v=O.next()).done);E=!0){var S=v.value;console.log("feats",S),f.push(S)}}catch(k){b=!0,T=k}finally{try{E||null==O.return||O.return()}finally{if(b)throw T}}}}catch(k){h=!0,g=k}finally{try{_||null==y.return||y.return()}finally{if(h)throw g}}console.log("curve_features",f);var w=u.tensor([f],DocumentType=u.float32);return t.model.predict(w).array().then(function(e){for(var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.map(function(e,t){return[e,t]}).sort(function(e,t){return t[0]-e[0]});return t&&(n=n.slice(0,t)),[n.map(function(e){return e[0]}),n.map(function(e){return e[1]})]}(e[0],10),n=(0,a.default)(t,2),r=n[0],o=n[1],i={},s=0;s<r.length;s++)i[p[o[s]]]=r[s];return i})}})}},436:function(e,t){},437:function(e,t){},438:function(e,t){},442:function(e,t){},443:function(e,t){},444:function(e,t){},453:function(e,t){},456:function(e,t){},457:function(e,t){},458:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(58)),i=r(n(25)),a=r(n(35)),s=r(n(38)),l=r(n(39)),c=r(n(60)),u=r(n(40)),d=r(n(128)),f=r(n(185)),p=n(194),_=n(459),h=r(n(550)),g=n(79),m=r(n(82)),y=(r(n(83)),r(n(233))),E=r(n(1)),b=r(n(551)),T=n(10);var v=function(e){function t(e){var n;if((0,i.default)(this,t),n=(0,s.default)(this,(0,l.default)(t).call(this,e)),(0,m.default)((0,c.default)(n)),n.onInteractionTransition=n.onInteractionTransition.bind((0,c.default)(n)),n.network_layer=new h.default(e.AL_URL,e.HOST_URL,e.OUTER_LOOP_URL),null==e.working_dir&&null!=e.training_file){var r=e.training_file.match(/(.*)[\/\\]/);e.working_dir=r?r[1]:""}return n.tutor=E.default.createRef(),n.skill_panel=E.default.createRef(),n.buttons=E.default.createRef(),n.state={default_props:{},buttons_props:{app:(0,c.default)(n)},tutor_props:n.props.tutor_props||{},skill_panel_props:{},training_description:"????",agent_description:"????",problem_description:"????",interactive:n.props.interactive,free_author:n.props.free_author,tutor_mode:n.props.tutor_mode},n}return(0,u.default)(t,e),(0,a.default)(t,[{key:"onInteractionTransition",value:function(e){console.log("#",e.value,":",e.context,e);var t={interactions_state:e,interactions_service:this.interactions_service};this.setState({default_props:t,Interactions_Machine_State:e.value})}},{key:"onTrainingTransition",value:function(e){var t=e.context;console.log("&",e),this.setState({Training_Machine_State:e.value}),t.interactive||this.setState({training_description:t.training_description||"???",agent_description:t.agent_description||"???",problem_description:t.problem_description||"???"})}},{key:"changeInteractionMode",value:function(e){this.setState(e)}},{key:"componentDidUpdate",value:function(e,t){var n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return console.log(n),Object.keys(t).reduce(function(r,o){return e[o]===t[o]||null!=n&&!n.includes(o)||(r[o]=t[o]),r},{})}(t,this.state,["interactive","free_author","tutor_mode"]);Object.keys(n).length>0&&(console.log("componentDidUpdate",n),this.training_service.send({type:"CHANGE_INTERACTION_MODE",data:n}))}},{key:"componentDidMount",value:function(){var e,t,n=this;console.log("MOUNTED");var r=[this.tutor.current,this.network_layer,this.props.working_dir,this.props.training_file];e=r[2],t=r[3],this.interactions_sm=(0,p.build_interactions_sm)(this,(0,y.default)(this.props,_.problem_props)),this.interactions_service=null,this.training_machine=(0,_.build_training_sm)(this,this.interactions_sm,t,e),this.training_service=(0,g.interpret)(this.training_machine),this.training_service.onTransition(this.onTrainingTransition),this.training_service.start();this.training_service.subscribe(function(e){console.log("SUBSCRIBE:",e)});console.log("T MACHINE!",this.training_service),window.setTutorMode=function(e){n.changeInteractionMode({tutor_mode:e})},window.setInteractive=function(e){n.changeInteractionMode({interactive:e})},window.setFreeAuthor=function(e){n.changeInteractionMode({free_author:e})},window.generateBehaviorProfile=this.generateBehaviorProfile}},{key:"generateBehaviorProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/ground_truth.json",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.network_layer.generateBehaviorProfile,r=this.training_service._state.context;if(null!=e){return"/"!=e[0]&&(e=(r.working_dir||"/")+e),fetch(e).then(function(e){return e.text()}).then(function(e){return e.split("\n")}).then(function(e){return function(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,a=e["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(n=(i=a.next()).done);n=!0){var s=i.value;if(""!=s){var l=JSON.parse(s);t.push(l)}}}catch(c){r=!0,o=c}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return t}(e)}).then(function(e){return n(r,{data:{requests:e,out_dir:t}})})}return n(r)}},{key:"render",value:function(){var e,t,n=this.props.tutorClass;this.state.interactive?e=E.default.createElement(T.View,{style:O.controls},!this.state.tutor_mode&&E.default.createElement(T.View,{style:O.skill_panel},E.default.createElement(d.default,(0,o.default)({ref:this.skill_panel},this.state.default_props,this.state.skill_panel_props))),E.default.createElement(T.View,{style:O.buttons},E.default.createElement(f.default,(0,o.default)({ref:this.buttons},this.state.default_props,this.state.buttons_props,{tutor_mode:this.state.tutor_mode})))):(t=this.state.training_description+"\n"+this.state.agent_description+"\n"+this.state.problem_description+"\n",e=E.default.createElement(T.View,{style:O.prompt},E.default.createElement(T.Text,null,t)));return console.log("TRANING MACHINE STATE",this.state.Training_Machine_State),E.default.createElement(T.View,{style:O.container},E.default.createElement(T.View,{style:O.ctat_tutor},"Creating_Agent"==this.state.Training_Machine_State&&E.default.createElement(T.View,{style:O.overlay},E.default.createElement(b.default,{color:"#000000",size:150,visible:!0,textContent:"Loading...",textStyle:O.spinnerTextStyle})),E.default.createElement(n,(0,o.default)({ref:this.tutor,id:"tutor_iframe",interactive:!1},this.state.default_props,this.state.tutor_props))),e)}}]),t}(E.default.Component);t.default=v;var O=T.StyleSheet.create({spinnerTextStyle:{color:"#000000"},overlay:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:"rgba(50, 50, 50, 0.3)",flex:1,justifyContent:"center",alignItems:"center"},overlay_text:{textAlign:"center"},container:{flex:1,flexDirection:"column"},ctat_tutor:{margin:4,flexBasis:"65%",flex:1},prompt:{flex:1,textAlign:"center"},controls:{flex:1,flexBasis:"35%",flexDirection:"row"},skill_panel:{flex:1,flexBasis:"60%"},buttons:{flexGrow:1,flexDirection:"column",flexBasis:"40%",justifySelf:"space-around"}})},459:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.build_training_sm=function(e,t){var n=e.network_layer,r={app:e,tutor:e.tutor.current,skill_panel:e.skill_panel.current,buttons:e.buttons.current,network_layer:e.network_layer,interactive:e.props.interactive,training_file:e.props.training_file,working_dir:e.props.working_dir,interactions_sm:t,file_params:null,agent_params:null,prob_obj:null};return r=g({},E,{},r),(0,c.Machine)({context:r,initial:"Loading_Training_File",states:{Loading_Training_File:{invoke:{id:"load_training_file",src:"load_training_file",onDone:{target:"Serving_Training_Sets",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Serving_Training_Sets:{invoke:{id:"serve_next_training_set",src:"serve_next_training_set",onDone:[{target:"All_Done",cond:"iteratorEmpty"},{target:"Serving_Agents",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Serving_Agents:{invoke:{id:"serve_next_agent",src:"serve_next_agent",onDone:[{target:"Serving_Training_Sets",cond:"iteratorEmpty"},{target:"Creating_Agent",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Creating_Agent:{invoke:{id:"create_agent",src:"create_agent",onDone:{target:"Handling_Prior_Knowledge",actions:"assignAgentId"},onError:{target:"Fail",actions:"logError"}}},Handling_Prior_Knowledge:{invoke:{id:"handle_prior_knowledge",src:"handle_prior_knowledge",onDone:{target:"Serving_Problems",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Serving_Problems:{invoke:{id:"serve_next_problem",src:"serve_next_problem",onDone:[{target:"Serving_Agents",cond:"iteratorEmpty"},{target:"Waiting_Problem_Load",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Waiting_Problem_Load:{invoke:{id:"load_problem",src:"load_problem",onDone:{target:"Training",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Training:{entry:"start_training_interaction",on:{PROBLEM_DONE:{target:"Serving_Problems",actions:"sendProblemDone"},CHANGE_INTERACTION_MODE:{target:"Serving_Problems",actions:"assignInteractionSM"}}},All_Done:{entry:"allDone",type:"final"},Fail:{entry:["logError","kill_this"]}}},{services:{load_training_file:T,serve_next_training_set:v,serve_next_agent:w,create_agent:n.createAgent,serve_next_problem:x,load_problem:P,handle_prior_knowledge:k},actions:{start_training_interaction:I,logError:function(e,t){console.error(t.data)},updateContext:(0,c.assign)(function(e,t){return t.data.updateContext}),assignAgentId:(0,c.assign)(function(e,t){return{agent_id:t.data.agent_id}}),allDone:C,assignInteractionSM:F,sendProblemDone:M},guards:{iteratorEmpty:D}})},t.problem_props=void 0;var o=r(n(34)),i=r(n(41)),a=r(n(52)),s=r(n(30)),l=r(n(53)),c=n(79),u=r(n(195)),d=n(194),f=n(460),p=n(461),_=n(196);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,s.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=n(233),y=(n(549),new _.Random,["agent_id","free_author","interactive","tutor_mode","examples_only","test_mode","outer_loop_controller"]);t.problem_props=y;var E=y.reduce(function(e,t){return e[t]=null,e},{}),b={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};function T(e,t){return console.log("TRAINING JSON:",e.training_file),fetch(e.training_file).then(function(e){return e.text()}).then(function(e){return u.default.parse(e)}).then(function(e){return Object.entries(e)}).then(function(e){return{updateContext:{training_iterator:e}}})}function v(e,t){return new Promise(function(){var t=(0,l.default)(a.default.mark(function t(n,r){var o,i,s,l,c;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.training_iterator,i=e.file_params||{},console.log("TRAINING ITERATOR",o.length),!(o.length>0)){t.next=14;break}for(s=o.shift(),l=s[0];"set_params"==l;)i=g({},i,{},s[1]),s=o.shift(),l=s[0];return console.log("START TRAINING SET: ",l,i),t.next=10,(0,p.evalJSONFunc)(s[1],e);case 10:c=t.sent,n({updateContext:{training_iterator:o,agent_iterator:c,file_params:i,training_description:e.training_file.replace(/^.*[\\\/]/,"")+" : "+l}}),t.next=15;break;case 14:n(null);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function O(e,t){return S.apply(this,arguments)}function S(){return(S=(0,l.default)(a.default.mark(function e(t,n){var r,o=arguments;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:null,"string"==typeof t&&(t={type:t}),!t.problem_set){e.next=8;break}return e.next=5,(0,p.evalJSONFunc)(t.problem_set,n);case 5:t.problem_set=e.sent,e.next=9;break;case 8:null!=r&&(t.problem_set=r);case 9:return t.initialized=!1,e.abrupt("return",{outer_loop_controller:t});case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(e,t){return new Promise(function(){var t=(0,l.default)(a.default.mark(function t(n,r){var o,s,l,c,u,d,f,_,h;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.agent_iterator,console.log("AGENT ITERATOR",o.length),!(e.agent_iterator.length>0)){t.next=29;break}return"repetitions"in(s=o.shift())&&(s.repetitions<0?o.unshift(g({},s,{},{_rep_count:(s._rep_count||1)+1})):0==s.repetitions?s=o.shift():s.repetitions>=2&&(s.repetitions-=1,o.unshift(g({},s,{},{_rep_count:(s._rep_count||1)+1}))),s._rep_count=s._rep_count||1),t.next=7,(0,p.evalJSONFunc)(s.problem_set,e);case 7:if(l=t.sent,s.problem_set&&console.log("RESOLVED PROBLEM SET",(0,i.default)(l)),s=g({},e.file_params.agent||{},{},s),e.file_params.agent&&e.file_params.agent.args&&(s.args=g({},e.file_params.agent.args,{},s.args)),c=s.set_params||{},u=null!=s._rep_count?"("+s._rep_count+")":"",s.agent_name+=u,d="Agent Name: "+s.agent_name+"\nAgent Type: "+s.agent_type,f=(0,i.default)(s.prior_knowledge||[]),_=null,!("outer_loop_controller"in s)){t.next=22;break}return t.next=20,O(s.outer_loop_controller,e,l);case 20:_=t.sent,l=[_];case 22:delete(h=g({},s)).problem_set,delete h.agent_name,delete h.agent_type,n({updateContext:{start_state_history:[],request_history:[],session_id:b.guid(),user_guid:s.agent_name,agent_params:c,agent_name:s.agent_name,agent_type:s.agent_type,agent_description:d,other_agent_data:h,agent_iterator:o,problem_set:l,prior_knowledge:f,agent_start_time:new Date,outer_loop_controller:_}}),t.next=30;break;case 29:n(null);case 30:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function k(e,t){var n=new Promise(function(t,r){for(var o=e.prior_knowledge;o.length>0;){console.log("CURRENT",o);var i=o.shift(),a=(0,f.applyPriorKnowledge)(e,i,o);if(a.updateContext&&t({updateContext:a.updateContext}),a.train_now)return n}t({updateContext:{prior_knowledge:o,problem_iterator:e.problem_set}})});return n}function A(e,t,n,r){return R.apply(this,arguments)}function R(){return(R=(0,l.default)(a.default.mark(function e(t,n,r,o){var i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Promise(function(){var e=(0,l.default)(a.default.mark(function e(i,s){var l,c,u,d,f;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=t.shift(),console.log("prob_obj",l);case 2:if(!(null!=l&&"outer_loop_controller"in l)){e.next=26;break}if((c=o.network_layer).OUTER_LOOP_URL||c.kill_this("\nCANNOT USE 'outer_loop_controller' : {} pattern unless running altrain with --outer-loop flag.\n"),(u=l.outer_loop_controller).initialized){e.next=10;break}return e.next=9,c.newOuterLoopController(u,o);case 9:u.initialized=!0;case 10:return e.next=12,c.nextProblem(u,o);case 12:if(null==(d=e.sent)){e.next=18;break}t.unshift(g({},l)),l=d,e.next=24;break;case 18:if(!(t.length>0)){e.next=22;break}l=t.shift(),e.next=24;break;case 22:return i([null,n]),e.abrupt("return");case 24:e.next=2;break;case 26:if(l){e.next=29;break}return i([null,n]),e.abrupt("return");case 29:if(!("set_params"in l)){e.next=37;break}if(n=g({},n,{},l.set_params),l=t.shift()){e.next=35;break}return i([null,n]),e.abrupt("return");case 35:e.next=29;break;case 37:return delete(f=g({},r)).agent,l=g({},f,{},n,{},l),i([l,n]),e.abrupt("return");case 42:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),e.abrupt("return",i);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function x(e,t){return new Promise(function(){var t=(0,l.default)(a.default.mark(function t(n,r){var i,s,l,c,u,d,f,p,_;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null,s=e.agent_params,l=e.file_params,c=e.problem_iterator,e.network_layer,e.interactive,console.log("PROBLEM ITERATOR",c.length),!(c.length>0)){t.next=39;break}return t.next=10,A(c,s,l,e);case 10:if(u=t.sent,d=(0,o.default)(u,2),i=d[0],s=d[1],console.log("SLOOOP"),console.log(i),!i){t.next=36;break}if(!("repetitions"in i)){t.next=32;break}if(!(i.repetitions<0)){t.next=22;break}c.unshift(g({},i)),t.next=32;break;case 22:if(0!=i.repetitions){t.next=31;break}return t.next=25,A(c,s,l,e);case 25:f=t.sent,p=(0,o.default)(f,2),i=p[0],s=p[1],t.next=32;break;case 31:i.repetitions>=2&&(i.repetitions-=1,c.unshift(g({},i)));case 32:_=Object.keys(i).reduce(function(e,t){return e+t+": "+i[t]+"\n"},""),n({updateContext:{agent_params:s,problem_iterator:c,prob_obj:i,problem_description:_}}),t.next=37;break;case 36:n(null);case 37:t.next=40;break;case 39:n(null);case 40:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function P(e,t){return e.tutor.loadProblem(e)}function D(e,t){return null==t.data}function M(e,t){e.network_layer.sendProblemDone(e,t)}function I(e,t){console.log("START TRAINING INTERACTION");var n=e.app,r=g({},m(e,y),{},m(e.prob_obj,y)),o=e.interactions_sm.withContext(g({},e.interactions_sm.context,{},r)),i=(0,c.interpret)(o);e.app.interactions_service=i,i.onTransition(n.onInteractionTransition),i.start()}function C(e,t){var n=e.network_layer;console.log("ITS ALL DONE!"),n.kill_this("\n TRAINING FINISHED SUCCESSFULLY! \n","info")}var F=(0,c.assign)({interactions_sm:function(e,t){var n=g({},{app:e.app},{},m(e,y),{},m(e.prob_obj,y),{},t.data);return console.log("assignInteractionSM",n),(0,d.build_interactions_sm)(n.app,n)}})},460:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.applyPriorKnowledge=function(e,t,n){var r=t.type.toLowerCase().replace("_","");return s[r](t,n)};var o=r(n(52)),i=r(n(53)),a=r(n(83)),s={bestintersect:function(e,t,n){return l.apply(this,arguments)}};function l(){return(l=(0,i.default)(o.default.mark(function e(t,n,r){var i,s,l,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.cache_folder||t.working_dir+"/.pkcache",s=i+"/"+a.default.basename(t.training_file)+".cache",console.log("MOOOOOOOOO",s),e.next=5,fetch(s).then(function(e){if(!e.ok)throw Error(e.statusText);return e}).then(function(e){return e.text()}).catch(function(e){return null});case 5:return l=e.sent,c=null==l?{updateContext:{prior_knowledge:[n]+r,problem_iterator:[]},train_now:!0}:{updateContext:{prior_knowledge:r,problem_iterator:[]},train_now:!0},e.abrupt("return",c);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}},461:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.evalString=function(){return C.apply(this,arguments)},t.evalJSONFunc=F,t.registedFunctions=void 0;var o=r(n(0)),i=r(n(41)),a=r(n(34)),s=r(n(30)),l=r(n(52)),c=r(n(53)),u=n(196),d=r(n(538)),f=r(n(83));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,s.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=new u.Random,g={concatenate:function(e,t){return y.apply(this,arguments)},shuffle:function(e,t){return E.apply(this,arguments)},sample:function(e,t){return b.apply(this,arguments)},glob:function(e,t){return T.apply(this,arguments)},from_file:function(e,t){return v.apply(this,arguments)},estimate_Pik:function(e,t){return P.apply(this,arguments)},gen_pretraining:function(e,t){return D.apply(this,arguments)},gen_pivot_table:function(e,t){return I.apply(this,arguments)},mirror_students:function(e,t){return M.apply(this,arguments)}};function m(e,t){return"/"!=e[0]&&(e=t.working_dir+"/"+e),e}function y(){return(y=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,a,s,c,u,d;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],o=!0,i=!1,a=void 0,e.prev=4,s=t["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();case 6:if(o=(c=s.next()).done){e.next=15;break}return u=c.value,e.next=10,F(u,n);case 10:d=e.sent,r=r.concat(d);case 12:o=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),i=!0,a=e.t0;case 21:e.prev=21,e.prev=22,o||null==s.return||s.return();case 24:if(e.prev=24,!i){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}},e,null,[[4,17,21,29],[22,,24,28]])}))).apply(this,arguments)}function E(){return(E=(0,c.default)(l.default.mark(function e(t,n){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(t,n);case 2:return r=e.sent,e.abrupt("return",h.shuffle(r));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(){return(b=(0,c.default)(l.default.mark(function e(t,n){var r,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.n,o=t.set,e.next=4,F(o,n);case 4:return o=e.sent,console.log("IT IS THIS BIG:",o.length),e.abrupt("return",h.sample(o,r));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function T(){return(T=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t&&(t={pattern:t}),r=t.key||null,o=t.pattern,e.next=5,n.network_layer.glob(o,n);case 5:return i=e.sent,r||t.obj_template?(a=t.obj_template||{},i=i.map(function(e){var t=_({},a);return t[r]="/"+e,t})):i=i.map(function(e){return"/"+e}),e.abrupt("return",i);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function v(){return(v=(0,c.default)(l.default.mark(function e(t,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not Implemented";case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function O(e,t){return S.apply(this,arguments)}function S(){return(S=(0,c.default)(l.default.mark(function e(t,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&(e=e.replace(/\.\./g,"!u")),new Promise(function(){var r=(0,c.default)(l.default.mark(function r(o,i){return l.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.complete=o,!n){r.next=5;break}return r.next=4,fetch(e).then(function(e){return e.text()});case 4:e=r.sent;case 5:d.default.parse(e,t);case 6:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}function k(e){return A.apply(this,arguments)}function A(){return(A=(0,c.default)(l.default.mark(function e(t){var n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={delimiter:"\t",header:!0,dynamicTyping:!0},t=t.replace("..","!u"),r=fetch(t).then(function(e){return e.text()}).then(function(e){var t=e.split(/\n{2,}/g);return[t[0].split(/Values for .* model.*\n/)[1],t[1].split("in the selected KC model.\n")[1]]}).then(function(){var e=(0,c.default)(l.default.mark(function e(t){var r,o,i,s,c;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,a.default)(t,2),o=r[0],i=r[1],e.next=3,w(o,n,!1,!1);case 3:return s=e.sent,e.next=6,w(i,n,!1,!1);case 6:return c=e.sent,e.abrupt("return",[s,c]);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function R(e,t){return x.apply(this,arguments)}function x(){return(x=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,s,c,u,d,f,p,_,h,g,y,E,b,T,v,O,S,A,R,x,P,D,M,I,C,F,j,L,U,N,X,H,W,Y,B,Q;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.fo_err_by_kc){e.next=28;break}return e.next=3,k(m(t.afm_stats,n));case 3:for(o=e.sent,i=(0,a.default)(o,2),s=i[0],c=i[1],u=c.data.filter(function(e){return e["Anon Student Id"]==t.student_id})[0].Intercept,r={},d=!0,f=!1,p=void 0,e.prev=12,_=s.data["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(d=(h=_.next()).done);d=!0)g=h.value,y=1/(1+Math.exp(u+g["Intercept (logit)"])),r[g["KC Name"]]=y;e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),f=!0,p=e.t0;case 20:e.prev=20,e.prev=21,d||null==_.return||_.return();case 23:if(e.prev=23,!f){e.next=26;break}throw p;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return r=r||t.fo_err_by_kc,E=m(t.error_table,n),e.next=32,w(E,{delimiter:"\t",header:!0,dynamicTyping:!0},!0);case 32:for(b=e.sent,T={},v=!0,O=!1,S=void 0,e.prev=37,A=b.data["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(v=(R=A.next()).done);v=!0)x=R.value,(P=x["KC Name"])&&(delete x["KC Name"],T[P]=Object.values(x));e.next=45;break;case 41:e.prev=41,e.t1=e.catch(37),O=!0,S=e.t1;case 45:e.prev=45,e.prev=46,v||null==A.return||A.return();case 48:if(e.prev=48,!O){e.next=51;break}throw S;case 51:return e.finish(48);case 52:return e.finish(45);case 53:D={},e.t2=l.default.keys(T);case 55:if((e.t3=e.t2()).done){e.next=82;break}for(M=e.t3.value,I=T[M],C=1/0,j=r[M],L=!0,U=!1,N=void 0,e.prev=63,X=I.entries()["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(L=(H=X.next()).done);L=!0)W=(0,a.default)(H.value,2),Y=W[0],B=W[1],(Q=j-B)<C&&Q>0&&(C=Q,F=Y);e.next=71;break;case 67:e.prev=67,e.t4=e.catch(63),U=!0,N=e.t4;case 71:e.prev=71,e.prev=72,L||null==X.return||X.return();case 74:if(e.prev=74,!U){e.next=77;break}throw N;case 77:return e.finish(74);case 78:return e.finish(71);case 79:D[M]=F,e.next=55;break;case 82:return e.abrupt("return",D);case 83:case"end":return e.stop()}},e,null,[[12,16,20,28],[21,,23,27],[37,41,45,53],[46,,48,52],[63,67,71,79],[72,,74,78]])}))).apply(this,arguments)}function P(){return(P=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,a,s,c,u,d;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("exact_align"!=t.method){e.next=6;break}return e.next=3,R(t,n);case 3:r=e.sent,e.next=10;break;case 6:if("backcast"!=t.method){e.next=10;break}return e.next=9,O(t,n);case 9:r=e.sent;case 10:if(!("KCs"in t&&null!=t.KCs)){e.next=32;break}for(o={},i=!0,a=!1,s=void 0,e.prev=15,c=t.KCs["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(i=(u=c.next()).done);i=!0)d=u.value,o[d]=r[d];e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),a=!0,s=e.t0;case 23:e.prev=23,e.prev=24,i||null==c.return||c.return();case 26:if(e.prev=26,!a){e.next=29;break}throw s;case 29:return e.finish(26);case 30:return e.finish(23);case 31:r=o;case 32:if("max"in t&&null!=t.max)for(d in r)r[d]=Math.min(r[d],t.max);return e.abrupt("return",r);case 34:case"end":return e.stop()}},e,null,[[15,19,23,31],[24,,26,30]])}))).apply(this,arguments)}function D(){return(D=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,a,s,c,u,d,f,p,g,m,y,E,b,T,v,O,S,w,k,A,R=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=R.length>2&&void 0!==R[2]&&R[2],e.next=3,F(t.opportunities,n);case 3:if(o=e.sent,i=t.by_step_id?"step_id":"Selection",a="only_"+i+"s",o=_({},o),"string"!=typeof t.step_pivot_table){e.next=11;break}alert("NOT IMPLEMENTED"),e.next=14;break;case 11:return e.next=13,F(t.step_pivot_table,n);case 13:s=e.sent;case 14:for(c=Object.keys(s),r&&(c=h.shuffle(c)),u=[],d=t.onlys_map||null,f=!0,p=!1,g=void 0,e.prev=21,m=c["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(f=(y=m.next()).done);f=!0){for(S in E=y.value,b=!0,T=!1,v=[],O=s[E])o[S]>0?(o[S]-=1,w=O[S][i],w=Array.from(w),d&&(w=w.map(function(e){return d[e]})),1==w.length&&(w=w[0]),v.push(w),T=!0):b=!1;T&&((k={})[t.problem_key]=E,b||(k[a]=v),u.push(k))}e.next=29;break;case 25:e.prev=25,e.t0=e.catch(21),p=!0,g=e.t0;case 29:e.prev=29,e.prev=30,f||null==m.return||m.return();case 32:if(e.prev=32,!p){e.next=35;break}throw g;case 35:return e.finish(32);case 36:return e.finish(29);case 37:return Object.values(o).reduce(function(e,t){return e+t},0)>0&&(A="Insufficient problems in problem_pool to pretrain requested number of steps. Additional problems required for KCs/Steps: "+JSON.stringify(o),n.network_layer.kill_this(A),console.error(A)),console.log("opps_by_kc"),console.log(o),e.abrupt("return",u);case 41:case"end":return e.stop()}},e,null,[[21,25,29,37],[30,,32,36]])}))).apply(this,arguments)}function M(){return(M=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,a,s,c,u,p,_,h,g,y,E,b,T,v,O,S,k,A,R,x,P,D,M,I,C,j,L,U,N,X,H,W,Y,B,Q,G,z,V,q,J,K;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("MIRROR_START"),r=m(t.human_transactions,n),o=t.human_afm_stats,i=t.pool_agent_error_table,a=t.Pik_method,s=t.problem_key,c=t.kc_model,u=t.KCs,p=t.max,e.next=11,F(t.human_problems,n);case 11:for(_=e.sent,h={},g=!0,y=!1,E=void 0,e.prev=16,b=_["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(g=(T=b.next()).done);g=!0)v=T.value,h[f.default.basename(v).split(".")[0]]=v;e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),y=!0,E=e.t0;case 24:e.prev=24,e.prev=25,g||null==b.return||b.return();case 27:if(e.prev=27,!y){e.next=30;break}throw E;case 30:return e.finish(27);case 31:return e.finish(24);case 32:if(!("step_pivot_table"in t)){e.next=38;break}return e.next=35,F(t.step_pivot_table,n);case 35:O=e.sent,e.next=45;break;case 38:return e.next=40,F(t.pool_agent_problems,n);case 40:return S=e.sent,O={gen_pivot_table:{transaction_file:t.pool_agent_transactions,problem_pool:S,kc_model:t.kc_model}},e.next=44,F(O,n);case 44:O=e.sent;case 45:return k={},A={dynamicTyping:!0,delimiter:"\t",header:!0,download:!0,step:function(e){if((e=e.data)&&"Anon Student Id"in e){var t=k[e["Anon Student Id"]]||[],n=e["Problem Name"]||"",r=e["Problem View"]||"";if(""!=n){var o=String(n)+"#"+String(r);0==t.length?t.push(o):t.includes(o)||t.push(o)}k[e["Anon Student Id"]]=t}}},R=n.network_layer.HOST_URL+r,e.next=50,w(R,A,!1);case 50:for(x in e.sent,console.log("BEEE"),console.log(k),k)k[x]=k[x].map(function(e){return e.substring(0,e.lastIndexOf("#"))});console.log("AFFFF"),console.log(k),console.log("human_prob_seq"),console.log(k),console.log("human_path_map"),console.log(h),e.t1=l.default.keys(k);case 61:if((e.t2=e.t1()).done){e.next=87;break}for(P=e.t2.value,D=k[P],M=[],I=!0,C=!1,j=void 0,e.prev=68,L=D["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(I=(U=L.next()).done);I=!0)N=U.value,(X=h[N])&&((H={})[s]=X,M.push(H));e.next=76;break;case 72:e.prev=72,e.t3=e.catch(68),C=!0,j=e.t3;case 76:e.prev=76,e.prev=77,I||null==L.return||L.return();case 79:if(e.prev=79,!C){e.next=82;break}throw j;case 82:return e.finish(79);case 83:return e.finish(76);case 84:k[P]=M,e.next=61;break;case 87:W=[],"store_opp_table"in t&&(Y=[]),console.log("full_paths"),console.log(k),e.t4=l.default.keys(k);case 92:if((e.t5=e.t4()).done){e.next=117;break}if(B=e.t5.value,!((Q=k[B]).length>0)){e.next=112;break}return G={estimate_Pik:{method:a,afm_stats:o,student_id:B,error_table:i,KCs:u,max:p}},e.next=99,F(G,n);case 99:if(G=e.sent,"store_opp_table"in t){for(z in(H={})["Anon Student Id"]=B,G)H[z]=G[z];Y.push(H)}return V={gen_pretraining:{opportunities:G,step_pivot_table:O,problem_key:s,kc_model:c,onlys_map:t.onlys_map||null}},e.next=104,F(V,n);case 104:V=e.sent,q={agent_name:B,problem_set:{concatenate:[{set_params:{domain_name:"prior_knowledge"}},V,{set_params:{domain_name:void 0}},Q]}},W.push(q),e.next=115;break;case 112:J="Will Skip Student "+B+"because did not do any problems.",console.warn(J),n.network_layer.term_print(J,"warning");case 115:e.next=92;break;case 117:return"store_opp_table"in t&&(K=d.default.unparse(Y,{delimiter:"\t"}),console.log("OUT CSV"),console.log(K)),console.log("out"),console.log(W),e.abrupt("return",W);case 121:case"end":return e.stop()}},e,null,[[16,20,24,32],[25,,27,31],[68,72,76,84],[77,,79,83]])}))).apply(this,arguments)}function I(){return(I=(0,c.default)(l.default.mark(function e(t,n){var r,o,i,a,s,c,u,p,_,h,g,y,E,b,T,v,O,S,k,A,R,x,P,D,M;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("cache"in t)){e.next=24;break}return e.next=3,w(m(t.cache,n));case 3:for(o=e.sent,r={},i=!0,a=!1,s=void 0,e.prev=8,c=o["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(i=(u=c.next()).done);i=!0)p=u.value,r[p["Problem Path"]]=r[p["Problem Path"]]||{},r[p["Problem Path"]][p.KC].step_id=p.step_id.split(","),r[p["Problem Path"]][p.KC].Selection=p.Selection.split(",");e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),a=!0,s=e.t0;case 16:e.prev=16,e.prev=17,i||null==c.return||c.return();case 19:if(e.prev=19,!a){e.next=22;break}throw s;case 22:return e.finish(19);case 23:return e.finish(16);case 24:if(null!=r){e.next=59;break}return _=m(t.transaction_file,n),e.next=28,F(t.problem_pool,n);case 28:for(h=e.sent,g={},y=!0,E=!1,b=void 0,e.prev=33,T=h["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(y=(v=T.next()).done);y=!0)O=v.value,g[f.default.basename(O).split(".")[0]]=O;e.next=41;break;case 37:e.prev=37,e.t1=e.catch(33),E=!0,b=e.t1;case 41:e.prev=41,e.prev=42,y||null==T.return||T.return();case 44:if(e.prev=44,!E){e.next=47;break}throw b;case 47:return e.finish(44);case 48:return e.finish(41);case 49:return S=null!=(S=t.kc_model||null)?"KC ("+S+")":"Step Name",r={},k={dynamicTyping:!0,delimiter:"\t",header:!0,download:!0,step:function(e){if("CORRECT"===(e=e.data).Outcome){var t=g[e["Problem Name"]]||null;if(null!=t){t in r||(r[t]={});var n=e[S];if(n){n in r[t]||(r[t][n]={step_id:new Set,Selection:new Set});var o=r[t][n];o.step_id.add(e["CF (step_id)"]),o.Selection.add(e.Selection)}}}}},A=n.network_layer.HOST_URL+_,e.next=56,w(A,k,!1);case 56:if(e.sent,"cache"in t){for(x in R=[],r)for(D in P=r[x])R.append({"Problem Path":x,KC:D,step_id:P[D].step_id.join(","),Selection:P[D].Selection.join(",")});M=d.default.unparse(R,{delimiter:"\t",header:!0,newline:"\n"}),n.network_layer.write_file(m(t.cache,n),M)}return e.abrupt("return",r);case 59:case"end":return e.stop()}},e,null,[[8,12,16,24],[17,,19,23],[33,37,41,49],[42,,44,48]])}))).apply(this,arguments)}function C(){return(C=(0,c.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not Implemented";case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function F(e,t){return j.apply(this,arguments)}function j(){return(j=(0,c.default)(l.default.mark(function e(t,n){var r,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=4;break}return e.abrupt("return",(0,i.default)(t));case 4:if("object"!==(0,o.default)(t)){e.next=17;break}if(t=_({},t),r=Object.keys(t)[0],a=t[r],!(r in g)){e.next=14;break}return e.next=11,g[r](a,n);case 11:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",t);case 15:e.next=18;break;case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.registedFunctions=g},473:function(e,t){},475:function(e,t){},493:function(e,t){},494:function(e,t){},513:function(e,t){},518:function(e,t){},532:function(e,t){},534:function(e,t){},540:function(e,t){},542:function(e,t){},550:function(e,t,n){var r=n(9);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(30)),i=r(n(25)),a=r(n(35)),s=r(n(52)),l=r(n(53)),c=r(n(82));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f(e,t){return"matches"==e?void 0:t}function p(e){return _.apply(this,arguments)}function _(){return(_=(0,l.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){setTimeout(e,t)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var h=function(){var e=(0,l.default)(s.default.mark(function e(t,n){var r,o,i,a,l=arguments;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=l.length>2&&void 0!==l[2]?l[2]:3,o=l.length>3&&void 0!==l[3]?l[3]:100,i=!(l.length>4&&void 0!==l[4])||l[4],a=0;case 4:if(!(a<r)){e.next=23;break}return e.prev=5,e.next=8,fetch(t,n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(5),console.log("AL ERROR Retrying",e.t0),!(a+1===r)){e.next=17;break}throw e.t0;case 17:return console.log("waiting",i?o*Math.pow(2,a):o),e.next=20,p(i?o*Math.pow(2,a):o);case 20:a++,e.next=4;break;case 23:case"end":return e.stop()}},e,null,[[5,11]])}));return function(t,n){return e.apply(this,arguments)}}(),g={Accept:"application/json","Content-Type":"application/json"},m=function(){function e(t,n,r){(0,i.default)(this,e),this.AL_URL=t,this.HOST_URL=n,this.OUTER_LOOP_URL=r,this.request_history=[],(0,c.default)(this)}return(0,a.default)(e,[{key:"createAgent",value:function(e,t){this.term_print("Creating Agent: "+e.agent_name,"INFO");var n={name:e.agent_name,agent_type:e.agent_type,project_id:e.project_id};return n=d({},e.other_agent_data,{},n),console.log(this.AL_URL+"/create/"),this.request_history=[],h(this.AL_URL+"/create/",{method:"POST",headers:g,body:JSON.stringify(n)},6,1e3).then(function(e){return e.json()})}},{key:"sendFeedback",value:function(e,t){var n=this;console.log("sendFeedback"),null===e.staged_SAI&&console.error("cannot give feedback on no action.");var r=e.skill_applications,o=e.feedback_map,i=null;if(o&&Object.keys(o).length>0){i=new Promise;for(var a in o){var s=r[a],l={state:e.state,next_state:e.tutor.getState(),selection:s.selection,action:s.action,inputs:s.inputs,foci_of_attention:s.foci_of_attention,rhs_id:s.rhs_id,mapping:s.mapping,reward:"correct"==o[a].toLowerCase()?1:-1};e.interactive&&(l.add_skill_info=!0),i=i.then(function(t){return n.sendTrainingData(l,e.agent_id)}),console.log("BLEEP",this.OUTER_LOOP_URL,e.outer_loop_controller),this.OUTER_LOOP_URL&&(i=i.then(function(t){return n.updateOuterLoopController(l,e)}))}}else{s=e.staged_SAI,l={state:e.state,next_state:e.tutor.getState(),selection:s.selection,action:s.action,inputs:s.inputs,foci_of_attention:s.foci_of_attention,rhs_id:s.rhs_id,mapping:s.mapping,reward:s.reward};e.interactive&&(l.add_skill_info=!0),i=this.sendTrainingData(l,e.agent_id),console.log("BLEEP",this.OUTER_LOOP_URL,e),this.OUTER_LOOP_URL&&e.outer_loop_controller&&(i=i.then(function(t){return n.updateOuterLoopController(l,e)}))}return i}},{key:"sendTrainingData",value:function(e,t){console.log("sendTrainingData");var n=this.AL_URL+"/train/"+t+"/";return h(n,{method:"POST",headers:g,body:JSON.stringify(e,f)}).then(function(e){return e.text()}).then(function(e){try{return JSON.parse(e)}catch(t){return{}}})}},{key:"queryApprentice",value:function(e,t){console.log("queryApprentice");var n={state:e.state};e.interactive&&(n.kwargs={add_skill_info:!0,n:0}),this.request_history.push(n);var r=this.AL_URL+"/request/"+e.agent_id+"/";return h(r,{method:"POST",headers:g,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"checkApprentice",value:function(e,t){console.log("checkApprentice");var n=d({state:e.state},e.staged_SAI),r=this.AL_URL+"/check/"+e.agent_id+"/";return h(r,{method:"POST",headers:g,body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){return+e.reward})}},{key:"term_print",value:function(e){var t={message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default"};return h(this.HOST_URL,{method:"PRINT",headers:g,body:JSON.stringify(t)})}},{key:"kill_this",value:function(e){var t={message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error"};return h(this.HOST_URL,{method:"QUIT",headers:g,body:JSON.stringify(t)})}},{key:"write_file",value:function(e,t){t={file:e,data:t};return h(this.HOST_URL,{method:"WRITE",headers:g,body:JSON.stringify(t)})}},{key:"sendProblemDone",value:function(e,t){}},{key:"generate_nools",value:function(e,t){var n=this,r=this.AL_URL+"/get_skills/"+e.agent_id+"/",o={states:this.request_history.map(function(e){return e.state})};return h(r,{method:"POST",headers:g,body:JSON.stringify(o,f)}).then(function(e){return e.json()}).then(function(t){console.log("NOOLS DIR: ",e.nools_dir);var r={nools_dir:e.nools_dir,problems:e.start_state_history,skills:t};return fetch(n.HOST_URL,{method:"GEN_NOOLS",headers:g,body:JSON.stringify(r,f)})})}},{key:"generateBehaviorProfile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.data=t.data||{};var n=t.data.requests||this.request_history,r=t.data.out_dir||(e.working_dir||".")+"/bprofiles",o=this.HOST_URL,i=this.AL_URL,a=(new Date-e.agent_start_time)%864e5%36e5/6e4,c={dir:r,elapse_minutes:a.toFixed(1)};return fetch(o,{method:"START_BEHAVIOR_PROFILE",headers:g,body:JSON.stringify(c)}).then(function(){var t=(0,l.default)(s.default.mark(function t(a){var l,c,u,d,f,p,_,m,y,E,b;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l=!0,c=!1,u=void 0,t.prev=3,d=n["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();case 5:if(l=(f=d.next()).done){t.next=20;break}return p=f.value,_=p.state,m={state:_,kwargs:{add_skill_info:!0,n:-1}},t.next=11,h(i+"/request/"+e.agent_id+"/",{method:"POST",headers:g,body:JSON.stringify(m)}).then(function(e){return e.json()});case 11:return y=t.sent,E=[],"responses"in y&&y.responses.forEach(function(e,t){var n={selection:e.selection,action:e.action,inputs:e.inputs};console.log(e),console.log(e.selection),E.push(n)}),b={state:_,responses:E,dir:r},t.next=17,fetch(o,{method:"APPEND_BEHAVIOR_PROFILE",headers:g,body:JSON.stringify(b)});case 17:l=!0,t.next=5;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),c=!0,u=t.t0;case 26:t.prev=26,t.prev=27,l||null==d.return||d.return();case 29:if(t.prev=29,!c){t.next=32;break}throw u;case 32:return t.finish(29);case 33:return t.finish(26);case 34:case"end":return t.stop()}},t,null,[[3,22,26,34],[27,,29,33]])}));return function(e){return t.apply(this,arguments)}}())}},{key:"newOuterLoopController",value:function(e,t){var n={outer_loop_type:e.type||e.outer_loop_type,problem_set:e.problem_set,outer_loop_args:e.args||e.outer_loop_args,id:t.agent_id};return console.log(this.OUTER_LOOP_URL),console.log("outer loop data:",n),console.log("outer loop context:",t),fetch(this.OUTER_LOOP_URL,{method:"NEW_STUDENT",headers:g,body:JSON.stringify(n)}).then(function(e){})}},{key:"updateOuterLoopController",value:function(e,t){var n={selection:e.selection,reward:e.reward,action_type:t.action_type};return h(this.OUTER_LOOP_URL,{method:"POST",headers:g,body:JSON.stringify(n)})}},{key:"nextProblem",value:function(e,t){var n={id:t.agent_id};return fetch(this.OUTER_LOOP_URL,{method:"NEXT_PROBLEM",headers:g,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"glob",value:function(e,t){return"/"!=(e=e.replace(/\.\./g,"!u"))[0]&&(e=t.working_dir+"/"+e),fetch(this.HOST_URL,{method:"GLOB",headers:g,body:JSON.stringify(e)}).then(function(e){return e.json()})}}]),e}();t.default=m}},[[234,1,2]]]);
//# sourceMappingURL=main.de36bf45.chunk.js.map