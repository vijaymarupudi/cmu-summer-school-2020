(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{158:function(e,t,n){var r=n(108),i=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(50)),o=i(n(65)),s=i(n(66)),l=i(n(67)),c=i(n(83)),u=i(n(84)),d=i(n(110)),f=i(n(85)),p=i(n(86)),_=r(n(1)),h=n(61),g=i(n(168));function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var b=n(169);function v(e,t,n){return e=[e],t.forEach(function(t,r){e=e.map(function(e,i){if("string"==typeof e){var a=e.split(t);if(a.length>1)return o=a,s=_.default.createElement(h.Text,{style:{color:n[r],textShadowRadius:3,textShadowColor:n[r]}},t),(0,p.default)(o).map(function(e,t){return t<o.length-1?[e,s]:[e]}).reduce(function(e,t){return e.concat(t)})}var o,s;return e}).flat()}),e}var y={ButtonPressed:function(e,t){return"Press Button"},UpdateTextField:function(e,t){return e.name||e.how}},k={UpdateTextField:function(e,t){var n=e.mapping["?sel"],r=Object.entries(e.mapping).reduce(function(e,t){return"?sel"!==t[0]&&e.push(t[1]),e},[]);n=n.replace("?ele-","");var i="("+(r=r.map(function(e){return e.replace("?ele-","")})).join(", ")+"): "+n+"->"+(e.inputs&&e.inputs.value);return i=v(i,[n].concat(r),t)},ButtonPressed:function(e,t){return"Press: "+e.mapping["?sel"].replace("?ele-","")}},S=function(e){function t(e){var n;(0,s.default)(this,t),(n=(0,c.default)(this,(0,u.default)(t).call(this,e))).s_skill_set=n.structure_skills(e.skill_set);var r=n.starting_selection();return n.state={selected_skill:r,selected_match:r,feedback_map:{},s_skill_set:{"":[]}},n.handleClickSkillItem=n.handleClickSkillItem.bind((0,d.default)(n)),n.handleToggleFeedbackButton=n.handleToggleFeedbackButton.bind((0,d.default)(n)),n}return(0,f.default)(t,e),(0,l.default)(t,[{key:"starting_selection",value:function(){if("first"==this.props.initial_select){var e=Object.keys(this.s_skill_set)[0];return null==e?null:this.s_skill_set[e][0]}}},{key:"structure_skills",value:function(e){var t={},n=0,r=function(){var r={};for(a in e[i])(o=e[i][a]).how in r||(r[o.how]=o,r[o.how].matches=[]),o._id=n++,r[o.how].matches.push(o),t[i]=Object.keys(r).map(function(e,t){return r[e]})};for(var i in e){var a,o;r()}return t}},{key:"selectSkill",value:function(e,t){t||(t=e),this.setState({selected_skill:e,selected_match:t})}},{key:"daisyChain",value:function(e,t,n){return function(r){e(r,t,n)}}},{key:"handleClickSkillItem",value:function(e,t,n){var r=(0,o.default)(t,2),i=r[0],a=r[1];this.selectSkill(i,a),this.props.select_callback&&this.props.interactions_service.send({type:"STAGE_SAI",data:a||i}),n&&n(t)}},{key:"handleToggleFeedbackButton",value:function(e,t){var n=(0,o.default)(t,3),r=n[0],i=n[1],a=n[2];this.props.interactions_service.send({type:"TOGGLE_FEEDBACK",skill:r,match:i,label:a})}},{key:"updateFeedbackMap",value:function(e){this.setState({feedback_map:e}),console.log(e)}},{key:"queuedSkillApplicationFeedback",value:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.state.feedback_map);for(var t in e)e[t]="correct"===e[t]?1:-1;return e}},{key:"componentDidUpdate",value:function(e,t){if(!b(e.skill_set,this.props.skill_set)){var n=this.structure_skills(this.props.skill_set);this.setState({feedback_map:{},s_skill_set:n});var r=Object.keys(n);if(r.length>0){var i=n[r[0]][0];this.setState({selected_skill:i,selected_match:i})}else this.setState({selected_skill:null,selected_match:null})}}},{key:"render",value:function(){var e=this;return _.default.createElement(h.View,{style:T.content},_.default.createElement(h.View,{style:x.skill_list},_.default.createElement(h.ScrollView,null,Object.keys(this.state.s_skill_set).map(function(t,n){var r=_.default.createElement(h.TouchableHighlight,{underlayColor:"#fff"},_.default.createElement(h.Text,{style:x.sectionHeader},t)),i=e.state.s_skill_set[t].map(function(t,n){var r=e.state.selected_skill&&e.state.selected_skill._id===t._id,i=(y[t.action]||y.UpdateTextField)(t,e.props.where_colors),a=_.default.createElement(h.TouchableHighlight,{underlayColor:"#f1f1f1",onPress:e.daisyChain(e.handleClickSkillItem,[t],t.callback)},_.default.createElement(h.Text,{style:[x.item,r&&x.selected_skill],backgroundColor:"#ff00ffff"},i)),o=[];return"matches"in t&&(o=t.matches.map(function(n,i){if("mapping"in n){var a=e.state.selected_match&&e.state.selected_match._id===n._id,o=(k[n.action]||k.UpdateTextField)(n,e.props.where_colors),s="correct"===e.state.feedback_map[n._id],l="incorrect"===e.state.feedback_map[n._id];return _.default.createElement(h.View,{style:x.match_container},_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",onPress:e.daisyChain(e.handleToggleFeedbackButton,[t,n,"correct"])},_.default.createElement(h.Text,{style:[x.feedback_button,s&&x.correct_selected]},String.fromCharCode(10004))),_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",onPress:e.daisyChain(e.handleToggleFeedbackButton,[t,n,"incorrect"])},_.default.createElement(h.Text,{style:[x.feedback_button,l&&x.incorrect_selected]},String.fromCharCode(10006))),_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",style:{flex:1},onPress:e.daisyChain(e.handleClickSkillItem,[t,n],n.callback)},_.default.createElement(h.Text,{style:[x.match,r&&a&&x.selected_match]},o)))}return null})),o=o.filter(function(e){return null!=e}),[a].concat(o)});return[r].concat(i)}))),_.default.createElement(h.ScrollView,{style:x.skill_info,showsVerticalScrollIndicator:!0},_.default.createElement(g.default,{title:"How",collapsedHeight:this.props.collapsedHeight.how},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.how)),_.default.createElement(g.default,{title:"Where",collapsedHeight:this.props.collapsedHeight.where},_.default.createElement(h.Text,null,this.state.selected_skill&&JSON.stringify(this.state.selected_skill.where,null,2))),_.default.createElement(g.default,{title:"When",collapsedHeight:this.props.collapsedHeight.when},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.when)),_.default.createElement(g.default,{title:"Which",collapsedHeight:this.props.collapsedHeight.which},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.which))))}}]),t}(_.Component),T=h.StyleSheet.create({content:{flex:1,flexDirection:"row",backgroundColor:"#F5FCFF",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}}),x=h.StyleSheet.create({skill_list:{flexBasis:250,paddingTop:10},skill_info:{flex:1,paddingTop:10},sectionHeader:{flexWrap:"wrap",paddingTop:6,paddingLeft:10,paddingRight:10,paddingBottom:2,fontSize:15,fontWeight:"bold",backgroundColor:"'rgba(247,247,247,1.0)'"},selected_skill:{backgroundColor:"#93e4ec"},item:{flexWrap:"wrap",padding:4,paddingLeft:6,fontSize:16,borderBottomWidth:1,borderColor:"gray",backgroundColor:"'rgba(247,0,0,0.0)'"},feedback_button:{fontSize:20,width:27,textAlign:"center",borderWidth:.1,borderColor:"lightgray"},incorrect_selected:{backgroundColor:"red"},correct_selected:{backgroundColor:"limegreen"},match_container:{display:"flex",flexDirection:"row",borderBottomWidth:1,borderColor:"gray"},match:{flex:1,flexWrap:"wrap",padding:3,textIndent:5,fontSize:15,backgroundColor:"'rgba(252,252,252,1.0)'"},selected_match:{backgroundColor:"#b3e8ff"}});S.defaultProps={collapsedHeight:{how:40,where:90,when:90,which:40},where_colors:["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],select_callback:function(){}};var E=S;t.default=E},168:function(e,t,n){var r=n(108),i=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(66)),o=i(n(67)),s=i(n(83)),l=i(n(84)),c=i(n(85)),u=r(n(1)),d=n(61),f=function(e){function t(e){var r;return(0,a.default)(this,t),(r=(0,s.default)(this,(0,l.default)(t).call(this,e))).icons={up:n(286),down:n(287)},r.state={title:e.title,expanded:!1,expandable:!0,animation:new d.Animated.Value(e.collapsedHeight)},r}return(0,c.default)(t,e),(0,o.default)(t,[{key:"_setMaxHeight",value:function(e){this.setState({maxHeight:e.nativeEvent.layout.height,expandable:e.nativeEvent.layout.height>this.props.collapsedHeight})}},{key:"_setMinHeight",value:function(e){this.setState({minHeight:e.nativeEvent.layout.height})}},{key:"toggle",value:function(){var e=Math.max(this.state.maxHeight+this.state.minHeight,this.props.collapsedHeight),t=Math.max(this.state.minHeight,this.props.collapsedHeight),n=this.state.expanded?e:t,r=this.state.expanded?t:e;this.setState({expanded:!this.state.expanded}),this.state.animation.setValue(n),d.Animated.timing(this.state.animation,{toValue:r,duration:50}).start()}},{key:"render",value:function(){var e=this.icons.down;return this.state.expanded&&(e=this.icons.up),u.default.createElement(d.Animated.View,{style:[p.container,{height:this.state.animation}]},u.default.createElement(d.TouchableHighlight,{underlayColor:"#f1f1f1",onLayout:this._setMinHeight.bind(this),onPress:this.state.expandable?this.toggle.bind(this):null},u.default.createElement(d.View,{style:p.titleContainer},u.default.createElement(d.Text,{style:p.title}," ",this.props.title," "),this.state.expandable&&u.default.createElement(d.Image,{style:p.buttonImage,source:e}))),u.default.createElement(d.View,{style:p.body,onLayout:this._setMaxHeight.bind(this)},this.props.children))}}]),t}(u.Component),p=d.StyleSheet.create({container:{backgroundColor:"#fff",margin:2,overflow:"hidden"},titleContainer:{flexDirection:"row"},title:{flex:1,padding:2,color:"#2a2f43",fontWeight:"bold"},button:{},buttonImage:{width:30,height:25},body:{padding:5,paddingTop:0,paddingBottom:20}}),_=f;t.default=_},170:function(e,t,n){var r=n(108),i=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(50)),o=i(n(66)),s=i(n(67)),l=i(n(83)),c=i(n(84)),u=i(n(85)),d=r(n(1)),f=n(61),p=(i(n(168)),n(169)),_=["Or specify if the ",d.default.createElement(f.Text,{style:{color:"darkorchid",textShadowRadius:3,textShadowColor:"darkorchid"}},"highlighted")," input is correct for the next step."],h=function(e){function t(e){return(0,o.default)(this,t),(0,l.default)(this,(0,c.default)(t).call(this,e))}return(0,u.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,t=this.props.interactions_state,n=function(e){return t&&t.matches?t.matches(e):p(e,{Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})};console.log("props",this.props);var r=function(t){console.log(t),console.log(e.props.callbacks),e.props.callbacks&&t in e.props.callbacks&&e.props.callbacks[t](),e.props.interactions_service.send(t)};return d.default.createElement(f.View,{style:g.container},d.default.createElement(f.View,{style:g.button_wrapper1},d.default.createElement(f.Text,{style:g.prompt1},n("Setting_Start_State")&&"Set the start state.",(n("Waiting_User_Feedback")||n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"}))&&"Demonstrate the next step.",n("Explantions_Displayed")&&"Press next to continue. Or demonstrate the next step.",n("Waiting_Select_Foci")&&"Select any interface elements that were used to compute this result.",n("Waiting_User_Attempt")&&"TUTOR MODE"),n("Waiting_Select_Foci")&&d.default.createElement(f.TouchableHighlight,{style:g.next_button,underlayColor:"#CCCCCC",onPress:function(){return r("FOCI_DONE")}},d.default.createElement(f.Text,{style:g.next_button_text},"Next")),n("Explantions_Displayed")&&d.default.createElement(f.TouchableHighlight,{style:g.next_button,underlayColor:"#CCCCCC",onPress:function(){return r("NEXT_PRESSED")}},d.default.createElement(f.Text,{style:g.next_button_text},"Next")),n("Setting_Start_State")&&d.default.createElement(f.TouchableHighlight,{style:g.startstate_button,underlayColor:"#CCCCCC",onPress:function(){return r("START_STATE_SET")}},d.default.createElement(f.Text,{style:g.startstate_button_text},"Start State Done"))),(n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})||n({Waiting_User_Feedback:"Waiting_Submit_Feedback"}))&&d.default.createElement(f.View,{style:g.button_wrapper2},d.default.createElement(f.Text,{style:g.prompt2},n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})&&_,n({Waiting_User_Feedback:"Waiting_Submit_Feedback"})&&"Or press submit to send the feedback from the skill panel."),n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})&&d.default.createElement(f.View,{style:g.yes_no},d.default.createElement(f.TouchableHighlight,{style:g.yes_button,underlayColor:"#CCCCCC",onPress:function(){return r("YES_PRESSED")}},d.default.createElement(f.Text,{style:g.yes_button_text},"YES")),d.default.createElement(f.TouchableHighlight,{style:g.no_button,underlayColor:"#CCCCCC",onPress:function(){return r("NO_PRESSED")}},d.default.createElement(f.Text,{style:g.no_button_text},"NO"))),n({Waiting_User_Feedback:"Waiting_Submit_Feedback"})&&d.default.createElement(f.TouchableHighlight,{style:g.submit_button,underlayColor:"#CCCCCC",onPress:function(){return r("SUBMIT_SKILL_FEEDBACK")}},d.default.createElement(f.Text,{style:g.submit_button_text},"Submit"))),!this.props.debugmode&&d.default.createElement(f.View,{style:g.button_wrapper3},d.default.createElement(f.TouchableHighlight,{style:g.nools_button,underlayColor:"#CCCCCC",onPress:function(){return e.props.app.changeInteractionMode({tutor_mode:!e.props.tutor_mode})}},d.default.createElement(f.Text,{style:g.nools_button_text},this.props.tutor_mode?"Train Mode":"Tutor Mode")),d.default.createElement(f.TouchableHighlight,{style:g.nools_button,underlayColor:"#CCCCCC",onPress:function(){return e.props.app.generateBehaviorProfile()}},d.default.createElement(f.Text,{style:g.nools_button_text},"Gen bProfile"))),this.props.debugmode&&d.default.createElement(f.View,{style:g.button_wrapper3},d.default.createElement(f.View,{style:{display:"absolute",bottom:0,flexDirection:"row"}},d.default.createElement(f.TouchableHighlight,{style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){return r("DEMONSTRATE")}},d.default.createElement(f.Text,{style:{fontSize:10}},"Demonstrate")),d.default.createElement(f.TouchableHighlight,(0,a.default)({style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){}},"onPress",function(){return r("DONE")}),d.default.createElement(f.Text,{style:{fontSize:10}},"Done")),d.default.createElement(f.TouchableHighlight,(0,a.default)({style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){}},"onPress",function(){return r("APPLICABLE_SKILLS_RECIEVED")}),d.default.createElement(f.Text,{style:{fontSize:10}},"Req recieved")))))}}]),t}(d.Component),g=f.StyleSheet.create({container:{flex:1,flexDirection:"column"},prompt1:{fontSize:20,textAlign:"center",margin:3,flexWrap:"wrap"},prompt2:{fontSize:20,textAlign:"center",margin:7,marginTop:25,marginBottom:12,flexWrap:"wrap"},button_wrapper1:{display:"flex",flexDirection:"column",alignItems:"center"},button_wrapper2:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:1},button_wrapper3:{display:"flex",flexDirection:"row",justifyContent:"space-around",padding:5,marginTop:"auto"},yes_no:{display:"flex",flexDirection:"row"},nools_button:{padding:5,width:100,backgroundColor:"#999999",borderRadius:5},nools_button_text:{textAlign:"center"},startstate_button:{position:"relative",width:200,backgroundColor:"#4CAF50",borderRadius:5,padding:5},startstate_button_text:{fontSize:20,textAlign:"center"},yes_button:{width:80,backgroundColor:"#4CAF50",borderRadius:6,margin:8,padding:4},yes_button_text:{fontSize:30,textAlign:"center"},no_button:{width:80,backgroundColor:"#f44336",borderRadius:6,margin:8,padding:4},no_button_text:{fontSize:30,textAlign:"center"},next_button:{width:100,backgroundColor:"#4CAFFF",borderRadius:6,margin:10,padding:5},next_button_text:{fontSize:35,textAlign:"center"},submit_button:{width:150,backgroundColor:"#4CAFFF",borderRadius:6,margin:10,padding:5},submit_button_text:{fontSize:30,textAlign:"center"},prompt_text:{textAlign:"center",fontSize:25}}),m=h;t.default=m},173:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.build_interactions_sm=x,t.default=void 0;var i=r(n(50)),a=r(n(109)),o=n(120);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var c=(0,o.assign)({start_state_history:function(e,t){var n=e.tutor.getState(),r=e.start_state_history||[];return r.push(n),r}}),u=(0,o.assign)({state:function(e,t){return null==e.staged_SAI||e.staged_SAI.reward>0||e.test_mode?e.tutor.getState():e.state}}),d=(0,o.assign)({staged_SAI:function(e,t){return(0,a.default)(e.staged_SAI,{foci_of_attention:e.tutor.getCurrentFoci()}),e.staged_SAI}});function f(e,t){var n=e.staged_SAI;return!(e.feedback_map&&Object.keys(e.feedback_map).length>0)&&("done"===n.selection&&(null==n.reward||n.reward>0||e.test_mode))}function p(e,t){var n=e.staged_SAI;return n.skipTraining&&n.reward<0||e.examples_only}function _(e,t){return e.free_author||!1}function h(e,t){return t.data>0}function g(e,t){return console.log("CCCC",e),!Object.keys(t.data).length||e.examples_only}function m(e,t){console.error(t.data)}function b(e,t){e.network_layer.kill_this(t.data.toString())}function v(e,t){e.app.setState({skill_panel_props:{skill_set:{"Applicable Skills":{}}}})}function y(e,t){e.app.setState({skill_panel_props:{skill_set:{"Applicable Skills":t.data.responses||{}}}})}var k=(0,o.send)(function(e,t){t.skill;var n=t.match,r=t.label,i=n._id,a=e.feedback_map||{},o=a[i]&&r===a[i]?null:r,s=l({},a);return null===o?delete s[i]:s[i]=o,{type:"FEEBACK_MAP_UPDATE",feedback_map:s,was_empty:0===Object.keys(a).length,now_empty:0===Object.keys(s).length}}),S=(0,o.assign)({feedback_map:function(e,t){return e.skill_panel.updateFeedbackMap&&e.skill_panel.updateFeedbackMap(t.feedback_map),e.tutor.updateFeedbackMap&&e.tutor.updateFeedbackMap(t.feedback_map),t.feedback_map}}),T=(0,o.send)(function(e,t){return!t.was_empty&&t.now_empty?(console.log("EMPTY"),{type:"SKILL_PANEL_FEEDBACK_EMPTY"}):t.was_empty&&!t.now_empty?(console.log("NOT EMPTY"),{type:"SKILL_PANEL_FEEDBACK_NONEMPTY"}):{type:""}});function x(e,t){var n,r={app:e,tutor:e.tutor.current,skill_panel:e.skill_panel.current,buttons:e.buttons.current,network_layer:e.network_layer,staged_SAI:null,action_type:null};return n=(r=l({},r,{},t)).tutor_mode?A:r.interactive?w:E,(0,o.Machine)(l({},{context:r},{},n),function(e){var t=e.tutor.current,n=(e.skill_panel.current,e.network_layer.current,e.network_layer);return{services:{sendFeedback:function(e,t){return e.staged_SAI.skipTraining||e.test_mode?Promise.resolve(!0):n.sendFeedback(e,t)},sendFeedbackExplicit:function(e,t){return n.sendFeedbackExplicit(e,t)},applyNextExample:t.applyNextExample,attemptStagedSAI:t.attemptStagedSAI,queryApprentice:n.queryApprentice,checkApprentice:n.checkApprentice},actions:{logError:m,stateRecalc:u,assignResponse:(0,o.assign)({response:function(e,t){return t.data}}),assignStagedSAI:(0,o.assign)({staged_SAI:function(e,t){return t.data}}),assignExample:(0,o.assign)({action_type:function(e,t){return"EXAMPLE"}}),assignAttempt:(0,o.assign)({action_type:function(e,t){return"ATTEMPT"}}),assignCorrect:(0,o.assign)({staged_SAI:function(e,t){return l({},e.staged_SAI,{},{reward:1})}}),assignIncorrect:(0,o.assign)({staged_SAI:function(e,t){return l({},e.staged_SAI,{},{reward:-1})}}),assignFoci:d,clearFeedbackData:(0,o.assign)(function(e,t){return{reward:null,staged_SAI:null,skill_applications:null,feedback_map:null}}),assignSkillApplications:(0,o.assign)({skill_applications:function(e,t){return t.data.responses||t.data.skill_applications}}),kill_this:b,printEvent:function(e,t){console.log("P_EVT:",t)},fillSkillPanel:y,clearSkillPanel:v,done:function(e,t){e.app.training_service.send("PROBLEM_DONE")},enterSetStartStateMode:t.enterSetStartStateMode,exitSetStartStateMode:t.exitSetStartStateMode,enterFeedbackMode:t.enterFeedbackMode,exitFeedbackMode:t.exitFeedbackMode,enterFociMode:t.enterFociMode,exitFociMode:t.exitFociMode,enterTutoringMode:t.enterTutoringMode,exitTutoringMode:t.exitTutoringMode,displayCorrectness:t.displayCorrectness,printFeedback:t.printFeedback,applyStagedSAI:function(e,n){t.applySAI(e.staged_SAI)},proposeSAI:function(e,n){return t.proposeSAI(n.data)},confirmProposedSAI:function(e,n){t.confirmProposedSAI()},clearProposedSAI:function(e,n){t.clearProposedSAI()},recalcFeedbackMap:k,assignFeedbackMap:S,toggleFeedbackStyle:T,generate_nools:n.generate_nools,appendStartHistory:c},guards:{saiIsCorrectDone:f,forceUseExample:p,noApplicableSkills:g,isFreeAuthor:_,checkIsCorrect:h}}}(e))}var E={initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":"Querying_Apprentice"}},Querying_Apprentice:{invoke:{id:"queryApprentice",src:"queryApprentice",onDone:[{target:"Applying_Next_Example",cond:"noApplicableSkills"},{target:"Applying_Staged_SAI",actions:["assignStagedSAI"]}],onError:"Fail"},exit:"assignResponse"},Applying_Staged_SAI:{invoke:{id:"attemptStagedSAI",src:"attemptStagedSAI",onDone:{target:"Sending_Feedback",actions:["assignStagedSAI","assignAttempt"]},onError:"Fail"}},Applying_Next_Example:{invoke:{id:"applyNextExample",src:"applyNextExample",onDone:{target:"Sending_Feedback",actions:["assignStagedSAI","assignExample"]},onError:"Fail"}},Sending_Feedback:{entry:"printFeedback",invoke:{id:"sendFeedback",src:"sendFeedback",onDone:[{target:"Done",cond:"saiIsCorrectDone"},{target:"Applying_Next_Example",cond:"forceUseExample"},{target:"Querying_Apprentice"}],onError:"Fail"},exit:["stateRecalc","assignResponse","clearFeedbackData"]},Done:{type:"final",entry:"done"},Fail:{entry:["logError","kill_this"]}}},w={id:"interactive",initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":[{target:"Setting_Start_State",cond:"isFreeAuthor"},{target:"Querying_Apprentice"}]}},Setting_Start_State:{entry:"enterSetStartStateMode",on:{START_STATE_SET:{target:"Querying_Apprentice",actions:["appendStartHistory"]}},exit:["exitSetStartStateMode","stateRecalc"]},Querying_Apprentice:{invoke:{id:"queryApprentice",src:"queryApprentice",onDone:[{target:"Waiting_User_Feedback.Waiting_Demonstrate_Only",cond:"noApplicableSkills",actions:["fillSkillPanel"]},{target:"Waiting_User_Feedback.Waiting_Yes_No_Feedback",actions:["fillSkillPanel","proposeSAI","assignStagedSAI"]}],onError:"Fail"},exit:"assignSkillApplications"},Waiting_User_Feedback:{entry:"enterFeedbackMode",initial:"Waiting_Demonstrate_Only",states:{Waiting_Demonstrate_Only:{},Waiting_Yes_No_Feedback:{on:{SKILL_PANEL_FEEDBACK_NONEMPTY:"Waiting_Submit_Feedback",YES_PRESSED:{target:"#interactive.Sending_Feedback",actions:["assignCorrect","assignAttempt","confirmProposedSAI"]},NO_PRESSED:{target:"#interactive.Sending_Feedback",actions:["assignIncorrect","assignAttempt","clearProposedSAI"]}}},Waiting_Submit_Feedback:{on:{SKILL_PANEL_FEEDBACK_EMPTY:"Waiting_Yes_No_Feedback",SUBMIT_SKILL_FEEDBACK:{target:"#interactive.Sending_Feedback",actions:["clearProposedSAI"]}}}},on:{STAGE_SAI:{actions:["assignStagedSAI","proposeSAI"]},TOGGLE_FEEDBACK:{actions:"recalcFeedbackMap"},FEEBACK_MAP_UPDATE:{actions:["assignFeedbackMap","toggleFeedbackStyle"]},DEMONSTRATE:{target:"Waiting_Select_Foci",actions:["assignStagedSAI","assignExample","printEvent","clearProposedSAI"]},GEN_NOOLS:{actions:["generate_nools"]}},exit:["exitFeedbackMode"]},Waiting_Select_Foci:{entry:"enterFociMode",on:{"":{target:"Sending_Feedback",actions:"assignFoci",cond:"saiIsCorrectDone"},FOCI_DONE:{target:"Sending_Feedback",actions:"assignFoci"}},exit:"exitFociMode"},Sending_Feedback:{entry:["printFeedback"],invoke:{id:"sendFeedback",src:"sendFeedback",onDone:[{target:"Done",cond:"saiIsCorrectDone"},{target:"Querying_Apprentice"}],onError:"Fail"},exit:["stateRecalc","assignResponse","clearFeedbackData"]},Done:{type:"final",entry:["clearSkillPanel","done"]},Fail:{entry:["logError","kill_this"]}}},A={id:"interactive",initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":[{target:"Setting_Start_State",cond:"isFreeAuthor"},{target:"Waiting_User_Attempt"}]}},Setting_Start_State:{entry:"enterSetStartStateMode",on:{START_STATE_SET:{target:"Waiting_User_Attempt",actions:["appendStartHistory"]}},exit:["exitSetStartStateMode","stateRecalc"]},Waiting_User_Attempt:{entry:["enterTutoringMode","stateRecalc"],on:{ATTEMPT:{target:"Checking_Against_Apprentice",actions:"assignStagedSAI"}},exit:"exitTutoringMode"},Checking_Against_Apprentice:{invoke:{id:"checkApprentice",src:"checkApprentice",onDone:[{cond:"saiIsCorrectDone",target:"Done",actions:["displayCorrectness","assignCorrect"]},{cond:"checkIsCorrect",target:"Waiting_User_Attempt",actions:["displayCorrectness","assignCorrect"]},{target:"Waiting_User_Attempt",actions:["displayCorrectness","assignIncorrect"]}]}},Done:{type:"final",entry:["clearSkillPanel","done"]}}},C=x;t.default=C},247:function(e,t,n){e.exports=n(248)},248:function(e,t,n){var r=n(108),i=n(41),a=i(n(109)),o=i(n(65)),s=i(n(50)),l=i(n(1)),c=i(n(45));n(255);i(n(158)),i(n(170));var u=r(n(288)),d=(n(120),i(n(289))),f=i(n(300)),p=i(n(174));function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var h={ctatttutor:d.default,ctat:d.default};function g(e){var t;try{t=JSON.parse(e)}catch(n){t=null}return t}var m,b=function(){var e=new URLSearchParams(window.location.search.substring(1));console.log(window.location.search),console.log(e);var t={AL_URL:e.get("al_url"),OUTER_LOOP_URL:e.get("outer_loop_url"),HOST_URL:window.location.origin,training_file:e.get("training"),interactive:g((e.get("interactive")||"").toLowerCase()),use_foci:g((e.get("use_foci")||"").toLowerCase()),tutor:e.get("tutor"),nools_dir:e.get("nools_dir")};return console.log("PROPS",t,e.get("interactive")),t}();b.training_file=b.training_file||"/stylus_author.json",(m=b.training_file,fetch(m).then(function(e){return e.text()}).then(function(e){return p.default.parse(e)})).then(function(e){var t=e.set_params;return(b=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,s.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{},function(e){var t={};return console.log(e),Object.keys(e).forEach(function(n){console.log(n),null!=e[n]&&(t[n]=e[n])}),t}(b))).tutor=(b.tutor||"ctat").toLowerCase().replace("_",""),b}).then(function(e){var t=h[e.tutor]||d.default;return console.log("TC",t,e.tutor),[e,t]}).then(function(e){var t=(0,o.default)(e,2),n=t[0],r=t[1];c.default.render(l.default.createElement(f.default,(0,a.default)({ref:function(e){window.react_interface=e},style:{height:"100%"},tutorClass:r},n)),document.getElementById("root"))}),u.unregister()},255:function(e,t,n){},286:function(e,t,n){e.exports=n.p+"static/media/Arrowhead-01-128.3fbf838f.png"},287:function(e,t,n){e.exports=n.p+"static/media/Arrowhead-Down-01-128.912d4e8d.png"},288:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.register=function(e){if("serviceWorker"in navigator){var t=new URL(".",window.location.href);if(t.origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");r?(!function(e,t){fetch(e).then(function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):i(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):i(t,e)})}},t.unregister=function(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})};var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function i(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}},289:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(86)),a=r(n(50)),o=r(n(109)),s=r(n(65)),l=r(n(66)),c=r(n(67)),u=r(n(83)),d=r(n(84)),f=r(n(110)),p=r(n(85)),_=r(n(1)),h=r(n(290)),g=r(n(130));n(61);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,a.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v=n(295),y=n(112),k=n(299);function S(e,t){for(var n=!1,r=t.length-1;r>=0;r--){var i=t[r];e.classList.contains(i)&&(n=!0)}return n}var T=function(e){function t(e){var n;return(0,l.default)(this,t),n=(0,u.default)(this,(0,d.default)(t).call(this,e)),(0,g.default)((0,f.default)(n)),n.where_colors=["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],n.relative_pos_cache={},n.color_class_map={EXAMPLE:"CTAT--example",CORRECT:"CTAT--correct",INCORRECT:"CTAT--incorrect",HIGHLIGHT:"CTAT--AL_highlight",START_STATE:"CTAT--AL_start",ATTEMPT:"",DEFAULT:""},n.ctat_webview=_.default.createRef(),n.state={source:"../../examples/FracPreBake/FractionArithmetic/HTML/fraction_arithmetic.html?question_file=../mass_production/mass_production_brds/AD 5_9_plus_3_7.brd"},n.start_state_history=[],n.highlighted_elements=[],n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){console.log("THIS",this)}},{key:"componentDidUpdate",value:function(e,t){console.log("UPDATED",this.state),this.iframe=this.ctat_webview.current,this.init_callback||(this.init_callback=function(e){})}},{key:"loadProblem",value:function(e){var t=this,n=e.prob_obj,r=e.network_layer,i=e.interactive;return this.interactive=e.interactive,this.setState({source:{html:x}}),new Promise(function(a,l){var c=n.HTML.substring(n.HTML.lastIndexOf("/")+1).replace(".html",""),u=n.domain_name||c,d=n.HTML.replace(/\.\./g,"!u");y.isAbsolute(d)||(d=y.join(e.working_dir||"/",d));var f,p,_=void 0!=n.question_file&&"INTERACTIVE"!=n.question_file.toUpperCase(),h=n.abs_qf_paths||!1;_?(f=n.question_file.substring(n.question_file.lastIndexOf("/")+1).replace(".brd","").replace(".nools",""),p=!1):(f="FREE AUTHORING",p=!0),r.term_print("Starting Problem: "+f,"INFO");var g=(n.question_file||"").replace(/\.\./g,"!u");g=_?h?{question_file:e.network_layer.HOST_URL+g}:{question_file:g}:{question_file:"/static/empty.nools"},console.log("qf",g,i,n),!i&&g.question_file.includes(".nools")&&r.kill_this("Question file cannot be nools in non-interactive mode. Use example tracing.");var m={problem_name:f,dataset_level_name1:u,dataset_level_type1:"Domain",SessionLog:"true",Logging:"ClientToLogServer",log_service_url:window.location.origin,user_guid:e.agent_name,session_id:e.session_id};if("problem_context"in n&&(m.problem_context=n.problem_context),"custom_fields"in n){var b=n.custom_fields,k=!0,S=!1,T=void 0;try{for(var x,E=Object.keys(b).entries()["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(k=(x=E.next()).done);k=!0){var w=(0,s.default)(x.value,2),A=w[0],C=w[1];m["custom_field_name"+String(A)]=C,m["custom_field_value"+String(A)]=b[C]}}catch(P){S=!0,T=P}finally{try{k||null==E.return||E.return()}finally{if(S)throw T}}}var O=(0,o.default)({},g,m);t.HTML_PATH=d,t.init_callback=function(){a({updateContext:{free_author:p}})};var I=d+"?"+v.stringify(O);console.log("source",I),t.graph=null,t.commLibrary=null,t.hasConfig=null,t.setState({source:{uri:I},onLoad:t._triggerWhenInitialized,steps:n.only_step_ids?n.only_step_ids.flat():null,selections:n.only_Selections?n.only_Selections.flat():null})})}},{key:"_inject_element",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.iframe_content.document.createElement(e);for(var r in t)n.setAttribute(r,t[r]);this.iframe_content.document.getElementsByTagName("head")[0].appendChild(n)}},{key:"_triggerWhenInitialized",value:function(){var e=this;console.log("TRIGGER WHEN INITIALIZED"),this.iframe_content=this.iframe.frameRef.contentWindow;var t=this.iframe_content;if("undefined"==typeof t.CTAT||null==t.CTAT||"undefined"==typeof t.CTATCommShell||null==t.CTATCommShell||"undefined"==typeof t.CTATCommShell.commShell||null==t.CTATCommShell.commShell||"undefined"==typeof t.CTAT.ToolTutor||null==t.CTAT.ToolTutor||"undefined"==typeof t.CTAT.ToolTutor.tutor||null==t.CTAT.ToolTutor.tutor)return console.log("BLEHH1"),void window.setTimeout(function(){e._triggerWhenInitialized()},500);this.graph=t.CTAT.ToolTutor.tutor.getGraph()||!1,this.commLibrary=t.CTATCommShell.commShell.getCommLibrary(),this.hasConfig=void 0!=t.CTATConfiguration,(this.graph||this.interactive)&&this.commLibrary&&this.hasConfig?(this._inject_element("link",{href:"/static/css/AL_colors.css",type:"text/css",rel:"stylesheet"}),t.flashVars.setParams({deliverymode:"bleehhhh"}),this.CTAT_CORRECT=t.CTAT.Component.Base.Tutorable.EventType.correct,this.CTAT_INCORRECT=t.CTAT.Component.Base.Tutorable.EventType.incorrect,this.CTAT_ACTION=t.CTAT.Component.Base.Tutorable.EventType.action,console.log("INITIALIZED!"),this.init_callback(this)):(console.log("BLEHH2"),window.setTimeout(function(){e._triggerWhenInitialized()},500))}},{key:"handle_user_set_state",value:function(e){var t=e.detail.sai,n=t.getSelection();""!=t.getInput()?(this.colorElement(n,"START_STATE"),this.start_state_elements.push(n)):(this.colorElement(n,"DEFAULT"),this.start_state_elements.includes(n)&&this.start_state_elements.remove(n))}},{key:"enterSetStartStateMode",value:function(){this.start_state_elements=[],this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handle_user_set_state)}},{key:"exitSetStartStateMode",value:function(){for(var e in this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handle_user_set_state),console.log("START DONE"),this.start_state_elements){var t=this.start_state_elements[e];this.iframe_content.document.getElementById(t).firstChild.value&&this.lockElement(t),this.colorElement(t,"DEFAULT")}this.start_state_history.push(this.getState())}},{key:"handleUserExample",value:function(e){this.handleUserInput(e,"EXAMPLE")}},{key:"handleUserAttempt",value:function(e){this.handleUserInput(e,"ATTEMPT")}},{key:"handleUserInput",value:function(e,t){var n=(r=e.detail.sai).getSelection();if("false"!=this.iframe_content.document.getElementById(n).firstChild.contentEditable){var r={selection:r.getSelection(),action:r.getAction(),inputs:{value:r.getInput()}};if(this.lockElement(n),this.colorElement(n,t),"EXAMPLE"==t)this.props.interactions_service.send({type:"DEMONSTRATE",data:b({},r,{reward:1})});else{if("ATTEMPT"!=t)throw"uknown type given";console.log("SEND ATTEMPT",r),this.props.interactions_service.send({type:"ATTEMPT",data:b({},r)})}}else console.log("BAIL")}},{key:"displayCorrectness",value:function(e,t){var n=e.staged_SAI.selection;1==t.data?this.colorElement(n,"CORRECT"):(this.colorElement(n,"INCORRECT"),this.unlockElement(n))}},{key:"printFeedback",value:function(e,t){var n=e.network_layer,r=e.staged_SAI,i=e.action_type;if(e.feedback_map&&0!==Object.keys(e.feedback_map).length)for(var a in e.feedback_map){var o=e.skill_applications[a];i=e.feedback_map[a].toUpperCase(),s=null!=o.inputs.value?o.inputs.value:"";n.term_print(i+": "+o.selection+" -> "+s,i)}else{"ATTEMPT"==i&&(i=r.reward>0?"CORRECT":"INCORRECT");var s=null!=r.inputs.value?r.inputs.value:"";n.term_print(i+": "+r.selection+" -> "+s,i)}}},{key:"_done_clicked_example",value:function(e){this.handleUserExample({detail:{sai:new this.iframe_content.CTATSAI("done","ButtonPressed","-1")}})}},{key:"enterFeedbackMode",value:function(){this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handleUserExample),this.iframe_content.document.getElementById("done").addEventListener("click",this._done_clicked_example)}},{key:"exitFeedbackMode",value:function(){this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handleUserExample),this.iframe_content.document.getElementById("done").removeEventListener("click",this._done_clicked_example)}},{key:"_done_clicked_attempt",value:function(e){this.handleUserAttempt({detail:{sai:new this.iframe_content.CTATSAI("done","ButtonPressed","-1")}})}},{key:"enterTutoringMode",value:function(){this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handleUserAttempt),this.iframe_content.document.getElementById("done").addEventListener("click",this._done_clicked_attempt)}},{key:"exitTutoringMode",value:function(){this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handleUserAttempt),this.iframe_content.document.getElementById("done").removeEventListener("click",this._done_clicked_attempt)}},{key:"handle_foci_select",value:function(e){console.log("FOCI SELECT!");var t=!0,n=!1,r=void 0;try{for(var i,a=e.path["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(console.log("EELE",o),void 0!=o.classList&&o.classList.contains("CTATComponent")){var s=this.current_foci.indexOf(o);-1==s?(this.current_foci.push(o),this.highlightElement(o.id,1)):(this.current_foci.splice(s,1),this.unhighlightElement(o.id)),console.log(this.current_foci);break}}}catch(l){n=!0,r=l}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"enterFociMode",value:function(){console.log("FOCI START!"),this.unhighlightAll(),this.current_foci=[],this.iframe_content.document.addEventListener("click",this.handle_foci_select)}},{key:"getCurrentFoci",value:function(){return this.current_foci?this.current_foci.map(function(e){return e.id}):[]}},{key:"exitFociMode",value:function(){this.unhighlightAll(),console.log("FOCI DONE!"),this.current_foci=[],this.iframe_content.document.removeEventListener("click",this.handle_foci_select)}},{key:"_shouldSkipTraining",value:function(e){if(!this.state.steps&&!this.state.selections)return!1;if(this.state.steps){var t=this.iframe_content.CTAT.ToolTutor.tutor.getTracer().getLastResult().getStepID();if(console.log("stepId:",t),this.state.steps.includes(t))return!1}return!this.state.selections||!this.state.selections.includes(e.selection)}},{key:"attemptStagedSAI",value:function(e,t){var n=this;return new Promise(function(t,r){var i=e.staged_SAI,a=n.iframe_content.document.getElementById(i.selection),o=n.CTAT_CORRECT,s=n.CTAT_INCORRECT,l=n._shouldSkipTraining,c=n.lockElement;function u(n){console.log("EVENT",n),console.log("EVENT",n.detail.sai.getTransactionID()),a.removeEventListener(o,u),a.removeEventListener(s,u),console.log("MOOOOOOOO",e),e.test_mode&&c(i.selection),t(b({},i,{reward:n.type==o?1:-1,skipTraining:l(i)}))}a.addEventListener(o,u),a.addEventListener(s,u),n.applySAI(i)})}},{key:"applyNextExample",value:function(e,t){var n=this;return new Promise(function(e,t){n.applyHint();var r=n.getDefaultSAI();n.colorElement(r.selection,"EXAMPLE"),n.applySAI(r),e(b({},r,{reward:1,skipTraining:n._shouldSkipTraining(r)}))})}},{key:"applySAI",value:function(e){var t=this.iframe_content.document.getElementById(e.selection);if("false"==(t["data-ctat-enabled"]||"true")){var n=new CustomEvent(this.CTAT_INCORRECT,{detail:{sai:e,component:t},bubbles:!0,cancelable:!0});t.dispatchEvent(n)}"ButtonPressed"==e.action&&(e.inputs={value:-1});var r=new(0,this.iframe_content.CTATSAI)(e.selection,e.action,e.inputs.value);this.iframe_content.CTATCommShell.commShell.processComponentAction(r,!0)}},{key:"lockElement",value:function(e){this.iframe_content.CTATShellTools.findComponent(e)[0].setEnabled(!1)}},{key:"unlockElement",value:function(e){this.iframe_content.CTATShellTools.findComponent(e)[0].setEnabled(!0)}},{key:"colorElement",value:function(e,t){var n=this.iframe_content.document.getElementById(e);n&&n.firstElementChild&&n.firstElementChild.setAttribute("class",this.color_class_map[t])}},{key:"highlightElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.unhighlightElement(e),this.iframe_content.document.getElementById(e.replace("?ele-","")).firstElementChild.classList.add("CTAT--AL_highlight"+t),this.highlighted_elements.push(e)}},{key:"unhighlightElement",value:function(e){if(this.highlighted_elements.includes(e)){for(var t=this.iframe_content.document.getElementById(e.replace("?ele-","")),n=(t.firstElementChild.classList.toString(),1);n<=this.where_colors.length;n++){var r="CTAT--AL_highlight"+n;t.firstElementChild.classList.contains(r)&&t.firstElementChild.classList.remove(r)}t.firstElementChild.classList.toString();var i=this.highlighted_elements.indexOf(e);i>-1&&this.highlighted_elements.splice(i,1)}}},{key:"clearElement",value:function(e){this.iframe_content.document.getElementById(e).firstElementChild.value=""}},{key:"highlightSAI",value:function(e){if(e.mapping){var t=0;for(var n in e.mapping){var r=e.mapping[n],i=1;"?sel"!=n&&(i=2+(t-1)%(this.where_colors.length-1)),this.highlightElement(r,i),t++}}else alert("RESPONSE IS MISSING FIELD:'mapping'")}},{key:"unhighlightAll",value:function(){for(var e=0,t=(0,i.default)(this.highlighted_elements);e<t.length;e++){var n=t[e];this.unhighlightElement(n)}}},{key:"getDefaultSAI",value:function(){var e=this.graph.getExampleTracer().getBestNextLink().getDefaultSAI();return e={selection:e.getSelection(),action:e.getAction(),inputs:{value:e.getInput()}}}},{key:"clearProposedSAI",value:function(){this.proposed_SAI&&(this.clearElement(this.proposed_SAI.selection),this.unlockElement(this.proposed_SAI.selection.replace("?ele-","")),this.unhighlightAll(),this.proposed_SAI=null)}},{key:"proposeSAI",value:function(e){this.clearProposedSAI(),this.proposed_SAI=b({},e),this.highlightSAI(e),this.stageSAI(e)}},{key:"stageSAI",value:function(e){var t=this.iframe_content.CTATShellTools.findComponent(e.selection)[0],n=new this.iframe_content.CTATSAI(e.selection,e.action,e.inputs.value);t.executeSAI(n),this.lockElement(e.selection)}},{key:"confirmProposedSAI",value:function(){this.proposed_SAI&&(this.unhighlightAll(),this.proposed_SAI=null)}},{key:"applyHint",value:function(){this.commLibrary.sendXML("<message><properties><MessageType>InterfaceAction</MessageType><Selection><value>hint</value></Selection><Action><value>ButtonPressed</value></Action><Input><value><![CDATA[hint request]]></value></Input></properties></message>")}},{key:"getState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.encode_relative,n=void 0===t||t,r=e.strip_offsets,i=void 0===r||r,a=e.use_offsets,l=void 0===a||a,c=e.use_class,u=void 0===c||c,d=e.use_id,f=void 0===d||d,p=e.append_ele,_=void 0!==p&&p,h=e.numeric_values,g=void 0!==h&&h,m=this.relative_pos_cache,b=this.HTML_PATH,v=this.iframe_content.$("div").toArray(),y={};if(k.each(v,function(e,t){if(N={},t.classList.contains("CTATComponent")&&!t.classList.contains("CTATTable")&&"CTATTextField"!=t.classList[0]){if(u&&(N.type=t.classList[0]),l&&(N.offsetParent=t.offsetParent.dataset.silexId,N.offsetLeft=t.offsetLeft,N.offsetTop=t.offsetTop,N.offsetWidth=t.offsetWidth,N.offsetHeight=t.offsetHeight),f&&(N.id=t.id),S(t,["CTATTextInput","CTATComboBox","CTATTable--cell"])&&(N.value=t.firstElementChild.value,g&&(N.value=Number(N.value)||N.value),N.contentEditable="true"==t.firstElementChild.contentEditable),S(t,["CTATComboBox"])){for(var n=t.firstElementChild.options,r=[],i=0;i<n.length;i++)r.push(n[i].text);N.options=(0,o.default)({},r)}var a=(_?"?ele-":"")+t.id;y[a]=N,0}}),n){var T,x=Object.entries(y);if(b in m)T=m[b];else{T={};for(var E=0;E<x.length;E++)T[x[E][0]]={to_left:[],to_right:[],above:[],below:[]};for(E=0;E<x.length;E++)for(var w=0;w<x.length;w++)if(E!=w){var A=(0,s.default)(x[E],2),C=A[0],O=A[1],I=(0,s.default)(x[w],2),P=I[0],L=I[1];if(O.offsetTop>L.offsetTop&&O.offsetLeft<L.offsetLeft+L.offsetWidth&&O.offsetLeft+O.offsetWidth>L.offsetLeft){var F=O.offsetTop-L.offsetTop;T[C].above.push([P,F]),T[P].below.push([C,F])}if(O.offsetLeft<L.offsetLeft&&O.offsetTop+O.offsetHeight>L.offsetTop&&O.offsetTop<L.offsetTop+L.offsetHeight){F=L.offsetLeft-O.offsetLeft;T[C].to_right.push([P,F]),T[P].to_left.push([C,F])}}var R=function(e){return e[0]},D=function(e,t){return e[1]-t[1]};for(E=0;E<x.length;E++){(j=T[x[E][0]]).below=j.below.sort(D).map(R)[0]||"",j.above=j.above.sort(D).map(R)[0]||"",j.to_right=j.to_right.sort(D).map(R)[0]||"",j.to_left=j.to_left.sort(D).map(R)[0]||""}m[b]=T}for(E=0;E<x.length;E++){var N=y[x[E][0]],j=T[x[E][0]];N.below=j.below,N.above=j.above,N.to_right=j.to_right,N.to_left=j.to_left,i&&(delete N.offsetTop,delete N.offsetLeft,delete N.offsetWidth,delete N.offsetHeight),y[x[E][0]]=N}}return console.log("STATE JSON",y),y}},{key:"render",value:function(){return _.default.createElement(h.default,{ref:this.ctat_webview,originWhitelist:["*"],source:this.state.source,onLoad:this.state.onLoad})}}]),t}(_.default.Component),x='<!DOCTYPE html> <html><head><meta name="viewport" content="width=device-width, initial-scale=1"><style>.loader {  border: 16px solid #f3f3f3;  border-radius: 50%;  border-top: 16px solid #3498db;  width: 120px;  height: 120px;  -webkit-animation: spin 2s linear infinite; /* Safari */  animation: spin 2s linear infinite;  position: absolute;  left: 50%;  top: 50%;  transform: translate(-50%, -50%);*/}/* Safari */@-webkit-keyframes spin {  0% { -webkit-transform: rotate(0deg); }  100% { -webkit-transform: rotate(360deg); }}@keyframes spin {  0% { transform: rotate(0deg); }  100% { transform: rotate(360deg); }}</style></head><body><h2>How To Create A Loader</h2><div class="loader"></div></body></html>',E=T;t.default=E},300:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(109)),a=r(n(66)),o=r(n(67)),s=r(n(83)),l=r(n(84)),c=r(n(110)),u=r(n(85)),d=r(n(158)),f=r(n(170)),p=n(173),_=n(301),h=r(n(417)),g=n(120),m=r(n(130)),b=(r(n(112)),r(n(228))),v=r(n(1)),y=r(n(418)),k=n(61);var S=function(e){function t(e){var n;if((0,a.default)(this,t),n=(0,s.default)(this,(0,l.default)(t).call(this,e)),(0,m.default)((0,c.default)(n)),n.onInteractionTransition=n.onInteractionTransition.bind((0,c.default)(n)),n.network_layer=new h.default(e.AL_URL,e.HOST_URL,e.OUTER_LOOP_URL),null==e.working_dir&&null!=e.training_file){var r=e.training_file.match(/(.*)[\/\\]/);e.working_dir=r?r[1]:""}return n.tutor=v.default.createRef(),n.skill_panel=v.default.createRef(),n.buttons=v.default.createRef(),n.state={default_props:{},buttons_props:{app:(0,c.default)(n)},tutor_props:n.props.tutor_props||{},skill_panel_props:{},training_description:"????",agent_description:"????",problem_description:"????",interactive:n.props.interactive,free_author:n.props.free_author,tutor_mode:n.props.tutor_mode},n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"onInteractionTransition",value:function(e){console.log("#",e.value,":",e.context,e);var t={interactions_state:e,interactions_service:this.interactions_service};this.setState({default_props:t,Interactions_Machine_State:e.value})}},{key:"onTrainingTransition",value:function(e){var t=e.context;console.log("&",e),this.setState({Training_Machine_State:e.value}),t.interactive||this.setState({training_description:t.training_description||"???",agent_description:t.agent_description||"???",problem_description:t.problem_description||"???"})}},{key:"changeInteractionMode",value:function(e){this.setState(e)}},{key:"componentDidUpdate",value:function(e,t){var n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return console.log(n),Object.keys(t).reduce(function(r,i){return e[i]===t[i]||null!=n&&!n.includes(i)||(r[i]=t[i]),r},{})}(t,this.state,["interactive","free_author","tutor_mode"]);Object.keys(n).length>0&&(console.log("componentDidUpdate",n),this.training_service.send({type:"CHANGE_INTERACTION_MODE",data:n}))}},{key:"componentDidMount",value:function(){var e,t,n=this;console.log("MOUNTED");var r=[this.tutor.current,this.network_layer,this.props.working_dir,this.props.training_file];e=r[2],t=r[3],this.interactions_sm=(0,p.build_interactions_sm)(this,(0,b.default)(this.props,_.problem_props)),this.interactions_service=null,this.training_machine=(0,_.build_training_sm)(this,this.interactions_sm,t,e),this.training_service=(0,g.interpret)(this.training_machine),this.training_service.onTransition(this.onTrainingTransition),this.training_service.start();this.training_service.subscribe(function(e){console.log("SUBSCRIBE:",e)});console.log("T MACHINE!",this.training_service),window.setTutorMode=function(e){n.changeInteractionMode({tutor_mode:e})},window.setInteractive=function(e){n.changeInteractionMode({interactive:e})},window.setFreeAuthor=function(e){n.changeInteractionMode({free_author:e})},window.generateBehaviorProfile=this.generateBehaviorProfile}},{key:"generateBehaviorProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/ground_truth.json",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.network_layer.generateBehaviorProfile,r=this.training_service._state.context;if(null!=e){return"/"!=e[0]&&(e=(r.working_dir||"/")+e),fetch(e).then(function(e){return e.text()}).then(function(e){return e.split("\n")}).then(function(e){return function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=e["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(""!=s){var l=JSON.parse(s);t.push(l)}}}catch(c){r=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}(e)}).then(function(e){return n(r,{data:{requests:e,out_dir:t}})})}return n(r)}},{key:"render",value:function(){var e,t,n=this.props.tutorClass;this.state.interactive?e=v.default.createElement(k.View,{style:T.controls},!this.state.tutor_mode&&v.default.createElement(k.View,{style:T.skill_panel},v.default.createElement(d.default,(0,i.default)({ref:this.skill_panel},this.state.default_props,this.state.skill_panel_props))),v.default.createElement(k.View,{style:T.buttons},v.default.createElement(f.default,(0,i.default)({ref:this.buttons},this.state.default_props,this.state.buttons_props,{tutor_mode:this.state.tutor_mode})))):(t=this.state.training_description+"\n"+this.state.agent_description+"\n"+this.state.problem_description+"\n",e=v.default.createElement(k.View,{style:T.prompt},v.default.createElement(k.Text,null,t)));return console.log("TRANING MACHINE STATE",this.state.Training_Machine_State),v.default.createElement(k.View,{style:T.container},v.default.createElement(k.View,{style:T.ctat_tutor},"Creating_Agent"==this.state.Training_Machine_State&&v.default.createElement(k.View,{style:T.overlay},v.default.createElement(y.default,{color:"#000000",size:100,visible:!0,textContent:"Loading...",textStyle:T.spinnerTextStyle})),v.default.createElement(n,(0,i.default)({ref:this.tutor,id:"tutor_iframe",interactive:!1},this.state.default_props,this.state.tutor_props))),e)}}]),t}(v.default.Component);t.default=S;var T=k.StyleSheet.create({spinnerTextStyle:{color:"#000000"},overlay:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:"rgba(50, 50, 50, 0.3)",flex:1,justifyContent:"center",alignItems:"center"},overlay_text:{textAlign:"center"},container:{flex:1,flexDirection:"column"},ctat_tutor:{margin:4,flexBasis:"65%",flex:1},prompt:{flex:1,textAlign:"center"},controls:{flex:1,flexBasis:"35%",flexDirection:"row"},skill_panel:{flex:1,flexBasis:"60%"},buttons:{flexGrow:1,flexDirection:"column",flexBasis:"40%",justifySelf:"space-around"}})},301:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.build_training_sm=function(e,t){var n=e.network_layer,r={app:e,tutor:e.tutor.current,skill_panel:e.skill_panel.current,buttons:e.buttons.current,network_layer:e.network_layer,interactive:e.props.interactive,training_file:e.props.training_file,working_dir:e.props.working_dir,interactions_sm:t,file_params:null,agent_params:null,prob_obj:null};return r=g({},v,{},r),(0,c.Machine)({context:r,initial:"Loading_Training_File",states:{Loading_Training_File:{invoke:{id:"load_training_file",src:"load_training_file",onDone:{target:"Serving_Training_Sets",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Serving_Training_Sets:{invoke:{id:"serve_next_training_set",src:"serve_next_training_set",onDone:[{target:"All_Done",cond:"iteratorEmpty"},{target:"Serving_Agents",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Serving_Agents:{invoke:{id:"serve_next_agent",src:"serve_next_agent",onDone:[{target:"Serving_Training_Sets",cond:"iteratorEmpty"},{target:"Creating_Agent",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Creating_Agent:{invoke:{id:"create_agent",src:"create_agent",onDone:{target:"Handling_Prior_Knowledge",actions:"assignAgentId"},onError:{target:"Fail",actions:"logError"}}},Handling_Prior_Knowledge:{invoke:{id:"handle_prior_knowledge",src:"handle_prior_knowledge",onDone:{target:"Serving_Problems",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Serving_Problems:{invoke:{id:"serve_next_problem",src:"serve_next_problem",onDone:[{target:"Serving_Agents",cond:"iteratorEmpty"},{target:"Waiting_Problem_Load",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Waiting_Problem_Load:{invoke:{id:"load_problem",src:"load_problem",onDone:{target:"Training",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Training:{entry:"start_training_interaction",on:{PROBLEM_DONE:{target:"Serving_Problems",actions:"sendProblemDone"},CHANGE_INTERACTION_MODE:{target:"Serving_Problems",actions:"assignInteractionSM"}}},All_Done:{entry:"allDone",type:"final"},Fail:{entry:["logError","kill_this"]}}},{services:{load_training_file:k,serve_next_training_set:S,serve_next_agent:x,create_agent:n.createAgent,serve_next_problem:C,load_problem:O,handle_prior_knowledge:E},actions:{start_training_interaction:L,logError:function(e,t){console.error(t.data)},updateContext:(0,c.assign)(function(e,t){return t.data.updateContext}),assignAgentId:(0,c.assign)(function(e,t){return{agent_id:t.data.agent_id}}),allDone:F,assignInteractionSM:R,sendProblemDone:P},guards:{iteratorEmpty:I}})},t.problem_props=void 0;var i=r(n(65)),a=r(n(86)),o=r(n(113)),s=r(n(50)),l=r(n(114)),c=n(120),u=r(n(174)),d=n(173),f=n(304),p=n(305),_=n(175);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,s.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=n(228),b=(n(416),new _.Random,["agent_id","free_author","interactive","tutor_mode","examples_only","test_mode"]);t.problem_props=b;var v=b.reduce(function(e,t){return e[t]=null,e},{}),y={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};function k(e,t){return console.log("TRAINING JSON:",e.training_file),fetch(e.training_file).then(function(e){return e.text()}).then(function(e){return u.default.parse(e)}).then(function(e){return Object.entries(e)}).then(function(e){return{updateContext:{training_iterator:e}}})}function S(e,t){return new Promise(function(){var t=(0,l.default)(o.default.mark(function t(n,r){var i,a,s,l,c;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.training_iterator,a=e.file_params||{},console.log("TRAINING ITERATOR",i.length),!(i.length>0)){t.next=14;break}for(s=i.shift(),l=s[0];"set_params"==l;)a=g({},a,{},s[1]),s=i.shift(),l=s[0];return console.log("START TRAINING SET: ",l,a),t.next=10,(0,p.evalJSONFunc)(s[1],e);case 10:c=t.sent,n({updateContext:{training_iterator:i,agent_iterator:c,file_params:a,training_description:e.training_file.replace(/^.*[\\\/]/,"")+" : "+l}}),t.next=15;break;case 14:n(null);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof e&&(e={type:e}),null!=t&&(e.problem_set=t),e.initialized=!1,{outer_loop_controller:e}}function x(e,t){return new Promise(function(){var t=(0,l.default)(o.default.mark(function t(n,r){var i,s,l,c,u,d,f,_,h;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.agent_iterator,console.log("AGENT ITERATOR",i.length),!(e.agent_iterator.length>0)){t.next=25;break}return"repetitions"in(s=i.shift())&&(s.repetitions<0?i.unshift(g({},s,{},{_rep_count:(s._rep_count||1)+1})):0==s.repetitions?s=i.shift():s.repetitions>=2&&(s.repetitions-=1,i.unshift(g({},s,{},{_rep_count:(s._rep_count||1)+1}))),s._rep_count=s._rep_count||1),t.next=7,(0,p.evalJSONFunc)(s.problem_set,e);case 7:l=t.sent,console.log("RESOLVED PROBLEM SET",(0,a.default)(l)),s=g({},e.file_params.agent||{},{},s),e.file_params.agent&&e.file_params.agent.args&&(s.args=g({},e.file_params.agent.args,{},s.args)),c=s.set_params||{},u=null!=s._rep_count?"("+s._rep_count+")":"",s.agent_name+=u,d="Agent Name: "+s.agent_name+"\nAgent Type: "+s.agent_type,f=(0,a.default)(s.prior_knowledge||[]),_=null,"outer_loop_controller"in s&&(_=T(s.outer_loop_controller,l),l=[_]),delete(h=g({},s)).problem_set,delete h.agent_name,delete h.agent_type,n({updateContext:{start_state_history:[],request_history:[],session_id:y.guid(),user_guid:s.agent_name,agent_params:c,agent_name:s.agent_name,agent_type:s.agent_type,agent_description:d,other_agent_data:h,agent_iterator:i,problem_set:l,prior_knowledge:f,agent_start_time:new Date}}),t.next=26;break;case 25:n(null);case 26:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function E(e,t){var n=new Promise(function(t,r){for(var i=e.prior_knowledge;i.length>0;){console.log("CURRENT",i);var a=i.shift(),o=(0,f.applyPriorKnowledge)(e,a,i);if(o.updateContext&&t({updateContext:o.updateContext}),o.train_now)return n}t({updateContext:{prior_knowledge:i,problem_iterator:e.problem_set}})});return n}function w(e,t,n,r){return A.apply(this,arguments)}function A(){return(A=(0,l.default)(o.default.mark(function e(t,n,r,i){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise(function(){var e=(0,l.default)(o.default.mark(function e(a,s){var l,c,u,d,f;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=t.shift();case 1:if(!(null!=l&&"outer_loop_controller"in l)){e.next=15;break}if((c=i.network_layer).OUTER_LOOP_URL||c.kill_this("\nCANNOT USE 'outer_loop_controller' : {} pattern unless running train.py with --outer-loop flag.\n"),(u=l.outer_loop_controller).initialized){e.next=9;break}return e.next=8,c.newOuterLoopController(u,i);case 8:u.initialized=!0;case 9:return e.next=11,c.nextProblem(u,i);case 11:null!=(d=e.sent)?(t.unshift(g({},l)),l=d):l=t.length>0?t.shift():null,e.next=1;break;case 15:if(l){e.next=18;break}return a([null,n]),e.abrupt("return");case 18:if(!("set_params"in l)){e.next=26;break}if(n=g({},n,{},l.set_params),l=t.shift()){e.next=24;break}return a([null,n]),e.abrupt("return");case 24:e.next=18;break;case 26:return delete(f=g({},r)).agent,l=g({},f,{},n,{},l),a([l,n]),e.abrupt("return");case 31:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),e.abrupt("return",a);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(e,t){return new Promise(function(){var t=(0,l.default)(o.default.mark(function t(n,r){var a,s,l,c,u,d,f,p,_;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=null,s=e.agent_params,l=e.file_params,c=e.problem_iterator,e.network_layer,e.interactive,console.log("PROBLEM ITERATOR",c.length),!(c.length>0)){t.next=37;break}return t.next=10,w(c,s,l,e);case 10:if(u=t.sent,d=(0,i.default)(u,2),a=d[0],s=d[1],!a){t.next=34;break}if(!("repetitions"in a)){t.next=30;break}if(!(a.repetitions<0)){t.next=20;break}c.unshift(g({},a)),t.next=30;break;case 20:if(0!=a.repetitions){t.next=29;break}return t.next=23,w(c,s,l,e);case 23:f=t.sent,p=(0,i.default)(f,2),a=p[0],s=p[1],t.next=30;break;case 29:a.repetitions>=2&&(a.repetitions-=1,c.unshift(g({},a)));case 30:_=Object.keys(a).reduce(function(e,t){return e+t+": "+a[t]+"\n"},""),n({updateContext:{agent_params:s,problem_iterator:c,prob_obj:a,problem_description:_}}),t.next=35;break;case 34:n(null);case 35:t.next=38;break;case 37:n(null);case 38:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function O(e,t){return e.tutor.loadProblem(e)}function I(e,t){return null==t.data}function P(e,t){e.network_layer.sendProblemDone(e,t)}function L(e,t){console.log("START TRAINING INTERACTION");var n=e.app,r=g({},m(e,b),{},m(e.prob_obj,b)),i=e.interactions_sm.withContext(g({},e.interactions_sm.context,{},r)),a=(0,c.interpret)(i);e.app.interactions_service=a,a.onTransition(n.onInteractionTransition),a.start()}function F(e,t){var n=e.network_layer;console.log("ITS ALL DONE!"),n.kill_this("\n TRAINING FINISHED SUCCESSFULLY! \n","info")}var R=(0,c.assign)({interactions_sm:function(e,t){var n=g({},{app:e.app},{},m(e,b),{},m(e.prob_obj,b),{},t.data);return console.log("assignInteractionSM",n),(0,d.build_interactions_sm)(n.app,n)}})},304:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.applyPriorKnowledge=function(e,t,n){var r=t.type.toLowerCase().replace("_","");return s[r](t,n)};var i=r(n(113)),a=r(n(114)),o=r(n(112)),s={bestintersect:function(e,t,n){return l.apply(this,arguments)}};function l(){return(l=(0,a.default)(i.default.mark(function e(t,n,r){var a,s,l,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.cache_folder||t.working_dir+"/.pkcache",s=a+"/"+o.default.basename(t.training_file)+".cache",console.log("MOOOOOOOOO",s),e.next=5,fetch(s).then(function(e){if(!e.ok)throw Error(e.statusText);return e}).then(function(e){return e.text()}).catch(function(e){return null});case 5:return l=e.sent,c=null==l?{updateContext:{prior_knowledge:[n]+r,problem_iterator:[]},train_now:!0}:{updateContext:{prior_knowledge:r,problem_iterator:[]},train_now:!0},e.abrupt("return",c);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}},305:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.evalString=function(){return R.apply(this,arguments)},t.evalJSONFunc=D,t.registedFunctions=void 0;var i=r(n(9)),a=r(n(86)),o=r(n(50)),s=r(n(65)),l=r(n(113)),c=r(n(114)),u=n(175),d=r(n(414)),f=r(n(112));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){(0,o.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=new u.Random,g={concatenate:function(e,t){return b.apply(this,arguments)},shuffle:function(e,t){return v.apply(this,arguments)},sample:function(e,t){return y.apply(this,arguments)},glob:function(e,t){return k.apply(this,arguments)},from_file:function(e,t){return S.apply(this,arguments)},estimate_Pik:function(e,t){return I.apply(this,arguments)},gen_pretraining:function(e,t){return P.apply(this,arguments)},gen_pivot_table:function(e,t){return F.apply(this,arguments)},mirror_students:function(e,t){return L.apply(this,arguments)}};function m(e,t){return"/"!=e[0]&&(e=t.working_dir+"/"+e),e}function b(){return(b=(0,c.default)(l.default.mark(function e(t,n){var r,i,a,o,s,c,u,d;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=!0,a=!1,o=void 0,e.prev=4,s=t["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();case 6:if(i=(c=s.next()).done){e.next=15;break}return u=c.value,e.next=10,D(u,n);case 10:d=e.sent,r=r.concat(d);case 12:i=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),a=!0,o=e.t0;case 21:e.prev=21,e.prev=22,i||null==s.return||s.return();case 24:if(e.prev=24,!a){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}},e,null,[[4,17,21,29],[22,,24,28]])}))).apply(this,arguments)}function v(){return(v=(0,c.default)(l.default.mark(function e(t,n){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(t,n);case 2:return r=e.sent,e.abrupt("return",h.shuffle(r));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(){return(y=(0,c.default)(l.default.mark(function e(t,n){var r,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.n,i=t.set,e.next=4,D(i,n);case 4:return i=e.sent,console.log("IT IS THIS BIG:",i.length),e.abrupt("return",h.sample(i,r));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function k(){return(k=(0,c.default)(l.default.mark(function e(t,n){var r,i,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t&&(t={pattern:t}),r=t.key||null,i=t.pattern,e.next=5,n.network_layer.glob(i,n);case 5:return a=e.sent,a=r?a.map(function(e){var t={};return t[r]="/"+e,t}):a.map(function(e){return"/"+e}),e.abrupt("return",a);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(){return(S=(0,c.default)(l.default.mark(function e(t,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not Implemented";case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function T(e,t){return x.apply(this,arguments)}function x(){return(x=(0,c.default)(l.default.mark(function e(t,n){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))).apply(this,arguments)}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&(e=e.replace(/\.\./g,"!u")),new Promise(function(){var r=(0,c.default)(l.default.mark(function r(i,a){return l.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.complete=i,!n){r.next=5;break}return r.next=4,fetch(e).then(function(e){return e.text()});case 4:e=r.sent;case 5:d.default.parse(e,t);case 6:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}function w(e){return A.apply(this,arguments)}function A(){return(A=(0,c.default)(l.default.mark(function e(t){var n,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={delimiter:"\t",header:!0,dynamicTyping:!0},t=t.replace("..","!u"),r=fetch(t).then(function(e){return e.text()}).then(function(e){var t=e.split(/\n{2,}/g);return[t[0].split(/Values for .* model.*\n/)[1],t[1].split("in the selected KC model.\n")[1]]}).then(function(){var e=(0,c.default)(l.default.mark(function e(t){var r,i,a,o,c;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,s.default)(t,2),i=r[0],a=r[1],e.next=3,E(i,n,!1,!1);case 3:return o=e.sent,e.next=6,E(a,n,!1,!1);case 6:return c=e.sent,e.abrupt("return",[o,c]);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(e,t){return O.apply(this,arguments)}function O(){return(O=(0,c.default)(l.default.mark(function e(t,n){var r,i,a,o,c,u,d,f,p,_,h,g,b,v,y,k,S,T,x,A,C,O,I,P,L,F,R,D,N,j,M,U,H,B,W,V,q,K;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.fo_err_by_kc){e.next=28;break}return e.next=3,w(m(t.afm_stats,n));case 3:for(i=e.sent,a=(0,s.default)(i,2),o=a[0],c=a[1],u=c.data.filter(function(e){return e["Anon Student Id"]==t.student_id})[0].Intercept,r={},d=!0,f=!1,p=void 0,e.prev=12,_=o.data["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(d=(h=_.next()).done);d=!0)g=h.value,b=1/(1+Math.exp(u+g["Intercept (logit)"])),r[g["KC Name"]]=b;e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),f=!0,p=e.t0;case 20:e.prev=20,e.prev=21,d||null==_.return||_.return();case 23:if(e.prev=23,!f){e.next=26;break}throw p;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return r=r||t.fo_err_by_kc,v=m(t.error_table,n),e.next=32,E(v,{delimiter:"\t",header:!0,dynamicTyping:!0},!0);case 32:for(y=e.sent,k={},S=!0,T=!1,x=void 0,e.prev=37,A=y.data["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(S=(C=A.next()).done);S=!0)O=C.value,(I=O["KC Name"])&&(delete O["KC Name"],k[I]=Object.values(O));e.next=45;break;case 41:e.prev=41,e.t1=e.catch(37),T=!0,x=e.t1;case 45:e.prev=45,e.prev=46,S||null==A.return||A.return();case 48:if(e.prev=48,!T){e.next=51;break}throw x;case 51:return e.finish(48);case 52:return e.finish(45);case 53:P={},e.t2=l.default.keys(k);case 55:if((e.t3=e.t2()).done){e.next=82;break}for(L=e.t3.value,F=k[L],R=1/0,N=r[L],j=!0,M=!1,U=void 0,e.prev=63,H=F.entries()["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(j=(B=H.next()).done);j=!0)W=(0,s.default)(B.value,2),V=W[0],q=W[1],(K=N-q)<R&&K>0&&(R=K,D=V);e.next=71;break;case 67:e.prev=67,e.t4=e.catch(63),M=!0,U=e.t4;case 71:e.prev=71,e.prev=72,j||null==H.return||H.return();case 74:if(e.prev=74,!M){e.next=77;break}throw U;case 77:return e.finish(74);case 78:return e.finish(71);case 79:P[L]=D,e.next=55;break;case 82:return e.abrupt("return",P);case 83:case"end":return e.stop()}},e,null,[[12,16,20,28],[21,,23,27],[37,41,45,53],[46,,48,52],[63,67,71,79],[72,,74,78]])}))).apply(this,arguments)}function I(){return(I=(0,c.default)(l.default.mark(function e(t,n){var r,i,a,o,s,c,u,d;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("exact_align"!=t.method){e.next=6;break}return e.next=3,C(t,n);case 3:r=e.sent,e.next=10;break;case 6:if("backcast"!=t.method){e.next=10;break}return e.next=9,T(t,n);case 9:r=e.sent;case 10:if(!("KCs"in t&&null!=t.KCs)){e.next=32;break}for(i={},a=!0,o=!1,s=void 0,e.prev=15,c=t.KCs["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(a=(u=c.next()).done);a=!0)d=u.value,i[d]=r[d];e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),o=!0,s=e.t0;case 23:e.prev=23,e.prev=24,a||null==c.return||c.return();case 26:if(e.prev=26,!o){e.next=29;break}throw s;case 29:return e.finish(26);case 30:return e.finish(23);case 31:r=i;case 32:if("max"in t&&null!=t.max)for(d in r)r[d]=Math.min(r[d],t.max);return e.abrupt("return",r);case 34:case"end":return e.stop()}},e,null,[[15,19,23,31],[24,,26,30]])}))).apply(this,arguments)}function P(){return(P=(0,c.default)(l.default.mark(function e(t,n){var r,i,a,o,s,c,u,d,f,p,g,m,b,v,y,k,S,T,x,E,w,A,C=arguments;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=C.length>2&&void 0!==C[2]&&C[2],e.next=3,D(t.opportunities,n);case 3:if(i=e.sent,a=t.by_step_id?"step_id":"Selection",o="only_"+a+"s",i=_({},i),"string"!=typeof t.step_pivot_table){e.next=11;break}alert("NOT IMPLEMENTED"),e.next=14;break;case 11:return e.next=13,D(t.step_pivot_table,n);case 13:s=e.sent;case 14:for(c=Object.keys(s),r&&(c=h.shuffle(c)),u=[],d=t.onlys_map||null,f=!0,p=!1,g=void 0,e.prev=21,m=c["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(f=(b=m.next()).done);f=!0){for(x in v=b.value,y=!0,k=!1,S=[],T=s[v])i[x]>0?(i[x]-=1,E=T[x][a],E=Array.from(E),d&&(E=E.map(function(e){return d[e]})),1==E.length&&(E=E[0]),S.push(E),k=!0):y=!1;k&&((w={})[t.problem_key]=v,y||(w[o]=S),u.push(w))}e.next=29;break;case 25:e.prev=25,e.t0=e.catch(21),p=!0,g=e.t0;case 29:e.prev=29,e.prev=30,f||null==m.return||m.return();case 32:if(e.prev=32,!p){e.next=35;break}throw g;case 35:return e.finish(32);case 36:return e.finish(29);case 37:return Object.values(i).reduce(function(e,t){return e+t},0)>0&&(A="Insufficient problems in problem_pool to pretrain requested number of steps. Additional problems required for KCs/Steps: "+JSON.stringify(i),n.network_layer.kill_this(A),console.error(A)),console.log("opps_by_kc"),console.log(i),e.abrupt("return",u);case 41:case"end":return e.stop()}},e,null,[[21,25,29,37],[30,,32,36]])}))).apply(this,arguments)}function L(){return(L=(0,c.default)(l.default.mark(function e(t,n){var r,i,a,o,s,c,u,p,_,h,g,b,v,y,k,S,T,x,w,A,C,O,I,P,L,F,R,N,j,M,U,H,B,W,V,q,K,G,J,z,Y,Q,X;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("MIRROR_START"),r=m(t.human_transactions,n),i=t.human_afm_stats,a=t.pool_agent_error_table,o=t.Pik_method,s=t.problem_key,c=t.kc_model,u=t.KCs,p=t.max,e.next=11,D(t.human_problems,n);case 11:for(_=e.sent,h={},g=!0,b=!1,v=void 0,e.prev=16,y=_["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(g=(k=y.next()).done);g=!0)S=k.value,h[f.default.basename(S).split(".")[0]]=S;e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),b=!0,v=e.t0;case 24:e.prev=24,e.prev=25,g||null==y.return||y.return();case 27:if(e.prev=27,!b){e.next=30;break}throw v;case 30:return e.finish(27);case 31:return e.finish(24);case 32:if(!("step_pivot_table"in t)){e.next=38;break}return e.next=35,D(t.step_pivot_table,n);case 35:T=e.sent,e.next=45;break;case 38:return e.next=40,D(t.pool_agent_problems,n);case 40:return x=e.sent,T={gen_pivot_table:{transaction_file:t.pool_agent_transactions,problem_pool:x,kc_model:t.kc_model}},e.next=44,D(T,n);case 44:T=e.sent;case 45:return w={},A={dynamicTyping:!0,delimiter:"\t",header:!0,download:!0,step:function(e){if((e=e.data)&&"Anon Student Id"in e){var t=w[e["Anon Student Id"]]||[],n=e["Problem Name"]||"",r=e["Problem View"]||"";if(""!=n){var i=String(n)+"#"+String(r);0==t.length?t.push(i):t.includes(i)||t.push(i)}w[e["Anon Student Id"]]=t}}},C=n.network_layer.HOST_URL+r,e.next=50,E(C,A,!1);case 50:for(O in e.sent,console.log("BEEE"),console.log(w),w)w[O]=w[O].map(function(e){return e.substring(0,e.lastIndexOf("#"))});console.log("AFFFF"),console.log(w),console.log("human_prob_seq"),console.log(w),console.log("human_path_map"),console.log(h),e.t1=l.default.keys(w);case 61:if((e.t2=e.t1()).done){e.next=87;break}for(I=e.t2.value,P=w[I],L=[],F=!0,R=!1,N=void 0,e.prev=68,j=P["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(F=(M=j.next()).done);F=!0)U=M.value,(H=h[U])&&((B={})[s]=H,L.push(B));e.next=76;break;case 72:e.prev=72,e.t3=e.catch(68),R=!0,N=e.t3;case 76:e.prev=76,e.prev=77,F||null==j.return||j.return();case 79:if(e.prev=79,!R){e.next=82;break}throw N;case 82:return e.finish(79);case 83:return e.finish(76);case 84:w[I]=L,e.next=61;break;case 87:W=[],"store_opp_table"in t&&(V=[]),console.log("full_paths"),console.log(w),e.t4=l.default.keys(w);case 92:if((e.t5=e.t4()).done){e.next=117;break}if(q=e.t5.value,!((K=w[q]).length>0)){e.next=112;break}return G={estimate_Pik:{method:o,afm_stats:i,student_id:q,error_table:a,KCs:u,max:p}},e.next=99,D(G,n);case 99:if(G=e.sent,"store_opp_table"in t){for(J in(B={})["Anon Student Id"]=q,G)B[J]=G[J];V.push(B)}return z={gen_pretraining:{opportunities:G,step_pivot_table:T,problem_key:s,kc_model:c,onlys_map:t.onlys_map||null}},e.next=104,D(z,n);case 104:z=e.sent,Y={agent_name:q,problem_set:{concatenate:[{set_params:{domain_name:"prior_knowledge"}},z,{set_params:{domain_name:void 0}},K]}},W.push(Y),e.next=115;break;case 112:Q="Will Skip Student "+q+"because did not do any problems.",console.warn(Q),n.network_layer.term_print(Q,"warning");case 115:e.next=92;break;case 117:return"store_opp_table"in t&&(X=d.default.unparse(V,{delimiter:"\t"}),console.log("OUT CSV"),console.log(X)),console.log("out"),console.log(W),e.abrupt("return",W);case 121:case"end":return e.stop()}},e,null,[[16,20,24,32],[25,,27,31],[68,72,76,84],[77,,79,83]])}))).apply(this,arguments)}function F(){return(F=(0,c.default)(l.default.mark(function e(t,n){var r,i,a,o,s,c,u,p,_,h,g,b,v,y,k,S,T,x,w,A,C,O,I,P,L;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("cache"in t)){e.next=24;break}return e.next=3,E(m(t.cache,n));case 3:for(i=e.sent,r={},a=!0,o=!1,s=void 0,e.prev=8,c=i["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(a=(u=c.next()).done);a=!0)p=u.value,r[p["Problem Path"]]=r[p["Problem Path"]]||{},r[p["Problem Path"]][p.KC].step_id=p.step_id.split(","),r[p["Problem Path"]][p.KC].Selection=p.Selection.split(",");e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),o=!0,s=e.t0;case 16:e.prev=16,e.prev=17,a||null==c.return||c.return();case 19:if(e.prev=19,!o){e.next=22;break}throw s;case 22:return e.finish(19);case 23:return e.finish(16);case 24:if(null!=r){e.next=59;break}return _=m(t.transaction_file,n),e.next=28,D(t.problem_pool,n);case 28:for(h=e.sent,g={},b=!0,v=!1,y=void 0,e.prev=33,k=h["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(b=(S=k.next()).done);b=!0)T=S.value,g[f.default.basename(T).split(".")[0]]=T;e.next=41;break;case 37:e.prev=37,e.t1=e.catch(33),v=!0,y=e.t1;case 41:e.prev=41,e.prev=42,b||null==k.return||k.return();case 44:if(e.prev=44,!v){e.next=47;break}throw y;case 47:return e.finish(44);case 48:return e.finish(41);case 49:return x=null!=(x=t.kc_model||null)?"KC ("+x+")":"Step Name",r={},w={dynamicTyping:!0,delimiter:"\t",header:!0,download:!0,step:function(e){if("CORRECT"===(e=e.data).Outcome){var t=g[e["Problem Name"]]||null;if(null!=t){t in r||(r[t]={});var n=e[x];if(n){n in r[t]||(r[t][n]={step_id:new Set,Selection:new Set});var i=r[t][n];i.step_id.add(e["CF (step_id)"]),i.Selection.add(e.Selection)}}}}},A=n.network_layer.HOST_URL+_,e.next=56,E(A,w,!1);case 56:if(e.sent,"cache"in t){for(O in C=[],r)for(P in I=r[O])C.append({"Problem Path":O,KC:P,step_id:I[P].step_id.join(","),Selection:I[P].Selection.join(",")});L=d.default.unparse(C,{delimiter:"\t",header:!0,newline:"\n"}),n.network_layer.write_file(m(t.cache,n),L)}return e.abrupt("return",r);case 59:case"end":return e.stop()}},e,null,[[8,12,16,24],[17,,19,23],[33,37,41,49],[42,,44,48]])}))).apply(this,arguments)}function R(){return(R=(0,c.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not Implemented";case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e,t){return N.apply(this,arguments)}function N(){return(N=(0,c.default)(l.default.mark(function e(t,n){var r,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=4;break}return e.abrupt("return",(0,a.default)(t));case 4:if("object"!==(0,i.default)(t)){e.next=17;break}if(t=_({},t),r=Object.keys(t)[0],o=t[r],!(r in g)){e.next=14;break}return e.next=11,g[r](o,n);case 11:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",t);case 15:e.next=18;break;case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.registedFunctions=g},311:function(e,t){},313:function(e,t){},323:function(e,t){},325:function(e,t){},352:function(e,t){},354:function(e,t){},355:function(e,t){},360:function(e,t){},362:function(e,t){},369:function(e,t){},371:function(e,t){},389:function(e,t){},392:function(e,t){},408:function(e,t){},411:function(e,t){},417:function(e,t,n){var r=n(41);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(50)),a=r(n(66)),o=r(n(67)),s=r(n(113)),l=r(n(114)),c=r(n(130));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){(0,i.default)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f(e,t){return"matches"==e?void 0:t}function p(e){return _.apply(this,arguments)}function _(){return(_=(0,l.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){setTimeout(e,t)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var h=function(){var e=(0,l.default)(s.default.mark(function e(t,n){var r,i,a,o,l=arguments;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=l.length>2&&void 0!==l[2]?l[2]:3,i=l.length>3&&void 0!==l[3]?l[3]:100,a=!(l.length>4&&void 0!==l[4])||l[4],o=0;case 4:if(!(o<r)){e.next=23;break}return e.prev=5,e.next=8,fetch(t,n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(5),console.log("AL ERROR Retrying",e.t0),!(o+1===r)){e.next=17;break}throw e.t0;case 17:return console.log("waiting",a?i*Math.pow(2,o):i),e.next=20,p(a?i*Math.pow(2,o):i);case 20:o++,e.next=4;break;case 23:case"end":return e.stop()}},e,null,[[5,11]])}));return function(t,n){return e.apply(this,arguments)}}(),g={Accept:"application/json","Content-Type":"application/json"},m=function(){function e(t,n,r){(0,a.default)(this,e),this.AL_URL=t,this.HOST_URL=n,this.OUTER_LOOP_URL=r,this.request_history=[],(0,c.default)(this)}return(0,o.default)(e,[{key:"createAgent",value:function(e,t){var n={name:e.agent_name,agent_type:e.agent_type,project_id:e.project_id};return n=d({},e.other_agent_data,{},n),console.log(this.AL_URL+"/create/"),this.request_history=[],h(this.AL_URL+"/create/",{method:"POST",headers:g,body:JSON.stringify(n)},6,1e3).then(function(e){return e.json()})}},{key:"sendFeedback",value:function(e,t){var n=this;console.log("sendFeedback"),null===e.staged_SAI&&console.error("cannot give feedback on no action.");var r=e.skill_applications,i=e.feedback_map,a=null;if(i&&Object.keys(i).length>0){for(var o in i){var s=r[o],l={state:e.state,selection:s.selection,action:s.action,inputs:s.inputs,foci_of_attention:s.foci_of_attention,rhs_id:s.rhs_id,mapping:s.mapping,reward:"correct"==i[o].toLowerCase()?1:-1};e.interactive&&(l.add_skill_info=!0),a=null!=a?a.then(function(t){return n.sendTrainingData(l,e.agent_id)}):this.sendTrainingData(l,e.agent_id)}}else{s=e.staged_SAI,l={state:e.state,selection:s.selection,action:s.action,inputs:s.inputs,foci_of_attention:s.foci_of_attention,rhs_id:s.rhs_id,mapping:s.mapping,reward:s.reward};e.interactive&&(l.add_skill_info=!0),a=this.sendTrainingData(l,e.agent_id)}return a}},{key:"sendTrainingData",value:function(e,t){console.log("sendTrainingData");var n=this.AL_URL+"/train/"+t+"/";return h(n,{method:"POST",headers:g,body:JSON.stringify(e,f)}).then(function(e){return e.text()}).then(function(e){try{return JSON.parse(e)}catch(t){return{}}})}},{key:"queryApprentice",value:function(e,t){console.log("queryApprentice");var n={state:e.state};e.interactive&&(n.kwargs={add_skill_info:!0,n:0}),this.request_history.push(n);var r=this.AL_URL+"/request/"+e.agent_id+"/";return h(r,{method:"POST",headers:g,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"checkApprentice",value:function(e,t){console.log("checkApprentice");var n=d({state:e.state},e.staged_SAI),r=this.AL_URL+"/check/"+e.agent_id+"/";return h(r,{method:"POST",headers:g,body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){return+e.reward})}},{key:"term_print",value:function(e){var t={message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default"};return h(this.HOST_URL,{method:"PRINT",headers:g,body:JSON.stringify(t)})}},{key:"kill_this",value:function(e){var t={message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error"};return h(this.HOST_URL,{method:"QUIT",headers:g,body:JSON.stringify(t)})}},{key:"write_file",value:function(e,t){t={file:e,data:t};return h(this.HOST_URL,{method:"WRITE",headers:g,body:JSON.stringify(t)})}},{key:"sendProblemDone",value:function(e,t){}},{key:"generate_nools",value:function(e,t){var n=this,r=this.AL_URL+"/get_skills/"+e.agent_id+"/",i={states:this.request_history.map(function(e){return e.state})};return h(r,{method:"POST",headers:g,body:JSON.stringify(i,f)}).then(function(e){return e.json()}).then(function(t){console.log("NOOLS DIR: ",e.nools_dir);var r={nools_dir:e.nools_dir,problems:e.start_state_history,skills:t};return fetch(n.HOST_URL,{method:"GEN_NOOLS",headers:g,body:JSON.stringify(r,f)})})}},{key:"generateBehaviorProfile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.data=t.data||{};var n=t.data.requests||this.request_history,r=t.data.out_dir||(e.working_dir||".")+"/bprofiles",i=this.HOST_URL,a=this.AL_URL,o=(new Date-e.agent_start_time)%864e5%36e5/6e4,c={dir:r,elapse_minutes:o.toFixed(1)};return fetch(i,{method:"START_BEHAVIOR_PROFILE",headers:g,body:JSON.stringify(c)}).then(function(){var t=(0,l.default)(s.default.mark(function t(o){var l,c,u,d,f,p,_,m,b,v,y;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l=!0,c=!1,u=void 0,t.prev=3,d=n["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();case 5:if(l=(f=d.next()).done){t.next=20;break}return p=f.value,_=p.state,m={state:_,kwargs:{add_skill_info:!0,n:-1}},t.next=11,h(a+"/request/"+e.agent_id+"/",{method:"POST",headers:g,body:JSON.stringify(m)}).then(function(e){return e.json()});case 11:return b=t.sent,v=[],"responses"in b&&b.responses.forEach(function(e,t){var n={selection:e.selection,action:e.action,inputs:e.inputs};console.log(e),console.log(e.selection),v.push(n)}),y={state:_,responses:v,dir:r},t.next=17,fetch(i,{method:"APPEND_BEHAVIOR_PROFILE",headers:g,body:JSON.stringify(y)});case 17:l=!0,t.next=5;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),c=!0,u=t.t0;case 26:t.prev=26,t.prev=27,l||null==d.return||d.return();case 29:if(t.prev=29,!c){t.next=32;break}throw u;case 32:return t.finish(29);case 33:return t.finish(26);case 34:case"end":return t.stop()}},t,null,[[3,22,26,34],[27,,29,33]])}));return function(e){return t.apply(this,arguments)}}())}},{key:"newOuterLoopController",value:function(e,t){var n={outer_loop_type:e.type||e.outer_loop_type,problem_set:e.problem_set,outer_loop_args:e.args||e.outer_loop_args,id:t.agent_id};console.log(this.OUTER_LOOP_URL);var r=fetch(this.OUTER_LOOP_URL,{method:"NEW_STUDENT",headers:g,body:JSON.stringify(n)}).then(function(e){});return console.log(r),r}},{key:"nextProblem",value:function(e,t){var n={id:t.agent_id};return fetch(this.OUTER_LOOP_URL,{method:"NEXT_PROBLEM",headers:g,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"glob",value:function(e,t){return"/"!=(e=e.replace(/\.\./g,"!u"))[0]&&(e=t.working_dir+"/"+e),fetch(this.HOST_URL,{method:"GLOB",headers:g,body:JSON.stringify(e)}).then(function(e){return e.json()})}}]),e}();t.default=m}},[[247,1,2]]]);
//# sourceMappingURL=main.2aa1f4e3.chunk.js.map